(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    286507,       7050]
NotebookOptionsPosition[    282031,       6899]
NotebookOutlinePosition[    282537,       6918]
CellTagsIndexPosition[    282494,       6915]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Definitions for linear electroelastostatics:", "Title",
 CellChangeTimes->{{3.7227097911277695`*^9, 3.7227098092418723`*^9}, {
  3.763392097019563*^9, 3.7633920975064383`*^9}, {3.7644120125636625`*^9, 
  3.7644120151392117`*^9}}],

Cell[CellGroupData[{

Cell["Define Tri3 basis functions in parent coordinates \
(\[Xi],\[Psi],\[Zeta]):", "Subsection",
 CellChangeTimes->{{3.717170430098735*^9, 3.717170455794014*^9}, {
  3.717367163060734*^9, 3.717367164420561*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Phi]s", "=", 
   RowBox[{"{", 
    RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]", ",", 
     RowBox[{"1", "-", "\[Xi]", "-", "\[Psi]", "-", "\[Zeta]"}]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.717159762670228*^9, 3.717159772862687*^9}, 
   3.7171704577284317`*^9, {3.7173671489361877`*^9, 3.717367156764295*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Define local nodal coordinate arrays, X, Y, and Z, and compute the \
position, ",
 Cell[BoxData[
  FormBox[
   RowBox[{"x", " ", "=", 
    RowBox[{"\[Sum]", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Phi]", "I"], "[", 
       RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]"}], "]"}], 
      SubscriptBox["X", "I"]}]}]}], TraditionalForm]]],
 ", ",
 Cell[BoxData[
  FormBox[
   RowBox[{"y", " ", "=", " ", 
    RowBox[{"\[Sum]", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Phi]", "I"], "[", 
       RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]"}], "]"}], 
      SubscriptBox["Y", "I"]}]}]}], TraditionalForm]]],
 ", and  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"z", " ", "=", " ", 
    RowBox[{"\[Sum]", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Phi]", "I"], "[", 
       RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]"}], "]"}], 
      RowBox[{
       SubscriptBox["Z", "I"], ":"}]}]}]}], TraditionalForm]]]
}], "Subsection",
 CellChangeTimes->{{3.717170467034111*^9, 3.717170646080793*^9}, {
  3.7173672533732233`*^9, 3.717367296127637*^9}, {3.7173676524772353`*^9, 
  3.7173676768522606`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2", ",", "x3", ",", "x4"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "=", 
   RowBox[{"{", 
    RowBox[{"y1", ",", "y2", ",", "y3", ",", "y4"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Z", "=", 
   RowBox[{"{", 
    RowBox[{"z1", ",", "z2", ",", "z3", ",", "z4"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", "=", 
   RowBox[{
    UnderoverscriptBox["\[Sum]", 
     RowBox[{"i", "=", "1"}], "4"], 
    RowBox[{
     RowBox[{"\[Phi]s", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "*", 
     RowBox[{"X", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"y", "=", 
   RowBox[{
    UnderoverscriptBox["\[Sum]", 
     RowBox[{"i", "=", "1"}], "4"], 
    RowBox[{
     RowBox[{"\[Phi]s", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "*", 
     RowBox[{"Y", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"z", "=", 
   RowBox[{
    UnderoverscriptBox["\[Sum]", 
     RowBox[{"i", "=", "1"}], "4"], 
    RowBox[{
     RowBox[{"\[Phi]s", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "*", 
     RowBox[{"Z", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.716761356116639*^9, 3.71676136863325*^9}, 
   3.717159777614208*^9, {3.717367683976516*^9, 3.7173677669144773`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Define the Jacobian matrix, ",
 Cell[BoxData[
  FormBox[
   RowBox[{"J", "=", 
    RowBox[{
     SubscriptBox["dx", "i"], "/", 
     SubscriptBox["d\[Xi]", "j"]}]}], TraditionalForm]]],
 ":"
}], "Subsection",
 CellChangeTimes->{{3.7171706589407587`*^9, 3.717170706016591*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"J", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"x", ",", "\[Xi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"x", ",", "\[Psi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"x", ",", "\[Zeta]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"y", ",", "\[Xi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"y", ",", "\[Psi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"y", ",", "\[Zeta]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"z", ",", "\[Xi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"z", ",", "\[Psi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"z", ",", "\[Zeta]"}], "]"}]}], "}"}]}], "}"}]}], ")"}], "//",
   "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.717159400798109*^9, 3.717159402472238*^9}, {
   3.7171594670820827`*^9, 3.717159481884482*^9}, {3.717159528167789*^9, 
   3.7171595453911543`*^9}, 3.717159782011516*^9, {3.7173677887268276`*^9, 
   3.7173678325554037`*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"x1", "-", "x4"}], 
      RowBox[{"x2", "-", "x4"}], 
      RowBox[{"x3", "-", "x4"}]},
     {
      RowBox[{"y1", "-", "y4"}], 
      RowBox[{"y2", "-", "y4"}], 
      RowBox[{"y3", "-", "y4"}]},
     {
      RowBox[{"z1", "-", "z4"}], 
      RowBox[{"z2", "-", "z4"}], 
      RowBox[{"z3", "-", "z4"}]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.7167614354761105`*^9, 3.716765302982686*^9, 3.7171556785772953`*^9, 
   3.717157543718261*^9, 3.717159484292647*^9, 3.717159565326777*^9, 
   3.717159783432115*^9, 3.717354900932816*^9, 3.7173678516174393`*^9, 
   3.717417860423373*^9, 3.720268227067238*^9, 3.720806396391696*^9, 
   3.7209936838639107`*^9, 3.721061216314333*^9, 3.723054595524909*^9, 
   3.7230546313224325`*^9, 3.723504448044764*^9, 3.7239811360514584`*^9, {
   3.7284300552303286`*^9, 3.7284300734023075`*^9}, 3.7404279872756085`*^9, 
   3.763392391210548*^9, 3.764081528224759*^9, 3.7641637936038733`*^9, 
   3.764244461510044*^9, 3.7643520598062115`*^9, 3.7643697288044987`*^9, 
   3.7644120239119453`*^9, 3.8490126203631067`*^9, 3.8503081183253813`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define the determinant of the Jacobian:", "Subsection",
 CellChangeTimes->{{3.717170742514415*^9, 3.71717075277886*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"detj", "=", 
   RowBox[{"Det", "[", "J", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{3.717157550322625*^9, 3.71741786843908*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define the inverse of the Jacobian:", "Subsection",
 CellChangeTimes->{{3.7171707115541143`*^9, 3.71717072339587*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvJ", " ", "=", " ", 
   RowBox[{"Simplify", "[", " ", 
    RowBox[{"Inverse", "[", "J", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.7167614674219794`*^9, 3.716762132096217*^9, 3.717157545859642*^9, 
   3.7173678815154886`*^9, {3.7173685526975317`*^9, 3.717368591121168*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Define the derivative of the basis function wrt parent coordinates, ",
 Cell[BoxData[
  FormBox[
   RowBox[{"d\[Phi]", "/", 
    SubscriptBox["d\[Xi]", "i"]}], TraditionalForm]]],
 ", and wrt physical coordinates, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"d\[Phi]", "/", 
     SubscriptBox["dx", "i"]}], "=", 
    RowBox[{"(", 
     RowBox[{"d\[Phi]", "/", 
      SubscriptBox["d\[Xi]", "k"]}]}]}], TraditionalForm]]],
 ")( ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["d\[Xi]", "k"], "/", 
    SubscriptBox["dx", "i"]}], TraditionalForm]]],
 "):"
}], "Subsection",
 CellChangeTimes->{{3.717170774772771*^9, 3.7171709274438047`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"D\[Phi]D\[Xi]", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"\[Phi]s", ",", "\[Xi]"}], "]"}], ",", 
      RowBox[{"D", "[", 
       RowBox[{"\[Phi]s", ",", "\[Psi]"}], "]"}], ",", 
      RowBox[{"D", "[", 
       RowBox[{"\[Phi]s", ",", "\[Zeta]"}], "]"}]}], "}"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.716762040827201*^9, 3.7167620550573683`*^9}, {
   3.7167622782753077`*^9, 3.7167622879320135`*^9}, {3.717159585262508*^9, 
   3.7171596049010277`*^9}, 3.717170767862856*^9, {3.7173679090158405`*^9, 
   3.7173679140631857`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"D\[Phi]Dx", "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"D\[Phi]D\[Xi]", ".", "InvJ"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7167620697517557`*^9, 3.7167621221822166`*^9}, {
  3.7167623794326005`*^9, 3.7167624191349125`*^9}, {3.717159618780408*^9, 
  3.717159620088848*^9}, {3.7171599769229116`*^9, 3.717159996771841*^9}, {
  3.717170940753901*^9, 3.7171709490170727`*^9}, {3.7171709936534357`*^9, 
  3.717171005961763*^9}, {3.7173600965536957`*^9, 3.717360100742365*^9}, {
  3.7173685313367987`*^9, 3.7173685371065826`*^9}, {3.7173686082063704`*^9, 
  3.717368609587582*^9}, {3.717417891626897*^9, 3.717417893049127*^9}, {
  3.8490126288393993`*^9, 3.849012630469943*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define the gradient matrix:", "Subsection",
 CellChangeTimes->{{3.7171710170541*^9, 3.717171027281568*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"B", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0"}], "}"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "=", "D\[Phi]Dx"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zeros", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Nb", "=", 
   RowBox[{"{", 
    RowBox[{
    "\[Phi]s", ",", "\[Phi]s", ",", "\[Phi]s", ",", "zeros", ",", "zeros", 
     ",", "zeros"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7173602746482644`*^9, 3.717360595407016*^9}, {
  3.7173679545623984`*^9, 3.717368016994071*^9}, {3.7173686738090096`*^9, 
  3.7173688008877954`*^9}, {3.717369134558451*^9, 3.7173691870734324`*^9}, {
  3.717415750201002*^9, 3.7174157973412743`*^9}, {3.7174158656066456`*^9, 
  3.717415993127372*^9}, {3.7174178972678013`*^9, 3.717417921642746*^9}, {
  3.7633923206598988`*^9, 3.7633923613791695`*^9}, {3.7633966157541084`*^9, 
  3.763396628163429*^9}, {3.7633967128971925`*^9, 3.7633967314679966`*^9}, {
  3.763398562028678*^9, 3.7633986048635654`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define a stiffness tensor:", "Subsection",
 CellChangeTimes->{{3.717171037170329*^9, 3.717171055154701*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"(", 
   RowBox[{"S", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], 
         RowBox[{"(", 
          RowBox[{"1", "-", "vv"}], ")"}]}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", "0", ",",
         "0", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", "vv"}], ")"}]}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", "0", ",",
         "0", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", "vv"}], ")"}]}], ",", "0", ",", "0", ",", "0"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "vv"}]}], ")"}]}], ",", "0", ",", "0"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "vv"}]}], ")"}]}], ",", "0"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "vv"}]}], ")"}]}]}], "}"}]}], "}"}]}], ")"}], "//",
   "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{"eps", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Epsilon]11", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "\[Epsilon]11", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "\[Epsilon]33"}], "}"}]}], "}"}]}], ")"}], 
  "//", "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{"piezo", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "e15", ",", "0"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "e15", ",", "0", ",", "0"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"e31", ",", "e31", ",", "e33", ",", "0", ",", "0", ",", "0"}], 
       "}"}]}], "}"}]}], ")"}], "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.7167628480497184`*^9, 3.716762972237756*^9}, {
   3.716763132980883*^9, 3.7167631890087504`*^9}, {3.717157475771058*^9, 
   3.717157528260871*^9}, {3.7174160414866905`*^9, 3.717416148690319*^9}, 
   3.7633924265623446`*^9, 3.763392465685731*^9, {3.763393084507081*^9, 
   3.7633930846862936`*^9}, {3.764412055711609*^9, 3.76441208309009*^9}, {
   3.764412639292594*^9, 3.7644126681929197`*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      FractionBox[
       RowBox[{"kv", " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "vv"}], ")"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0", "0"},
     {
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "vv"}], ")"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0", "0"},
     {
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "vv"}], ")"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0", "0"},
     {"0", "0", "0", 
      FractionBox["kv", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0"},
     {"0", "0", "0", "0", 
      FractionBox["kv", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0"},
     {"0", "0", "0", "0", "0", 
      FractionBox["kv", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.7644126409813614`*^9, 3.7644126698093233`*^9}, 
   3.849012637627226*^9, 3.850308130794861*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\[Epsilon]11", "0", "0"},
     {"0", "\[Epsilon]11", "0"},
     {"0", "0", "\[Epsilon]33"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.7644126409813614`*^9, 3.7644126698093233`*^9}, 
   3.849012637627226*^9, 3.850308130796336*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "0", "0", "0", "e15", "0"},
     {"0", "0", "0", "e15", "0", "0"},
     {"e31", "e31", "e33", "0", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.7644126409813614`*^9, 3.7644126698093233`*^9}, 
   3.849012637627226*^9, 3.8503081307969837`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Define the local stiffness matrix (Note that the absolute value of the \
Jacobian determinant is used.  The mesh from omega_h can have inside out \
elements.):\
\>", "Subsection",
 CellChangeTimes->{{3.7171710837254143`*^9, 3.717171091066893*^9}, {
  3.7174287074048176`*^9, 3.7174287551552706`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Kmm", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", "B"}], ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KmmmNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", "B"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KmmNoAbs", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", "B"}], ")"}], 
    "detj"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Detj", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
    "]"}], "=", "detj"}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Gmatrix", "[", 
     RowBox[{
     "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
      "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
     "]"}], "=", "B"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ktt", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Epsilon]11_", ",", "\[Epsilon]33_", ",", "\[Alpha]_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"-", 
     SuperscriptBox["\[Alpha]", "2"]}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "b", "]"}], ".", "eps", ".", "b"}], ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kttNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Epsilon]11_", ",", "\[Epsilon]33_", ",", "\[Alpha]_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"-", 
     SuperscriptBox["\[Alpha]", "2"]}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "b", "]"}], ".", "eps", ".", "b"}], ")"}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"kttNoAbs", "[", 
     RowBox[{
     "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
      "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
      "\[Epsilon]11_", ",", "\[Epsilon]33_", ",", "\[Alpha]_"}], "]"}], "=", 
    RowBox[{
     RowBox[{"-", 
      SuperscriptBox["\[Alpha]", "2"]}], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Transpose", "[", "b", "]"}], ".", "eps", ".", "b"}], ")"}], 
     "detj"}]}], " ", ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kmt", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "e31_", ",", "e33_", ",", "e15_", ",", "\[Alpha]_"}], "]"}], "=", 
   RowBox[{"\[Alpha]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", 
      RowBox[{"Transpose", "[", "piezo", "]"}], ".", " ", "b"}], ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kmtNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "e31_", ",", "e33_", ",", "e15_", ",", "\[Alpha]_"}], "]"}], "=", 
   RowBox[{"\[Alpha]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", 
      RowBox[{"Transpose", "[", "piezo", "]"}], ".", " ", "b"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"kmtNoAbs", "[", 
     RowBox[{
     "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
      "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
      "e31_", ",", "e33_", ",", "e15_", ",", "\[Alpha]_"}], "]"}], "=", 
    RowBox[{"\[Alpha]", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Transpose", "[", "B", "]"}], ".", 
       RowBox[{"Transpose", "[", "piezo", "]"}], ".", "b"}], ")"}], 
     "detj"}]}], " ", ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ktm", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "e31_", ",", "e33_", ",", "e15_", ",", "\[Alpha]_"}], "]"}], "=", 
   RowBox[{"\[Alpha]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "b", "]"}], ".", "piezo", ".", " ", "B"}], 
     ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ktmNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "e31_", ",", "e33_", ",", "e15_", ",", "\[Alpha]_"}], "]"}], "=", 
   RowBox[{"\[Alpha]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "b", "]"}], ".", "piezo", ".", " ", "B"}], 
     ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ktmNoAbs", "[", 
     RowBox[{
     "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
      "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
      "e31_", ",", "e33_", ",", "e15_", ",", "\[Alpha]_"}], "]"}], "=", 
    RowBox[{"\[Alpha]", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Transpose", "[", "b", "]"}], ".", "piezo", ".", "B"}], ")"}], 
     "detj"}]}], " ", ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gmatrix", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
    "]"}], "=", "b"}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdym9IE3EAh/G11EhNwlkn0028bem0dGpZkBUHKyzXyC0oRwmtTk9UrHxT
WHuhVCBlmfgX3MQWezeqVShaL0pRh9NcWmm0QsXSOweKle3N+n3vxcPnzZNq
rTGxUolEkkaChuZNt/Y5zxSFXa9g15bwGMzdTnlh8O/UNFTcfD0Lr/yqUqwQ
vTOtosO179OhLEOmhbYidTY8031Q9DS9WAL300MWKFBtdu4Fz6x2HnNA//HC
uxXEhSF5IzxrPt9ZSYz71C+6W3kiKfMNz3DJq6K2utBh2NTeUgDjs5YuwHVd
80U4mvekGtLusmvQOHnuKZT7Qi7x79q6HPmWZ3ooPggDHS1UFLGtQ5YIM8fL
VWbiYvq0Gl4+ah/9TQzPJnihvnhbljxaYFjdvXz45919PXTqpSdhhuuxKYmY
r4u0wNrbI5vwy9qzEJxLcIShUTshemNuZ3wycd6YmggbzXkSBdFQwEbBn8MD
bFWMwHz9/pmDgwFDDdyr4a7Cl6o7dGyswBwqfqCFHrZsH4w7ZT0C160BC/yw
0XQJ/tjRWw5L/epqOJ7Sdx32ar7Z4L9HI/Ww7uGeBuj3UHbo/uhzQmf7YMQu
YkSlKgYKpgNKqGxd0cAU660cWBgcy4XzFTM+ikj7PZPwPyT8I44=
  "]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gp", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "4"}], ",", 
     RowBox[{"1", "/", "4"}], ",", 
     RowBox[{"1", "/", "4"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gw", "=", 
   RowBox[{"1", "/", "6"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.720277340993009*^9, 3.72027737961343*^9}, {
  3.7202774283513937`*^9, 3.7202774293658648`*^9}, {3.720278067092781*^9, 
  3.720278074392303*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Nbody", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
    "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"\[Phi]s", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Xi]", "\[Rule]", 
         RowBox[{"gp", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"\[Psi]", "\[Rule]", 
         RowBox[{"gp", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", 
        RowBox[{"\[Zeta]", "\[Rule]", 
         RowBox[{"gp", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], ")"}], " ", "detj"}]}],
   ";"}]], "Input",
 CellChangeTimes->{{3.720276857562365*^9, 3.72027689050346*^9}, {
   3.720276933199112*^9, 3.7202769367774963`*^9}, {3.72027697666714*^9, 
   3.720277021013089*^9}, {3.720277389298491*^9, 3.720277419388343*^9}, 
   3.7633940537917767`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Define the mesh.  This mesh is produced by the build_box function in Omega_h.\
\>", "Subsection",
 CellChangeTimes->{{3.717171103353293*^9, 3.71717112863015*^9}, {
  3.7171711761508427`*^9, 3.717171184346429*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"connect", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "12", ",", "3", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "3", ",", "4", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "4", ",", "1", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "10", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "10", ",", "9", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "9", ",", "12", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "13", ",", "4", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4", ",", "5", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "5", ",", "2", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "11", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "11", ",", "10", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "10", ",", "13", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "15", ",", "6", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "6", ",", "7", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "7", ",", "4", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4", ",", "13", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "13", ",", "12", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "12", ",", "15", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "16", ",", "7", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "7", ",", "8", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "8", ",", "5", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "5", ",", "14", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "14", ",", "13", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "13", ",", "16", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "21", ",", "12", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "12", ",", "13", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "13", ",", "10", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "10", ",", "19", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "19", ",", "18", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "18", ",", "21", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "22", ",", "13", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "13", ",", "14", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "14", ",", "11", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "11", ",", "20", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "20", ",", "19", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "19", ",", "22", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "24", ",", "15", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "15", ",", "16", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "16", ",", "13", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "13", ",", "22", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "22", ",", "21", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "21", ",", "24", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "25", ",", "16", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "16", ",", "17", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "17", ",", "14", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "14", ",", "23", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "23", ",", "22", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "22", ",", "25", ",", "26"}], "}"}]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7174169577864523`*^9, 3.7174169658023443`*^9}, 
   3.717417651397601*^9, {3.76409786087125*^9, 3.7640978639703207`*^9}, {
   3.7640978943425765`*^9, 3.7640978954822354`*^9}, {3.849008712370339*^9, 
   3.8490087306012497`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"xv", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", 
     ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5", ",", "0.5", ",", "0.5", ",", "0.5", ",", "0.5", 
     ",", "0.5", ",", "0.5"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yv", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zv", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7174174700232644`*^9, 3.7174174845856824`*^9}, {
  3.717417517163823*^9, 3.717417642288141*^9}, {3.7210467593944297`*^9, 
  3.7210467621477776`*^9}, {3.849008737603016*^9, 3.8490087975493383`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Rho]v", "=", 
  RowBox[{"Table", "[", 
   RowBox[{"1.0", ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "xv", "]"}]}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7209938116705494`*^9, 3.7209938528649826`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`"}], "}"}]], "Output",
 CellChangeTimes->{3.7209938545509453`*^9, 3.7210612745209227`*^9, 
  3.723054679712879*^9, 3.72350454129504*^9, 3.7239811528858366`*^9, 
  3.7284300924333024`*^9, 3.7404280094843683`*^9, 3.7633940799093127`*^9, 
  3.764081557678941*^9, 3.7641638161742373`*^9, 3.7642444821928463`*^9, 
  3.7643520906318407`*^9, 3.764369779082593*^9, 3.7644135014278617`*^9, 
  3.849012652033149*^9, 3.8503081464832077`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"uv", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"4", "*", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "0"}], ",", 
   RowBox[{"i", "<", 
    RowBox[{"Length", "[", "xv", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "1"}], "]"}], "]"}], "=", 
     RowBox[{"1.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "2"}], "]"}], "]"}], "=", 
     RowBox[{"2.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "3"}], "]"}], "]"}], "=", 
     RowBox[{"3.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "4"}], "]"}], "]"}], "=", 
     RowBox[{"4.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7210466573505106`*^9, 3.721046659816079*^9}, {
  3.721046777601693*^9, 3.721046848873374*^9}, {3.763394142897538*^9, 
  3.763394168547328*^9}, {3.7641026246306195`*^9, 3.7641026375151596`*^9}, {
  3.764102795449109*^9, 3.764102980220702*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Assemble the global stiffness:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gaussWeight", "=", 
   RowBox[{"1", "/", "6"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nnodes", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nmdofs", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ntdofs", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndofs", "=", 
   RowBox[{"nmdofs", "+", "ntdofs"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndofsTotal", "=", 
   RowBox[{"ndofs", " ", 
    RowBox[{"Length", "[", "xv", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.717166271741476*^9, 3.71716629726234*^9}, {
  3.717423563398694*^9, 3.717423566476555*^9}, {3.717424308471903*^9, 
  3.717424318282713*^9}, {3.7174279410435295`*^9, 3.717427953121283*^9}, {
  3.720806567996297*^9, 3.7208066398399677`*^9}, {3.7633996837483525`*^9, 
  3.763399728831224*^9}, {3.7640829218072453`*^9, 3.7640829235916023`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Kglobal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "ndofsTotal"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "ndofsTotal"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"Kmm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"ndofs", " ", "nnodes"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"k", "=", "1"}], ",", 
          RowBox[{"k", "\[LessEqual]", 
           RowBox[{"ndofs", " ", "nnodes"}]}], ",", 
          RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Kglobal", "[", 
              RowBox[{"[", 
               RowBox[{"ids", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", "j", "]"}], "]"}], "[", 
             RowBox[{"[", "k", "]"}], "]"}]}], ";"}]}], "]"}]}], "]"}]}]}], 
    "]"}]}], "]"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdz31QE3QcBvA5iMimQAV6LIjlyyRSiTcBBzHdTRqbLBCsiUDrzRDkoAHL
OgU0JMdImAOGnqGhjdeA4l3e1lLk8I5DD4HtOuhIZUNeOpxilP2e3x/f+9zz
x/PcfTny9JhPmQwGI5Yc1M26qN5qtvKVTvpi6F66TgMD9r2jhQ47HSrh70Fv
XIRSdkAzLPX36Yctrn8Y4bj11g0o7LG7CwXq/2bhTN3SAqwTXlmCuexbNnh7
5PIT+NFi9Ys+RM90JguOabOcocQY5wsDBVnhMEV8WADd6uTR0BR7VAq1WnEi
bLp3mOqQNimHId0ZqdA8rlDA5RpFNvRp3auGeSH5xXDHh0WlUHzNqwKe5wVm
zGJPVZ0JNZ1bcmAXv0sJ2yJUNtg49g/TQuzpGHKA9yc4L8F26fZXoeGJZgNc
WG/LhUV9Od/CgFChbp74W145NdL/3cYF4kFlUjP8sTGiDX5lJ6A6Rx2fgLFn
vE3w+Iqz4yKRUVJJ3ZthSoHLZbJUyFVy1ywReSNV1ASj/GdRi5WfHBbcBGUe
Fb2wwswdgOeltvtwa0HgA/j85iaPKKJQNOAF797u3Az/HnbdAnknz2nF6LOj
y+BZXcEFaPEQVEF79o1f4UxleDsUX54fgNkcRwN8Jq1XS4ieMfJiWNbtooPf
iGqpTzu9P/iCeER1Uw6ZLtX50Fc4fBqGROrUUD94oQLW1x5xTyFmesexYeEO
vRd86r2RA9/0PJSfSvz8lz+pXaeStDC3tfUHyHi8MekY/nqkToaOaaFKKLbo
qXtK0rymOsieOYgDkzsTw316rPzp8VHq0Jn3Vl9fO8fPvtTxL1zp3cn1IC73
bd4OX/lL7w93dzdQq3rsQ+EBwWgEbNM8TIRFrswk6P780ddwm9X9BKzlGAvh
BO/6JehnKKmGrBy3q3BGxaqBL2yYuw7tm1YNsHzoxDB0fpA+AvOm4ieh7HHM
FGTYzU7Dz0bftsBn5ZIF6DTVt+noy3P8PeZVapTkdFYq8WJmWjb8nvnwLPTM
yj8HE/p9RceIg0u7qPfGWvbDyfcN1K0NvXGwIs8SD8MKFCnwzsEG6rU1h65k
EltXCqj7mww1sND3DtXFOG/3JdG8eJUFnT4ukiqI/V2yWCgObtewWHP8ANM+
HYyW1e92JQp3BYVB0TSXDye+00rgoG3dATgS7BcPT2bwEiBrrZsf/EkbaeIQ
W7ZZzHD9a44zNH8ioP4Pt/KOXQ==
  "]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Join", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "0"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "1"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "3"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "4"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7641008499440265`*^9, 3.7641009191912155`*^9}, {
  3.764100982438418*^9, 3.764100994727434*^9}, {3.764101178024066*^9, 
  3.7641012178500237`*^9}, {3.849012603276866*^9, 3.849012607553247*^9}, {
  3.8503081602948627`*^9, 3.85030817606853*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "3.5256410256410247802734375`18.*^10", ",", "0", ",", "0", ",", "0", ",", 
   "0", ",", "3.5256410256410247802734375`18.*^10", ",", "0", ",", "0", ",", 
   "0", ",", "0", ",", "3.5256410256410247802734375`18.*^10", ",", 
   "6.73333333333333282470703125`18.*^10", ",", "0", ",", "0", ",", 
   "6.73333333333333282470703125`18.*^10", ",", 
   RowBox[{"-", "5.6666666666666660308837890625`18.*^9"}], ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", "0", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "1.025`18.*^10", ",", "0", 
   ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "1.025`18.*^10", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   RowBox[{"-", "2.2435897435897430419921875`18.*^10"}], ",", 
   RowBox[{"-", "2.6333333333333332061767578125`18.*^10"}], ",", 
   RowBox[{"-", "4.5`18.*^9"}], ",", 
   RowBox[{"-", "4.5`18.*^9"}], ",", 
   RowBox[{"-", "2.6333333333333332061767578125`18.*^10"}], ",", 
   "2.3333333333333330154418945313`18.*^9", ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "0", ",", "0", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   RowBox[{"-", "2.2435897435897430419921875`18.*^10"}], ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   RowBox[{"-", "4.5`18.*^9"}], ",", "0", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", 
   RowBox[{"-", "2.05`18.*^10"}], ",", "0", ",", "1.025`18.*^10", ",", 
   RowBox[{"-", "2.05`18.*^10"}], ",", 
   "1.6666666666666665077209472656`18.*^9", ",", "0", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "1.025`18.*^10", ",", 
   "4.8076923076923065185546875`18.*^9", ",", "0", ",", 
   RowBox[{"-", "8.0128205128205108642578125`18.*^9"}], ",", 
   RowBox[{"-", "5.75`18.*^9"}], ",", "4.8076923076923065185546875`18.*^9", 
   ",", 
   RowBox[{"-", "8.0128205128205108642578125`18.*^9"}], ",", "0", ",", "0", 
   ",", 
   RowBox[{"-", "4.5`18.*^9"}], ",", 
   RowBox[{"-", "5.75`18.*^9"}], ",", "0", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{
  3.7641009213624554`*^9, 3.764100995781635*^9, 3.764101184303155*^9, 
   3.7641012190423956`*^9, {3.7641017730569844`*^9, 3.764101791077053*^9}, 
   3.7642444926062255`*^9, 3.7643521038190885`*^9, 3.7643697931429815`*^9, 
   3.764431275703825*^9, 3.7644366396593423`*^9, 3.8490126090964127`*^9, 
   3.849012662022365*^9, 3.850308182492661*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute residual:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210554397242594`*^9, 3.7210554438131027`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cellResidual", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "16"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"residual", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"ndofs", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"KmmNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kttNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmtNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktmNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"resid", "=", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Klocal", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cellResidual", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "=", "resid"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "16"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"residual", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{"resid", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "16"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"residual", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "-=", 
            RowBox[{"resid", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.721055446475813*^9, 
   3.7210554769975753`*^9}, {3.7210555442260976`*^9, 3.721055585763404*^9}, {
   3.7230547784118013`*^9, 3.7230547844740324`*^9}, {3.7230580841467104`*^9, 
   3.7230581803982973`*^9}, {3.7230585213381877`*^9, 3.723058522399741*^9}, {
   3.723515313727868*^9, 3.7235153825857706`*^9}, {3.7236621698838377`*^9, 
   3.7236621717519226`*^9}, {3.7236622124923797`*^9, 3.723662227510171*^9}, 
   3.7236622603736763`*^9, {3.723662501164076*^9, 3.7236625138790245`*^9}, 
   3.7236636246400113`*^9, {3.7236636643397217`*^9, 3.7236636653317575`*^9}, {
   3.723664443286131*^9, 3.723664465914736*^9}, {3.7236645478013163`*^9, 
   3.723664550184022*^9}, {3.7236649087859735`*^9, 3.723664911863844*^9}, {
   3.7642548499337397`*^9, 3.7642548561514874`*^9}, {3.7642548909189143`*^9, 
   3.7642549502424526`*^9}, {3.764255000130916*^9, 3.764255033148587*^9}, {
   3.7643520295878253`*^9, 3.7643520409484105`*^9}, {3.7643521412661023`*^9, 
   3.764352149703657*^9}, {3.7644376067349405`*^9, 3.764437649295827*^9}, {
   3.764437888731969*^9, 3.7644379054168196`*^9}, {3.7644575275491123`*^9, 
   3.764457543099883*^9}, {3.7644576779925795`*^9, 3.764457681289163*^9}, {
   3.7644587633701134`*^9, 3.7644587681978855`*^9}, {3.764459448625661*^9, 
   3.764459448691424*^9}, {3.764460637528623*^9, 3.764460641099046*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"residual", ",", "16"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}, {3.7210555900106316`*^9, 
  3.7210555918891406`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "130456.41025641025044023990631103515625`16."}], ",", 
   RowBox[{"-", "66512.8205128205008804798126220703125`16."}], ",", 
   RowBox[{"-", "155087.17948717947001568973064422607421875`16."}], ",", 
   RowBox[{"-", "65416.6666666666642413474619388580322265625`16."}], ",", 
   RowBox[{"-", "58061.538461538424598984420299530029296875`16."}], ",", 
   RowBox[{"-", "52292.3076923076660023070871829986572265625`16."}], ",", 
   RowBox[{"-", "185100.`16."}], ",", 
   RowBox[{"-", "107925.`16."}], ",", 
   "72394.87179487178218550980091094970703125`16.", ",", 
   "14220.51282051283305918332189321517944335937`16.", ",", 
   RowBox[{"-", "30012.820512820515432395040988922119140625`16."}], ",", 
   RowBox[{"-", "42508.3333333333357586525380611419677734375`16."}], ",", 
   RowBox[{"-", "175492.3076923076878301799297332763671875`16."}], ",", 
   RowBox[{"-", "67669.230769230765872634947299957275390625`16."}], ",", 
   RowBox[{"-", "185153.846153846126981079578399658203125`16."}], ",", 
   RowBox[{"-", "67300.`16."}], ",", 
   RowBox[{"-", "75738.461538461488089524209499359130859375`16."}], ",", 
   RowBox[{"-", "40384.6153846153683844022452831268310546875`16."}], ",", 
   RowBox[{"-", "275246.153846153873018920421600341796875`16."}], ",", 
   RowBox[{"-", "154200.00000000002910383045673370361328125`16."}], ",", 
   "99753.846153846141532994806766510009765625`16.", ",", 
   "27284.61538461537929833866655826568603515625`16.", ",", 
   RowBox[{"-", "90092.307692307702382095158100128173828125`16."}], ",", 
   RowBox[{"-", "86899.99999999997089616954326629638671875`16."}], ",", 
   RowBox[{"-", "45035.8974358974301139824092388153076171875`16."}], ",", 
   RowBox[{"-", "1156.41025641026135417632758617401123046875`16."}], ",", 
   RowBox[{"-", "30066.6666666666787932626903057098388671875`16."}], ",", 
   RowBox[{"-", "1883.33333333333757764194160699844360351562`16."}], ",", 
   RowBox[{"-", "17676.92307692305985256098210811614990234375`16."}], ",", 
   "11907.69230769231035083066672086715698242188`16.", ",", 
   RowBox[{"-", "90146.15384615384391508996486663818359375`16."}], ",", 
   RowBox[{"-", "46275.000000000014551915228366851806640625`16."}], ",", 
   "27358.97435897435570950619876384735107421875`16.", ",", 
   "13064.10256410257170500699430704116821289063`16.", ",", 
   RowBox[{"-", "60079.4871794871651218272745609283447265625`16."}], ",", 
   RowBox[{"-", "44391.66666666665696538984775543212890625`16."}], ",", 
   RowBox[{"-", "157815.3846153845661319792270660400390625`16."}], ",", 
   RowBox[{"-", "79576.9230769230634905397891998291015625`16."}], ",", 
   RowBox[{"-", "95007.69230769228306598961353302001953125`16."}], ",", 
   RowBox[{"-", "21025.00000000001091393642127513885498046875`16."}], ",", 
   RowBox[{"-", "40384.6153846154338680207729339599609375`16."}], ",", 
   RowBox[{"-", "64199.99999999997089616954326629638671875`16."}], ",", 
   RowBox[{"-", "94953.84615384609787724912166595458984375`16."}], ",", 
   RowBox[{"-", "61649.999999999956344254314899444580078125`16."}], ",", 
   "117430.769230769234127365052700042724609375`16.", ",", 
   "15376.92307692311078426428139209747314453125`16.", ",", 
   "53.84615384615608491003513336181640625`16.", ",", 
   RowBox[{"-", "40625.00000000002910383045673370361328125`16."}], ",", 
   RowBox[{"-", "275246.1538461538148112595081329345703125`16."}], ",", 
   RowBox[{"-", "94953.846153846141532994806766510009765625`16."}], ",", 
   RowBox[{"-", "95061.538461538395495153963565826416015625`16."}], ",", 
   "19599.99999999991632648743689060211181640625`16.", ",", 
   "1.818989403545856475830078125`16.*^-11", ",", 
   "6.54836185276508331298828125`16.*^-11", ",", 
   RowBox[{"-", "1.382431946694850921630859375`16.*^-10"}], ",", 
   "7.2759576141834259033203125`16.*^-12", ",", 
   "275246.153846153873018920421600341796875`16.", ",", 
   "94953.84615384609787724912166595458984375`16.", ",", 
   "95061.5384615384973585605621337890625`16.", ",", 
   RowBox[{"-", "19600.0000000001091393642127513885498046875`16."}], ",", 
   RowBox[{"-", "117430.769230769205023534595966339111328125`16."}], ",", 
   RowBox[{"-", "15376.92307692303074873052537441253662109375`16."}], ",", 
   RowBox[{"-", "53.8461538461488089524209499359130859375`16."}], ",", 
   "40624.9999999999636202119290828704833984375`16.", ",", 
   "40384.615384615390212275087833404541015625`16.", ",", 
   "64200.0000000000072759576141834259033203125`16.", ",", 
   "94953.84615384638891555368900299072265625`16.", ",", 
   "61649.999999999898136593401432037353515625`16.", ",", 
   "157815.38461538459523580968379974365234375`16.", ",", 
   "79576.9230769230634905397891998291015625`16.", ",", 
   "95007.692307692181202583014965057373046875`16.", ",", 
   "21024.9999999999345163814723491668701171875`16.", ",", 
   RowBox[{"-", "27358.9743589743666234426200389862060546875`16."}], ",", 
   RowBox[{"-", "13064.1025641025407821871340274810791015625`16."}], ",", 
   "60079.48717948715784586966037750244140625`16.", ",", 
   "44391.666666666671517305076122283935546875`16.", ",", 
   "17676.9230769231144222430884838104248046875`16.", ",", 
   RowBox[{"-", "11907.6923076922757900319993495941162109375`16."}], ",", 
   "90146.15384615378570742905139923095703125`16.", ",", 
   "46274.999999999883584678173065185546875`16.", ",", 
   "45035.8974358974373899400234222412109375`16.", ",", 
   "1156.4102564102577161975204944610595703125`16.", ",", 
   "30066.666666666671517305076122283935546875`16.", ",", 
   "1883.33333333336122450418770313262939453125`16.", ",", 
   RowBox[{"-", "99753.846153846126981079578399658203125`16."}], ",", 
   RowBox[{"-", "27284.615384615361108444631099700927734375`16."}], ",", 
   "90092.30769230760051868855953216552734375`16.", ",", 
   "86899.99999999997089616954326629638671875`16.", ",", 
   "75738.4615384615608491003513336181640625`16.", ",", 
   "40384.6153846154556958936154842376708984375`16.", ",", 
   "275246.153846153873018920421600341796875`16.", ",", 
   "154199.99999999985448084771633148193359375`16.", ",", 
   "175492.30769230765872634947299957275390625`16.", ",", 
   "67669.23076923078042455017566680908203125`16.", ",", 
   "185153.8461538460687734186649322509765625`16.", ",", 
   "67300.0000000000582076609134674072265625`16.", ",", 
   RowBox[{"-", "72394.87179487175308167934417724609375`16."}], ",", 
   RowBox[{"-", "14220.5128205128057743422687053680419921875`16."}], ",", 
   "30012.8205128204426728188991546630859375`16.", ",", 
   "42508.333333333299378864467144012451171875`16.", ",", 
   "58061.538461538482806645333766937255859375`16.", ",", 
   "52292.3076923076951061375439167022705078125`16.", ",", 
   "185099.99999999997089616954326629638671875`16.", ",", 
   "107924.999999999927240423858165740966796875`16.", ",", 
   "130456.410256410235888324677944183349609375`16.", ",", 
   "66512.82051282047177664935588836669921875`16.", ",", 
   "155087.17948717941180802881717681884765625`16.", ",", 
   "65416.666666666729724965989589691162109375`16."}], "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.7210555991426263`*^9, 3.7230547896617746`*^9, 
  3.7230579422718954`*^9, 3.7230581894138665`*^9, 3.723058528369447*^9, 
  3.7284301451527777`*^9, 3.740428267702957*^9, 3.7642550522420435`*^9, 
  3.764352117130268*^9, 3.7643521540564356`*^9, 3.764369803328337*^9, 
  3.7644376579319143`*^9, 3.764437911096629*^9, 3.8490130155475063`*^9, 
  3.850308304758848*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute residual gradient wrt control:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210554397242594`*^9, 3.7210554438131027`*^9}, {
  3.721059980929894*^9, 3.72105998715461*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"residualGradient", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"4", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"Length", "[", "xv", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"nids", "=", 
        RowBox[{"{", 
         RowBox[{"i1", ",", "i2", ",", "i3", ",", "i4"}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"KmmNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kttNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmtNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktmNoAbs", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"resid", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Rho]1", "+", "\[Rho]2", "+", "\[Rho]3", "+", "\[Rho]4"}], 
         ")"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Klocal", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}], "/", 
         "4.0"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"d\[Rho]", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]4"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Rho]1", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]2", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]3", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]4", "\[Rule]", "1.0"}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "16"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "4"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"residualGradient", "[", 
                RowBox[{"[", 
                 RowBox[{"ids", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"nids", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "+=", 
              RowBox[{
               RowBox[{"d\[Rho]", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "16"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "4"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"residualGradient", "[", 
                RowBox[{"[", 
                 RowBox[{"ids", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"nids", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "-=", 
              RowBox[{
               RowBox[{"d\[Rho]", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.721055446475813*^9, 
   3.7210554769975753`*^9}, {3.7210555442260976`*^9, 3.721055585763404*^9}, {
   3.7230547784118013`*^9, 3.7230547844740324`*^9}, {3.7230580841467104`*^9, 
   3.7230581803982973`*^9}, {3.7230585213381877`*^9, 3.723058522399741*^9}, {
   3.723515313727868*^9, 3.7235153825857706`*^9}, {3.7236621698838377`*^9, 
   3.7236621717519226`*^9}, {3.7236622124923797`*^9, 3.723662227510171*^9}, 
   3.7236622603736763`*^9, {3.723662501164076*^9, 3.7236625138790245`*^9}, 
   3.7236636246400113`*^9, {3.7236636643397217`*^9, 3.7236636653317575`*^9}, {
   3.723664443286131*^9, 3.723664465914736*^9}, {3.7236645478013163`*^9, 
   3.723664550184022*^9}, {3.7236649087859735`*^9, 3.723664911863844*^9}, {
   3.7642548499337397`*^9, 3.7642548561514874`*^9}, {3.7642548909189143`*^9, 
   3.7642549502424526`*^9}, {3.764255000130916*^9, 3.764255033148587*^9}, {
   3.7643520295878253`*^9, 3.7643520409484105`*^9}, {3.7643521412661023`*^9, 
   3.764352149703657*^9}, {3.7643528854310064`*^9, 3.764352904073516*^9}, {
   3.764352941414873*^9, 3.764353069979911*^9}, {3.764366845191844*^9, 
   3.764366856703435*^9}, {3.7644380574402175`*^9, 3.764438075342404*^9}, {
   3.764456827989875*^9, 3.764456836332321*^9}, {3.764457038323409*^9, 
   3.764456431604704*^9}, {3.764456910005311*^9, 3.764456936726961*^9}, {
   3.7644573028240957`*^9, 3.76445731298518*^9}, {3.764457377342676*^9, 
   3.7644573809718103`*^9}, {3.7644575791003923`*^9, 
   3.7644575943245926`*^9}, {3.7644576445470095`*^9, 3.764457650693818*^9}, {
   3.7644578013990855`*^9, 3.764457906951537*^9}, {3.7644579384480114`*^9, 
   3.7644579481678953`*^9}, {3.764458202308829*^9, 3.7644582195171323`*^9}, {
   3.7644587043609915`*^9, 3.7644587260154333`*^9}, {3.7644595131989594`*^9, 
   3.764459539276085*^9}, {3.764459848755035*^9, 3.7644598554541826`*^9}, {
   3.7644602338020043`*^9, 3.7644603255215635`*^9}, {3.764460544721777*^9, 
   3.764460577606089*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"transposeResidGrad", "=", 
   RowBox[{"Transpose", "[", "residualGradient", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7643672034117346`*^9, 3.764367234235589*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Join", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "0"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "1"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "3"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "4"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7643531514936028`*^9, 3.7643531558462763`*^9}, {
   3.764353198654197*^9, 3.7643532501028695`*^9}, {3.7643602313882027`*^9, 
   3.764360302960787*^9}, 3.7643666855513444`*^9, 3.7643667533077087`*^9, {
   3.764367240159917*^9, 3.764367331564372*^9}, {3.764367379889902*^9, 
   3.764367551594491*^9}, {3.764367812262062*^9, 3.764367821166567*^9}, {
   3.8490130386061163`*^9, 3.8490130427035418`*^9}, {3.850308316679607*^9, 
   3.8503083208687983`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "32614.1025641025626100599765777587890625`18."}], ",", 
   RowBox[{"-", "16628.205128205125220119953155517578125`18."}], ",", 
   RowBox[{"-", "38771.7948717948675039224326610565185546875`18."}], ",", 
   RowBox[{"-", "16354.16666666666606033686548471450805664063`18."}], ",", 
   "18098.71794871794918435625731945037841796875`18.", ",", 
   "3555.12820512820508156437426805496215820312`18.", ",", 
   RowBox[{"-", "7503.20512820512976759346202015876770019531`18."}], ",", 
   RowBox[{"-", "10627.08333333333212067373096942901611328125`18."}], ",", 
   RowBox[{"-", "11258.97435897435752849560230970382690429688`18."}], ",", 
   RowBox[{"-", "289.10256410256374692835379391908645629883`18."}], ",", 
   RowBox[{"-", "7516.66666666666515084216371178627014160156`18."}], ",", 
   RowBox[{"-", "470.83333333333484915783628821372985839844`18."}], ",", 
   "6839.74358974358983687125146389007568359375`18.", ",", 
   "3266.02564102563974302029237151145935058594`18.", ",", 
   RowBox[{"-", "15019.87179487179309944622218608856201171875`18."}], ",", 
   RowBox[{"-", "11097.91666666666787932626903057098388671875`18."}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.76435329567939*^9, 3.764360304676647*^9, 3.764366754822819*^9, 
   3.764366861476902*^9, {3.764367529712575*^9, 3.7643675526795163`*^9}, 
   3.764367822471277*^9, 3.764369814616887*^9, 3.764438090771715*^9, 
   3.7644388134364114`*^9, 3.7644583458480034`*^9, 3.7644606113331347`*^9, 
   3.849013043671915*^9, {3.850308324357153*^9, 3.85030832904315*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute residual gradient wrt config:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210490655350704`*^9, 3.7210490675964766`*^9}, {
  3.7230551164809313`*^9, 3.7230551185900598`*^9}, {3.72391300931705*^9, 
  3.7239130109421873`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ndims", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"residualGradientX", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"ndofs", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"ndims", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"nids", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"KmmNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kttNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmtNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktmNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "13", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "14", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "15", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "16", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Klocal", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x1"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x2"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x3"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x4"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x5"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x6"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x7"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x8"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x9"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x10"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x11"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x12"}], "]"}]}], "}"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x1", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"x2", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"x3", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"x4", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
            RowBox[{"x5", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
            RowBox[{"x6", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
            RowBox[{"x7", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
            RowBox[{"x8", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
            RowBox[{"x9", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
            RowBox[{"x10", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
            RowBox[{"x11", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
            RowBox[{"x12", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}]}]}], "}"}]}], ")"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "16"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "12"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"residualGradientX", "[", 
                RowBox[{"[", 
                 RowBox[{"ids", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"nids", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "+=", 
              RowBox[{
               RowBox[{"du", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "k", "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "16"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "12"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"residualGradientX", "[", 
                RowBox[{"[", 
                 RowBox[{"ids", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"nids", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "-=", 
              RowBox[{
               RowBox[{"du", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "k", "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.7210490923010983`*^9, 
   3.7210491222796535`*^9}, {3.7210491757545376`*^9, 
   3.7210493138722425`*^9}, {3.721049409321796*^9, 3.721049640653741*^9}, 
   3.721049765856733*^9, {3.723055124450037*^9, 3.723055129574788*^9}, {
   3.723055292912021*^9, 3.7230553309253855`*^9}, {3.7230553941804533`*^9, 
   3.7230554578048472`*^9}, {3.723055525200883*^9, 3.723055731450719*^9}, {
   3.723055828378682*^9, 3.7230558285355997`*^9}, {3.7230559085505037`*^9, 
   3.7230559544567056`*^9}, {3.723056073457146*^9, 3.723056217017265*^9}, {
   3.723056712834525*^9, 3.7230568061937404`*^9}, {3.7230570373170767`*^9, 
   3.723057041598381*^9}, {3.7230574604717684`*^9, 3.7230574691597023`*^9}, {
   3.7230576687082634`*^9, 3.723057672733388*^9}, {3.723057739783541*^9, 
   3.7230577772921667`*^9}, {3.723057872614895*^9, 3.7230578808186064`*^9}, {
   3.7230582312110176`*^9, 3.723058233179638*^9}, {3.7230582693977594`*^9, 
   3.7230583084759116`*^9}, {3.723058342960322*^9, 3.7230583468666005`*^9}, {
   3.7230585527283564`*^9, 3.723058554150366*^9}, {3.7237578674536314`*^9, 
   3.7237579530367565`*^9}, {3.723758026886219*^9, 3.7237580298343897`*^9}, {
   3.723758446116063*^9, 3.723758490487317*^9}, {3.723758534943349*^9, 
   3.7237586467179585`*^9}, {3.723758714374293*^9, 3.723758764328038*^9}, {
   3.7238390044561663`*^9, 3.7238390130181665`*^9}, 3.7240064066196632`*^9, {
   3.7643699495811386`*^9, 3.7643700097311172`*^9}, {3.7643700923307257`*^9, 
   3.7643701215110984`*^9}, {3.764370151609213*^9, 3.764370166796838*^9}, {
   3.7643702106485834`*^9, 3.764370256220153*^9}, {3.7643703518034716`*^9, 
   3.7643704077886024`*^9}, {3.7643704667596483`*^9, 
   3.7643705262711377`*^9}, {3.764370689802438*^9, 3.76437076794914*^9}, {
   3.764438263094569*^9, 3.7644383296048117`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Join", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "0"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "1"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "3"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "4"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7404286333582754`*^9, 3.740428654853368*^9}, {
  3.7404290520183735`*^9, 3.740429084241135*^9}, {3.7404292209383698`*^9, 
  3.740429228261795*^9}, {3.740429300039175*^9, 3.740429335051546*^9}, {
  3.7404293828669925`*^9, 3.7404293919072895`*^9}, {3.7404294284083185`*^9, 
  3.740429432373372*^9}, {3.740429572932371*^9, 3.7404295929812984`*^9}, {
  3.7404296738800697`*^9, 3.74042969494425*^9}, {3.7404297512884207`*^9, 
  3.740429830968625*^9}, {3.7643705788999863`*^9, 3.764370604630294*^9}, {
  3.7643709839642286`*^9, 3.764371000964297*^9}, {3.764371055053582*^9, 
  3.7643710963249793`*^9}, {3.7643711690829134`*^9, 3.764371174572526*^9}, {
  3.764371212195264*^9, 3.764371237128933*^9}, {3.7643714163597193`*^9, 
  3.7643715060322227`*^9}, {3.849013163753903*^9, 3.849013169105527*^9}, {
  3.850309523311906*^9, 3.850309527542441*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "63461.5384615384391508996486663818359375`18."}], ",", 
   RowBox[{"-", "126923.076923076878301799297332763671875`18."}], ",", 
   RowBox[{"-", "675184.61538461525924503803253173828125`18."}], ",", 
   RowBox[{"-", "322800.`18."}], ",", 
   RowBox[{"-", "21153.8461538461488089524209499359130859375`18."}], ",", 
   RowBox[{"-", "42307.6923076922903419472277164459228515625`18."}], ",", 
   RowBox[{"-", "225061.538461538380943238735198974609375`18."}], ",", 
   RowBox[{"-", "107600.`18."}], ",", 
   RowBox[{"-", "7051.2820512820253497920930385589599609375`18."}], ",", 
   RowBox[{"-", "14102.5641025640870793722569942474365234375`18."}], ",", 
   RowBox[{"-", "75020.512820512740290723741054534912109375`18."}], ",", 
   RowBox[{"-", "35866.6666666666642413474619388580322265625`18."}], ",", 
   RowBox[{"-", "73771.794871794860227964818477630615234375`18."}], ",", 
   RowBox[{"-", "2135.89743589740464813075959682464599609375`18."}], ",", 
   "261758.97435897425748407840728759765625`18.", ",", 
   "76583.33333333334303461015224456787109375`18.", ",", 
   RowBox[{"-", "85756.410256410235888324677944183349609375`18."}], ",", 
   RowBox[{"-", "21812.820512820515432395040988922119140625`18."}], ",", 
   "66128.20512820509611628949642181396484375`18.", ",", 
   "29883.33333333331756875850260257720947265625`18.", ",", 
   "40705.1282051281887106597423553466796875`18.", ",", 
   "38141.025641025626100599765777587890625`18.", ",", 
   "156005.1282051281887106597423553466796875`18.", ",", 
   "79733.33333333334303461015224456787109375`18.", ",", 
   RowBox[{"-", "19230.76923076922321342863142490386962890625`18."}], ",", 
   RowBox[{"-", "37507.692307692297617904841899871826171875`18."}], ",", 
   "133256.41025641025044023990631103515625`18.", ",", 
   "94350.000000000014551915228366851806640625`18.", ",", 
   "115071.79487179484567604959011077880859375`18.", ",", 
   "39743.589743589735007844865322113037109375`18.", ",", 
   "178405.1282051281887106597423553466796875`18.", ",", 
   "83166.666666666671517305076122283935546875`18.", ",", 
   RowBox[{"-", "14102.56410256409435532987117767333984375`18."}], ",", 
   RowBox[{"-", "23189.74358974360438878647983074188232421875`18."}], ",", 
   RowBox[{"-", "13328.2051282051615999080240726470947265625`18."}], ",", 
   RowBox[{"-", "7783.33333333333939663134515285491943359375`18."}], ",", 
   RowBox[{"-", "116079.487179487128742039203643798828125`18."}], ",", 
   "25848.717948717923718504607677459716796875`18.", ",", 
   RowBox[{"-", "40261.538461538453702814877033233642578125`18."}], ",", 
   RowBox[{"-", "11766.6666666666787932626903057098388671875`18."}], ",", 
   "21623.076923076921957544982433319091796875`18.", ",", 
   "39761.538461538453702814877033233642578125`18.", ",", 
   "99441.025641025626100599765777587890625`18.", ",", "52150.`18.", ",", 
   "24038.46153846153174526989459991455078125`18.", ",", 
   "22228.2051282051324960775673389434814453125`18.", ",", 
   "94312.820512820486328564584255218505859375`18.", ",", "51650.`18."}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.740429593978275*^9, 3.7404297027086763`*^9, 3.7404297629373703`*^9, {
   3.7404298121175528`*^9, 3.7404298325385866`*^9}, 3.7643706076169157`*^9, 
   3.7643708714311123`*^9, 3.7643712419865913`*^9, 3.76437152654244*^9, 
   3.7644384588099017`*^9, 3.8490132205876837`*^9, 3.8503095286628523`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"energySum", "=", "0.0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"energyInc", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"Kmm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"energyInc", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "=", 
       RowBox[{"disp", ".", 
        RowBox[{"Klocal", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energySum", "+=", 
       RowBox[{"energyInc", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.723057650960129*^9, 3.7230576545889745`*^9}, {
   3.763398626297826*^9, 3.7633986377693434`*^9}, {3.763398969492062*^9, 
   3.763399017148432*^9}, {3.7633990692779627`*^9, 3.7633990694291053`*^9}, {
   3.7633991201481476`*^9, 3.763399174570841*^9}, {3.763399415268031*^9, 
   3.76339941606513*^9}, {3.7633996474373903`*^9, 3.7633996648412056`*^9}, {
   3.7633997501291094`*^9, 3.7633999258824277`*^9}, {3.7633999725549555`*^9, 
   3.763399976702032*^9}, {3.7634000083920765`*^9, 3.76340016737781*^9}, {
   3.7634002158964863`*^9, 3.76340029196223*^9}, {3.763400323496956*^9, 
   3.7634004027149053`*^9}, {3.76340045059245*^9, 3.763400463281616*^9}, {
   3.7634005294006834`*^9, 3.763400570424802*^9}, {3.764082973996101*^9, 
   3.764082975901887*^9}, {3.764085676134435*^9, 3.7640856834202404`*^9}, {
   3.7640858472503123`*^9, 3.7640858920767965`*^9}, {3.7640894255234814`*^9, 
   3.7640894257482643`*^9}, {3.7640894615887256`*^9, 
   3.7640894620724916`*^9}, {3.7640895179586363`*^9, 
   3.7640895273283195`*^9}, {3.7640896836413865`*^9, 
   3.7640896854169707`*^9}, {3.764098322843951*^9, 3.764098324217982*^9}, {
   3.7640983820840216`*^9, 3.764098382599674*^9}, {3.764099103461434*^9, 
   3.764099173185652*^9}, {3.764101764387092*^9, 3.7641017868352966`*^9}, {
   3.764162451449333*^9, 3.764162465312125*^9}, {3.764162509630781*^9, 
   3.764162550331856*^9}, {3.764162583165681*^9, 3.7641626039242*^9}, {
   3.764162639453498*^9, 3.764162731016221*^9}, 3.764162771654982*^9, {
   3.7641628042585936`*^9, 3.764162826582513*^9}, {3.764162885531745*^9, 
   3.76416292037608*^9}, 3.7641629564478016`*^9, {3.764163188990672*^9, 
   3.7641631922903223`*^9}, {3.7641633418697977`*^9, 
   3.7641633445908575`*^9}, {3.7641634102089243`*^9, 
   3.7641635244767513`*^9}, {3.7641636631227293`*^9, 
   3.7641636636004744`*^9}, {3.7641638975971966`*^9, 3.7641639005392556`*^9}, 
   3.764438469064886*^9}],

Cell[CellGroupData[{

Cell[BoxData["energyInc"], "Input",
 CellChangeTimes->{{3.7641635291837215`*^9, 3.7641635303600173`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.28606820512820513`", ",", "0.2860682051282051`", ",", 
   "0.2860682051282051`", ",", "0.28606820512820513`", ",", 
   "0.2860682051282051`", ",", "0.28606820512820513`", ",", 
   "0.28606820512820513`", ",", "0.286068205128205`", ",", 
   "0.2860682051282051`", ",", "0.28606820512820513`", ",", 
   "0.286068205128205`", ",", "0.2860682051282049`", ",", 
   "0.28606820512820486`", ",", "0.28606820512820513`", ",", 
   "0.28606820512820513`", ",", "0.2860682051282051`", ",", 
   "0.2860682051282051`", ",", "0.286068205128205`", ",", 
   "0.2860682051282052`", ",", "0.28606820512820497`", ",", 
   "0.28606820512820497`", ",", "0.286068205128205`", ",", 
   "0.2860682051282051`", ",", "0.2860682051282051`", ",", 
   "0.2860682051282043`", ",", "0.2860682051282051`", ",", 
   "0.2860682051282051`", ",", "0.28606820512820513`", ",", 
   "0.2860682051282052`", ",", "0.28606820512820474`", ",", 
   "0.28606820512820486`", ",", "0.2860682051282052`", ",", 
   "0.2860682051282054`", ",", "0.28606820512820524`", ",", 
   "0.2860682051282051`", ",", "0.2860682051282047`", ",", 
   "0.2860682051282042`", ",", "0.286068205128205`", ",", 
   "0.2860682051282052`", ",", "0.28606820512820513`", ",", 
   "0.2860682051282048`", ",", "0.2860682051282053`", ",", 
   "0.286068205128205`", ",", "0.286068205128205`", ",", 
   "0.28606820512820486`", ",", "0.28606820512820513`", ",", 
   "0.28606820512820463`", ",", "0.2860682051282048`"}], "}"}]], "Output",
 CellChangeTimes->{3.849013499413076*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"energyInc", "[", 
      RowBox[{"[", "i", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "energyInc", "]"}]}], "}"}]}], "]"}], ",", 
   "18"}], "]"}]], "Input",
 CellChangeTimes->{{3.7641639175031357`*^9, 3.7641639430078697`*^9}, {
  3.7641716632883053`*^9, 3.7641716686992283`*^9}}],

Cell[BoxData["13.73127384615383306254443596117198467255`18."], "Output",
 CellChangeTimes->{{3.7641639234457664`*^9, 3.7641639442960567`*^9}, 
   3.7641716695246778`*^9, 3.7642445875499754`*^9, 3.7644384883681746`*^9, 
   3.84901348507552*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{
   RowBox[{"uv", ".", 
    RowBox[{"(", 
     RowBox[{"Kglobal", ".", "uv"}], ")"}]}], ",", "18"}], "]"}]], "Input",
 CellChangeTimes->{{3.7641030835250883`*^9, 3.764103152952297*^9}, {
  3.76418642397815*^9, 3.7641864313163605`*^9}}],

Cell[BoxData["13.73127384615383306254443596117198467255`18."], "Output",
 CellChangeTimes->{{3.7641031161414948`*^9, 3.7641031537124987`*^9}, 
   3.764186431839634*^9, 3.7642445902025733`*^9, 3.7644384939663353`*^9, 
   3.849013488182713*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy gradient wrt control:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradZ", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "xv", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"energyInc", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"Kmm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Rho]1", "+", "\[Rho]2", "+", "\[Rho]3", "+", "\[Rho]4"}], 
         ")"}], 
        RowBox[{
         RowBox[{"disp", ".", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Klocal", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}], "/", 
         "4.0"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"d\[Rho]", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]4"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Rho]1", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]2", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]3", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]4", "\[Rule]", "1.0"}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i1", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i2", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i3", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i4", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.7642442961606417`*^9, 3.7642443289943247`*^9}, {
   3.764244647880147*^9, 3.7642446516489763`*^9}, 3.764441181236973*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"gradZ", ",", "16"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.42910230769230761627142101133358664811`16.", ",", 
   "0.57213641025641004400625888592912815511`16.", ",", 
   "0.14303410256410253875714033711119554937`16.", ",", 
   "0.57213641025641004400625888592912815511`16.", ",", 
   "0.85820461538461523254284202266717329621`16.", ",", 
   "0.28606820512820502200312944296456407756`16.", ",", 
   "0.14303410256410248324598910585336852819`16.", ",", 
   "0.28606820512820507751428067422239109874`16.", ",", 
   "0.14303410256410248324598910585336852819`16.", ",", 
   "0.57213641025640993298395642341347411275`16.", ",", 
   "0.85820461538461534356514448518282733858`16.", ",", 
   "0.2860682051282051885365831367380451411`16.", ",", 
   "0.85820461538461489947593463512021116912`16.", ",", 
   "1.71640923076923068713028897036565467715`16.", ",", 
   "0.85820461538461534356514448518282733858`16.", ",", 
   "0.28606820512820479995852451793325599283`16.", ",", 
   "0.85820461538461512152053956015151925385`16.", ",", 
   "0.57213641025641004400625888592912815511`16.", ",", 
   "0.14303410256410248324598910585336852819`16.", ",", 
   "0.28606820512820502200312944296456407756`16.", ",", 
   "0.14303410256410259426829156836902257055`16.", ",", 
   "0.28606820512820479995852451793325599283`16.", ",", 
   "0.8582046153846146774313297100889030844`16.", ",", 
   "0.57213641025641015502856134844478219748`16.", ",", 
   "0.14303410256410237222368664333771448582`16.", ",", 
   "0.57213641025640993298395642341347411275`16.", ",", 
   "0.42910230769230739422681608630227856338`16."}], "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.7210616304729853`*^9, 3.723054948630515*^9, 
  3.764244340219616*^9, 3.7642446042574973`*^9, 3.764244658312017*^9, 
  3.764441195679981*^9, 3.8490136077455893`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy gradient wrt state:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210490655350704`*^9, 3.7210490675964766`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradU", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"4", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"Kmm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmt", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktm", "[", 
         RowBox[{
          RowBox[{"xv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i2", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i3", "]"}], "]"}], ",", 
          RowBox[{"xv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"yv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"zv", "[", 
           RowBox[{"[", "i4", "]"}], "]"}], ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
        "u1", ",", "u2", ",", "u3", ",", "u4", ",", "u5", ",", "u6", ",", 
         "u7", ",", "u8", ",", "u9", ",", "u10", ",", "u11", ",", "u12", ",", 
         "u13", ",", "u14", ",", "u15", ",", "u16"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"disp", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Klocal", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u4"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u5"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u6"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u7"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u8"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u9"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u10"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u11"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u12"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u13"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u14"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u15"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u16"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"u1", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u2", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u3", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u4", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u5", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u6", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u7", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u8", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u9", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u10", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u11", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u12", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u13", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "13", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u14", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "14", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u15", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "15", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u16", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "16", "]"}], "]"}], "]"}], "]"}]}]}], "}"}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", "16"}], ",", 
        RowBox[{"j", "++"}], ",", 
        RowBox[{
         RowBox[{"gradU", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
         RowBox[{"du", "[", 
          RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.7642452569805026`*^9, 3.764245263358354*^9}, {
   3.764245305776163*^9, 3.764245328650949*^9}, {3.7642453588766627`*^9, 
   3.7642454488433666`*^9}, {3.764246854431797*^9, 3.7642468553631997`*^9}, 
   3.764443227563691*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"gradU", ",", "16"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}, {3.7210497813919053`*^9, 
  3.7210497819111586`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "260912.8205128205008804798126220703125`16."}], ",", 
   RowBox[{"-", "133025.641025641001760959625244140625`16."}], ",", 
   RowBox[{"-", "310174.3589743589400313794612884521484375`16."}], ",", 
   RowBox[{"-", "130833.33333333334303461015224456787109375`16."}], ",", 
   RowBox[{"-", "116123.076923076834646053612232208251953125`16."}], ",", 
   RowBox[{"-", "104584.615384615375660359859466552734375`16."}], ",", 
   RowBox[{"-", "370200.`16."}], ",", 
   RowBox[{"-", "215850.`16."}], ",", 
   "144789.7435897435643710196018218994140625`16.", ",", 
   "28441.02564102565884240902960300445556640625`16.", ",", 
   RowBox[{"-", "60025.64102564103086479008197784423828125`16."}], ",", 
   RowBox[{"-", "85016.66666666665696538984775543212890625`16."}], ",", 
   RowBox[{"-", "350984.6153846153174526989459991455078125`16."}], ",", 
   RowBox[{"-", "135338.46153846153174526989459991455078125`16."}], ",", 
   RowBox[{"-", "370307.69230769225396215915679931640625`16."}], ",", 
   RowBox[{"-", "134600.`16."}], ",", 
   RowBox[{"-", "151476.92307692297617904841899871826171875`16."}], ",", 
   RowBox[{"-", "80769.230769230678561143577098846435546875`16."}], ",", 
   RowBox[{"-", "550492.307692307629622519016265869140625`16."}], ",", 
   RowBox[{"-", "308400.0000000000582076609134674072265625`16."}], ",", 
   "199507.69230769225396215915679931640625`16.", ",", 
   "54569.230769230765872634947299957275390625`16.", ",", 
   RowBox[{"-", "180184.61538461534655652940273284912109375`16."}], ",", 
   RowBox[{"-", "173799.99999999997089616954326629638671875`16."}], ",", 
   RowBox[{"-", "90071.79487179484567604959011077880859375`16."}], ",", 
   RowBox[{"-", "2312.82051282051907037384808063507080078125`16."}], ",", 
   RowBox[{"-", "60133.33333333334303461015224456787109375`16."}], ",", 
   RowBox[{"-", "3766.66666666667515528388321399688720703125`16."}], ",", 
   RowBox[{"-", "35353.8461538461197051219642162322998046875`16."}], ",", 
   "23815.38461538462070166133344173431396484375`16.", ",", 
   RowBox[{"-", "180292.3076923076878301799297332763671875`16."}], ",", 
   RowBox[{"-", "92550.000000000014551915228366851806640625`16."}], ",", 
   "54717.9487179487114190123975276947021484375`16.", ",", 
   "26128.20512820512885809876024723052978515625`16.", ",", 
   RowBox[{"-", "120158.974358974301139824092388153076171875`16."}], ",", 
   RowBox[{"-", "88783.333333333328482694923877716064453125`16."}], ",", 
   RowBox[{"-", "315630.769230769132263958454132080078125`16."}], ",", 
   RowBox[{"-", "159153.8461538460687734186649322509765625`16."}], ",", 
   RowBox[{"-", "190015.3846153845661319792270660400390625`16."}], ",", 
   RowBox[{"-", "42050.000000000043655745685100555419921875`16."}], ",", 
   RowBox[{"-", "80769.23076923083863221108913421630859375`16."}], ",", 
   RowBox[{"-", "128399.999999999839928932487964630126953125`16."}], ",", 
   RowBox[{"-", "189907.69230769225396215915679931640625`16."}], ",", 
   RowBox[{"-", "123299.999999999883584678173065185546875`16."}], ",", 
   "234861.5384615384391508996486663818359375`16.", ",", 
   "30753.84615384621429257094860076904296875`16.", ",", 
   "107.69230769222485832870006561279296875`16.", ",", 
   RowBox[{"-", "81250.00000000008731149137020111083984375`16."}], ",", 
   RowBox[{"-", "550492.307692307629622519016265869140625`16."}], ",", 
   RowBox[{"-", "189907.69230769225396215915679931640625`16."}], ",", 
   RowBox[{"-", "190123.0769230767036788165569305419921875`16."}], ",", 
   "39199.9999999997744453139603137969970703125`16.", ",", "0", ",", 
   "1.30967237055301666259765625`16.*^-10", ",", 
   RowBox[{"-", "7.8580342233180999755859375`16.*^-10"}], ",", 
   "5.82076609134674072265625`16.*^-11", ",", 
   "550492.30769230774603784084320068359375`16.", ",", 
   "189907.69230769222485832870006561279296875`16.", ",", 
   "190123.0769230769365094602108001708984375`16.", ",", 
   RowBox[{"-", "39200.00000000020372681319713592529296875`16."}], ",", 
   RowBox[{"-", "234861.53846153841004706919193267822265625`16."}], ",", 
   RowBox[{"-", "30753.8461538460760493762791156768798828125`16."}], ",", 
   RowBox[{"-", "107.69230769222485832870006561279296875`16."}], ",", 
   "81249.999999999956344254314899444580078125`16.", ",", 
   "80769.2307692308095283806324005126953125`16.", ",", 
   "128400.000000000014551915228366851806640625`16.", ",", 
   "189907.69230769239948131144046783447265625`16.", ",", 
   "123299.99999999976716935634613037109375`16.", ",", 
   "315630.76923076924867928028106689453125`16.", ",", 
   "159153.8461538460687734186649322509765625`16.", ",", 
   "190015.38461538412957452237606048583984375`16.", ",", 
   "42049.999999999883584678173065185546875`16.", ",", 
   RowBox[{"-", "54717.94871794871869497001171112060546875`16."}], ",", 
   RowBox[{"-", "26128.205128205125220119953155517578125`16."}], ",", 
   "120158.9743589744321070611476898193359375`16.", ",", 
   "88783.33333333334303461015224456787109375`16.", ",", 
   "35353.84615384615608491003513336181640625`16.", ",", 
   RowBox[{"-", "23815.38461538452611421234905719757080078125`16."}], ",", 
   "180292.307692307629622519016265869140625`16.", ",", 
   "92549.99999999979627318680286407470703125`16.", ",", 
   "90071.794871794860227964818477630615234375`16.", ",", 
   "2312.82051282053362228907644748687744140625`16.", ",", 
   "60133.333333333415794186294078826904296875`16.", ",", 
   "3766.6666666667078970931470394134521484375`16.", ",", 
   RowBox[{"-", "199507.6923076921957544982433319091796875`16."}], ",", 
   RowBox[{"-", "54569.23076923078042455017566680908203125`16."}], ",", 
   "180184.6153846152010373771190643310546875`16.", ",", 
   "173799.9999999999417923390865325927734375`16.", ",", 
   "151476.92307692303438670933246612548828125`16.", ",", 
   "80769.23076923083863221108913421630859375`16.", ",", 
   "550492.30769230774603784084320068359375`16.", ",", 
   "308399.9999999995343387126922607421875`16.", ",", 
   "350984.61538461525924503803253173828125`16.", ",", 
   "135338.4615384615026414394378662109375`16.", ",", 
   "370307.692307692370377480983734130859375`16.", ",", 
   "134600.00000000014551915228366851806640625`16.", ",", 
   RowBox[{"-", "144789.7435897435643710196018218994140625`16."}], ",", 
   RowBox[{"-", "28441.025641025582444854080677032470703125`16."}], ",", 
   "60025.6410256409435532987117767333984375`16.", ",", 
   "85016.66666666659875772893428802490234375`16.", ",", 
   "116123.076923076951061375439167022705078125`16.", ",", 
   "104584.61538461540476419031620025634765625`16.", ",", 
   "370199.99999999976716935634613037109375`16.", ",", 
   "215849.999999999883584678173065185546875`16.", ",", 
   "260912.8205128204426728188991546630859375`16.", ",", 
   "133025.64102564097265712916851043701171875`16.", ",", 
   "310174.358974358881823718547821044921875`16.", ",", 
   "130833.3333333335467614233493804931640625`16."}], "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.721049783085235*^9, 3.7210616458831215`*^9, 
  3.7230549598023367`*^9, 3.764245463887192*^9, 3.764246859671549*^9, 
  3.7644432371226068`*^9, 3.849013669609001*^9, 3.84901382547509*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy gradient wrt config:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210490655350704`*^9, 3.7210490675964766`*^9}, {
  3.7230551164809313`*^9, 3.7230551185900598`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradX", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"ndofs", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}]}], "}"}]}]}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kel", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"KmatNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "6"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"disp", ".", 
        RowBox[{"(", 
         RowBox[{"Kel", ".", "disp"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x4"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x5"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x6"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x7"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x8"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x9"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x10"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x11"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x12"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x1", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x2", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x3", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x4", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x5", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x6", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x7", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x8", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x9", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x10", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
           RowBox[{"x11", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
           RowBox[{"x12", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "12"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"gradU", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{"du", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "12"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"gradU", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "-=", 
            RowBox[{"du", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.7210490923010983`*^9, 
   3.7210491222796535`*^9}, {3.7210491757545376`*^9, 
   3.7210493138722425`*^9}, {3.721049409321796*^9, 3.721049640653741*^9}, 
   3.721049765856733*^9, {3.723055124450037*^9, 3.723055129574788*^9}, {
   3.723055292912021*^9, 3.7230553309253855`*^9}, {3.7230553941804533`*^9, 
   3.7230554578048472`*^9}, {3.723055525200883*^9, 3.723055731450719*^9}, {
   3.723055828378682*^9, 3.7230558285355997`*^9}, {3.7230559085505037`*^9, 
   3.7230559544567056`*^9}, {3.723056073457146*^9, 3.723056217017265*^9}, {
   3.723056712834525*^9, 3.7230568061937404`*^9}, {3.7230570373170767`*^9, 
   3.723057041598381*^9}, {3.7230574604717684`*^9, 3.7230574691597023`*^9}, {
   3.7230576687082634`*^9, 3.723057672733388*^9}, {3.723057739783541*^9, 
   3.7230577772921667`*^9}, {3.723057872614895*^9, 3.7230578808186064`*^9}, {
   3.7230582312110176`*^9, 3.723058233179638*^9}, {3.7230582693977594`*^9, 
   3.7230583084759116`*^9}, {3.723058342960322*^9, 3.7230583468666005`*^9}, {
   3.7230585527283564`*^9, 3.723058554150366*^9}, {3.7642459686514587`*^9, 
   3.764245998053566*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ndims", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradX", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"3", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"xids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"KmmNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"1", "*", 
           SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kttNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.4", "*", 
           SuperscriptBox["10", 
            RowBox[{"-", "10"}]]}], ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"kmtNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltm", "=", 
       RowBox[{"gaussWeight", "*", 
        RowBox[{"ktmNoAbs", "[", 
         RowBox[{
         "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
          "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", ",", 
          RowBox[{"-", "5.4"}], ",", " ", "15.8", ",", "12.3", ",", 
          RowBox[{"1.0", "*", 
           SuperscriptBox["10", "10"]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{
                RowBox[{"Kelmt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"Keltm", "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}], 
                 "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "13", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "14", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "15", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "16", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"disp", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Klocal", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x4"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x5"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x6"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x7"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x8"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x9"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x10"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x11"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x12"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x1", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x2", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x3", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x4", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x5", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x6", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x7", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x8", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x9", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x10", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
           RowBox[{"x11", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
           RowBox[{"x12", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "12"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"gradX", "[", 
             RowBox[{"[", 
              RowBox[{"xids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{"du", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "12"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"gradX", "[", 
             RowBox[{"[", 
              RowBox[{"xids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "-=", 
            RowBox[{"du", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.76424600551651*^9, 3.7642461711801653`*^9}, {
   3.7642462028071766`*^9, 3.764246220213563*^9}, {3.764246283329853*^9, 
   3.764246293892589*^9}, {3.7642463610108213`*^9, 3.7642464906323004`*^9}, {
   3.7642465289172134`*^9, 3.764246546403119*^9}, {3.7642466386150875`*^9, 
   3.7642466547357836`*^9}, {3.7642466873858633`*^9, 3.764246732945367*^9}, {
   3.7642468131619663`*^9, 3.7642468162460403`*^9}, {3.7642468752406893`*^9, 
   3.7642468758494267`*^9}, {3.7642471307562113`*^9, 
   3.7642472796655865`*^9}, {3.764247331374629*^9, 3.7642473324519873`*^9}, {
   3.764254726830079*^9, 3.764254727571266*^9}, 3.7644502533966165`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"gradX", ",", "18"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}, {3.7210497813919053`*^9, 
  3.7210497819111586`*^9}, {3.7230570968479857`*^9, 3.7230571009733553`*^9}, {
  3.7230574419255185`*^9, 3.7230574467536917`*^9}, {3.764247363281391*^9, 
  3.764247364672212*^9}, {3.764248028186861*^9, 3.764248029554489*^9}, {
  3.76445054494305*^9, 3.7644505456636286`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "2.42120410256410245608549303142353892326`18.", ",", 
   "0.04421948717948731566451670005335472524`18.", ",", 
   RowBox[{"-", "0.74810871794871802720194864377845078707`18."}], ",", 
   "2.42231692307692281218578500556759536266`18.", ",", 
   RowBox[{"-", "0.33683384615384603932852769503369927406`18."}], ",", 
   "0.45985846153846210437876607102225534618`18.", ",", 
   "0.00111282051282048100038224447416723706`18.", ",", 
   RowBox[{"-", "0.3810533333333333549930443950870539993`18."}], ",", 
   "1.20796717948717913237999255215981975198`18.", ",", 
   "2.37136307692307690686561727488879114389`18.", ",", 
   "1.36259076923076904996889879839727655053`18.", ",", 
   RowBox[{"-", "1.26221230769230796653346260427497327328`18."}], ",", 
   "2.32374769230769251393553531670477241278`18.", ",", 
   "1.91885538461538462939870441914536058903`18.", ",", 
   "0.63961846153846180218494055225164629519`18.", ",", 
   RowBox[{"-", "0.04761538461538532274186508175262133591`18."}], ",", 
   "0.55626461538461513534059577068546786904`18.", ",", 
   "1.90183076923076921360689084394834935665`18.", ",", 
   RowBox[{"-", "0.04984102564102552146430014090583426878`18."}], ",", 
   "1.31837128205128184532668456085957586765`18.", ",", 
   RowBox[{"-", "0.51410358974358971728690903546521440148`18."}], ",", 
   RowBox[{"-", "0.09856923076923135296212308276153635234`18."}], ",", 
   "2.25568923076923066872723211417905986309`18.", ",", 
   "0.17975999999999969780617448122939094901`18.", ",", 
   RowBox[{"-", "0.04872820512820580374224732622678857297`18."}], ",", 
   "0.9373179487179489344228500158351380378`18.", ",", 
   "0.69386358974358974815999090424156747758`18.", ",", 
   "2.46993230769230898147270636400207877159`18.", ",", 
   RowBox[{"-", "0.89309846153846117466912346571916714311`18."}], ",", 
   RowBox[{"-", "1.44197230769230722025042723544174805284`18."}], ",", 
   "2.52088615384615222225761499430518597364`18.", ",", 
   RowBox[{"-", "2.59252307692307715214496965927537530661`18."}], ",", 
   "0.28009846153846224003913789601938333362`18.", ",", 
   "0.05095384615384529469750418684270698577`18.", ",", 
   RowBox[{"-", "1.69942461538461664360966096865013241768`18."}], ",", 
   "1.72207076923077062602374098787549883127`18.", ",", 
   "2.41897846153846218797411893319804221392`18.", ",", 
   "0.80632615384615680120816705311881378293`18.", ",", 
   RowBox[{"-", "3.16404307692307718014035344822332262993`18."}], ",", 
   "1.609823385706476983614265918731689453125`18.*^-15", ",", 
   RowBox[{"-", "1.5543122344752191565930843353271484375`18.*^-15"}], ",", 
   RowBox[{"-", "2.7478019859472624375484883785247802734375`18.*^-15"}], ",", 
   RowBox[{"-", "2.41897846153846041161727953294757753611`18."}], ",", 
   RowBox[{"-", "0.80632615384615480280672272783704102039`18."}], ",", 
   "3.16404307692307718014035344822332262993`18.", ",", 
   RowBox[{"-", "0.05095384615384690452088989331969060004`18."}], ",", 
   "1.69942461538461619952045111858751624823`18.", ",", 
   RowBox[{"-", "1.72207076923077151420216068800073117018`18."}], ",", 
   RowBox[{"-", "2.52088615384615977177418244536966085434`18."}], ",", 
   "2.59252307692307892850180905952583998442`18.", ",", 
   RowBox[{"-", "0.28009846153845924243697140809672418982`18."}], ",", 
   RowBox[{"-", "2.46993230769230898147270636400207877159`18."}], ",", 
   "0.89309846153846184080293824081309139729`18.", ",", 
   "1.4419723076923061100274026102852076292`18.", ",", 
   "0.04872820512820452698576900729676708579`18.", ",", 
   RowBox[{"-", "0.93731794871794926748975740338210016489`18."}], ",", 
   RowBox[{"-", "0.69386358974359207962834261707030236721`18."}], ",", 
   "0.09856923076923251869629893917590379715`18.", ",", 
   RowBox[{"-", "2.25568923076923510961933061480522155762`18."}], ",", 
   RowBox[{"-", "0.1797600000000000308730818687763530761`18."}], ",", 
   "0.049841025641026659442900381691288203`18.", ",", 
   RowBox[{"-", "1.31837128205128606417417813645442947745`18."}], ",", 
   "0.51410358974359127159914351068437099457`18.", ",", 
   "0.04761538461538550315310658334055915475`18.", ",", 
   RowBox[{"-", "0.5562646153846164676082253208733163774`18."}], ",", 
   RowBox[{"-", "1.90183076923077565290043366985628381371`18."}], ",", 
   RowBox[{"-", "2.32374769230769206984632546664215624332`18."}], ",", 
   RowBox[{"-", "1.9188553846153877380231733695836737752`18."}], ",", 
   RowBox[{"-", "0.63961846153846557694322427778388373554`18."}], ",", 
   RowBox[{"-", "2.37136307692307735095482712495140731335`18."}], ",", 
   RowBox[{"-", "1.36259076923077149245955297374166548252`18."}], ",", 
   "1.26221230769231018697951185458805412054`18.", ",", 
   RowBox[{"-", "0.00111282051281991201108212408144026995`18."}], ",", 
   "0.38105333333333379908225424514967016876`18.", ",", 
   RowBox[{"-", "1.20796717948718446145051075291121378541`18."}], ",", 
   RowBox[{"-", "2.42231692307692192400736530544236302376`18."}], ",", 
   "0.33683384615384637239543508258066140115`18.", ",", 
   RowBox[{"-", "0.45985846153845888473199465806828811765`18."}], ",", 
   RowBox[{"-", "2.42120410256410201199628318136092275381`18."}], ",", 
   RowBox[{"-", "0.04421948717948892548790240653033833951`18."}], ",", 
   "0.74810871794871891538036834390368312597`18."}], "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.721049783085235*^9, 3.7210616458831215`*^9, 
  3.7230549598023367`*^9, 3.723057053332902*^9, 3.723057102083436*^9, 
  3.7230574482999644`*^9, 3.7230575621588583`*^9, 3.723058428273193*^9, 
  3.764247524736701*^9, 3.764248030454146*^9, 3.764450476438163*^9, 
  3.7644505464391747`*^9, 3.849013962500931*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1359, 868},
WindowMargins->{{Automatic, 46}, {Automatic, 63}},
PrintingCopies->1,
PrintingPageRange->{Automatic, Automatic},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
Magnification:>0.75 Inherited,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 235, 3, 70, "Title"],
Cell[CellGroupData[{
Cell[840, 29, 212, 3, 35, "Subsection"],
Cell[1055, 34, 363, 8, 25, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1455, 47, 1142, 36, 36, "Subsection"],
Cell[2600, 85, 1472, 47, 203, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4109, 137, 294, 10, 40, "Subsection"],
Cell[CellGroupData[{
Cell[4428, 151, 1232, 34, 25, "Input"],
Cell[5663, 187, 1629, 38, 63, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[7341, 231, 126, 1, 33, "Subsection"],
Cell[7470, 234, 164, 4, 25, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7671, 243, 124, 1, 33, "Subsection"],
Cell[7798, 246, 324, 7, 25, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8159, 258, 676, 23, 37, "Subsection"],
Cell[8838, 283, 643, 16, 25, "Input"],
Cell[9484, 301, 761, 13, 25, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10282, 319, 113, 1, 34, "Subsection"],
Cell[10398, 322, 7090, 186, 179, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[17525, 513, 114, 1, 33, "Subsection"],
Cell[CellGroupData[{
Cell[17664, 518, 5825, 169, 338, "Input"],
Cell[23492, 689, 3516, 113, 213, "Output"],
Cell[27011, 804, 768, 20, 63, "Output"],
Cell[27782, 826, 792, 20, 63, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[28623, 852, 310, 6, 34, "Subsection"],
Cell[28936, 860, 7578, 191, 353, "Input"],
Cell[36517, 1053, 467, 13, 41, "Input"],
Cell[36987, 1068, 979, 26, 25, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[38003, 1099, 223, 4, 34, "Subsection"],
Cell[38229, 1105, 4474, 105, 93, "Input"],
Cell[42706, 1212, 2090, 48, 59, "Input"],
Cell[CellGroupData[{
Cell[44821, 1264, 282, 7, 27, "Input"],
Cell[45106, 1273, 804, 13, 25, "Output"]
}, Open  ]],
Cell[45925, 1289, 1804, 53, 167, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47766, 1347, 119, 1, 34, "Subsection"],
Cell[47888, 1350, 1392, 34, 120, "Input"],
Cell[49283, 1386, 16860, 427, 728, "Input"],
Cell[CellGroupData[{
Cell[66168, 1817, 2821, 78, 122, "Input"],
Cell[68992, 1897, 2674, 48, 173, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[71715, 1951, 258, 3, 34, "Subsection"],
Cell[71976, 1956, 22315, 533, 895, "Input"],
Cell[CellGroupData[{
Cell[94316, 2493, 268, 5, 27, "Input"],
Cell[94587, 2500, 7507, 117, 245, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[102143, 2623, 327, 4, 34, "Subsection"],
Cell[102473, 2629, 24887, 586, 1085, "Input"],
Cell[127363, 3217, 204, 4, 27, "Input"],
Cell[CellGroupData[{
Cell[127592, 3225, 2174, 57, 122, "Input"],
Cell[129769, 3284, 1572, 25, 75, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[131390, 3315, 381, 5, 34, "Subsection"],
Cell[131774, 3322, 27364, 649, 1157, "Input"],
Cell[CellGroupData[{
Cell[159163, 3975, 3507, 86, 122, "Input"],
Cell[162673, 4063, 3416, 54, 118, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[166138, 4123, 166, 2, 34, "Subsection"],
Cell[166307, 4127, 20233, 475, 806, "Input"],
Cell[CellGroupData[{
Cell[186565, 4606, 105, 1, 23, "Input"],
Cell[186673, 4609, 1545, 27, 58, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[188255, 4641, 447, 12, 27, "Input"],
Cell[188705, 4655, 243, 3, 23, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[188985, 4663, 290, 7, 25, "Input"],
Cell[189278, 4672, 242, 3, 23, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[189569, 4681, 236, 3, 34, "Subsection"],
Cell[189808, 4686, 17673, 461, 883, "Input"],
Cell[CellGroupData[{
Cell[207506, 5151, 212, 4, 25, "Input"],
Cell[207721, 5157, 1846, 33, 58, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[209616, 5196, 284, 3, 34, "Subsection"],
Cell[209903, 5201, 21045, 540, 897, "Input"],
Cell[CellGroupData[{
Cell[230973, 5745, 265, 5, 25, "Input"],
Cell[231241, 5752, 7219, 113, 226, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[238509, 5871, 338, 4, 34, "Subsection"],
Cell[238850, 5877, 14770, 345, 401, "Input"],
Cell[253623, 6224, 22135, 567, 1048, "Input"],
Cell[CellGroupData[{
Cell[275783, 6795, 513, 8, 25, "Input"],
Cell[276299, 6805, 5692, 89, 215, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

