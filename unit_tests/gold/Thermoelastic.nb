(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    293915,       7055]
NotebookOptionsPosition[    284969,       6893]
NotebookOutlinePosition[    285535,       6913]
CellTagsIndexPosition[    285492,       6910]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Definitions for linear thermoelastostatics:", "Title",
 CellChangeTimes->{{3.7227097911277695`*^9, 3.7227098092418723`*^9}, {
  3.763392097019563*^9, 
  3.7633920975064383`*^9}},ExpressionUUID->"bb8b7b74-143e-41ce-a246-\
8c42a29bf4f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ConductionCoeff", "=", "910.0"}], ";"}]], "Input",
 CellChangeTimes->{{3.717159762670228*^9, 3.717159772862687*^9}, 
   3.7171704577284317`*^9, {3.7173671489361877`*^9, 3.717367156764295*^9}, {
   3.906645800149747*^9, 3.9066458087790747`*^9}, 3.906730899979998*^9, {
   3.906741567745932*^9, 3.9067416067466393`*^9}, {3.9068147553469276`*^9, 
   3.9068147998511467`*^9}, {3.906823101652835*^9, 3.9068231031466703`*^9}, {
   3.906823477251442*^9, 3.906823477626667*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"86a1bc67-111e-4b5f-b8a7-e8b4983acab1"],

Cell[CellGroupData[{

Cell["Define Tri3 basis functions in parent coordinates \
(\[Xi],\[Psi],\[Zeta]):", "Subsection",
 CellChangeTimes->{{3.717170430098735*^9, 3.717170455794014*^9}, {
  3.717367163060734*^9, 
  3.717367164420561*^9}},ExpressionUUID->"9c2a181c-f246-4787-8d4b-\
198a039cc207"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Phi]s", "=", 
   RowBox[{"{", 
    RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]", ",", 
     RowBox[{"1", "-", "\[Xi]", "-", "\[Psi]", "-", "\[Zeta]"}]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.717159762670228*^9, 3.717159772862687*^9}, 
   3.7171704577284317`*^9, {3.7173671489361877`*^9, 3.717367156764295*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"ea2b45c0-7bcc-431f-9104-2144d07c791b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Define local nodal coordinate arrays, X, Y, and Z, and compute the \
position, ",
 Cell[BoxData[
  FormBox[
   RowBox[{"x", " ", "=", 
    RowBox[{"\[Sum]", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Phi]", "I"], "[", 
       RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]"}], "]"}], 
      SubscriptBox["X", "I"]}]}]}], TraditionalForm]],ExpressionUUID->
  "4d9f8e17-9b91-4dd2-b9ef-c9742b846fe1"],
 ", ",
 Cell[BoxData[
  FormBox[
   RowBox[{"y", " ", "=", " ", 
    RowBox[{"\[Sum]", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Phi]", "I"], "[", 
       RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]"}], "]"}], 
      SubscriptBox["Y", "I"]}]}]}], TraditionalForm]],ExpressionUUID->
  "977ca4ef-4d5b-4e3a-9ee6-7db7b46e0e01"],
 ", and  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"z", " ", "=", " ", 
    RowBox[{"\[Sum]", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Phi]", "I"], "[", 
       RowBox[{"\[Xi]", ",", "\[Psi]", ",", "\[Zeta]"}], "]"}], 
      RowBox[{
       SubscriptBox["Z", "I"], ":"}]}]}]}], TraditionalForm]],ExpressionUUID->
  "0bbe506b-aac4-4afb-9084-4799e726e62b"]
}], "Subsection",
 CellChangeTimes->{{3.717170467034111*^9, 3.717170646080793*^9}, {
  3.7173672533732233`*^9, 3.717367296127637*^9}, {3.7173676524772353`*^9, 
  3.7173676768522606`*^9}},ExpressionUUID->"7796673f-c8ea-458e-857b-\
77d57be34039"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2", ",", "x3", ",", "x4"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "=", 
   RowBox[{"{", 
    RowBox[{"y1", ",", "y2", ",", "y3", ",", "y4"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Z", "=", 
   RowBox[{"{", 
    RowBox[{"z1", ",", "z2", ",", "z3", ",", "z4"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", "=", 
   RowBox[{
    UnderoverscriptBox["\[Sum]", 
     RowBox[{"i", "=", "1"}], "4"], 
    RowBox[{
     RowBox[{"\[Phi]s", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "*", 
     RowBox[{"X", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"y", "=", 
   RowBox[{
    UnderoverscriptBox["\[Sum]", 
     RowBox[{"i", "=", "1"}], "4"], 
    RowBox[{
     RowBox[{"\[Phi]s", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "*", 
     RowBox[{"Y", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"z", "=", 
   RowBox[{
    UnderoverscriptBox["\[Sum]", 
     RowBox[{"i", "=", "1"}], "4"], 
    RowBox[{
     RowBox[{"\[Phi]s", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "*", 
     RowBox[{"Z", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.716761356116639*^9, 3.71676136863325*^9}, 
   3.717159777614208*^9, {3.717367683976516*^9, 3.7173677669144773`*^9}},
 CellLabel->"In[95]:=",ExpressionUUID->"e2c38a60-f6bc-48b1-9272-db75a70885c3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Define the Jacobian matrix, ",
 Cell[BoxData[
  FormBox[
   RowBox[{"J", "=", 
    RowBox[{
     SubscriptBox["dx", "i"], "/", 
     SubscriptBox["d\[Xi]", "j"]}]}], TraditionalForm]],ExpressionUUID->
  "852e4f1a-61d5-4262-a0fe-160534f2ffe5"],
 ":"
}], "Subsection",
 CellChangeTimes->{{3.7171706589407587`*^9, 
  3.717170706016591*^9}},ExpressionUUID->"83db025d-cf6b-4869-a639-\
b7206dd781d8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"J", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"x", ",", "\[Xi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"x", ",", "\[Psi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"x", ",", "\[Zeta]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"y", ",", "\[Xi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"y", ",", "\[Psi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"y", ",", "\[Zeta]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"z", ",", "\[Xi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"z", ",", "\[Psi]"}], "]"}], ",", 
        RowBox[{"D", "[", 
         RowBox[{"z", ",", "\[Zeta]"}], "]"}]}], "}"}]}], "}"}]}], ")"}], "//",
   "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.717159400798109*^9, 3.717159402472238*^9}, {
   3.7171594670820827`*^9, 3.717159481884482*^9}, {3.717159528167789*^9, 
   3.7171595453911543`*^9}, 3.717159782011516*^9, {3.7173677887268276`*^9, 
   3.7173678325554037`*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"2a5e0087-5b0b-43e0-941e-e0f8b0364880"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"x1", "-", "x4"}], 
      RowBox[{"x2", "-", "x4"}], 
      RowBox[{"x3", "-", "x4"}]},
     {
      RowBox[{"y1", "-", "y4"}], 
      RowBox[{"y2", "-", "y4"}], 
      RowBox[{"y3", "-", "y4"}]},
     {
      RowBox[{"z1", "-", "z4"}], 
      RowBox[{"z2", "-", "z4"}], 
      RowBox[{"z3", "-", "z4"}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.7167614354761105`*^9, 3.716765302982686*^9, 3.7171556785772953`*^9, 
   3.717157543718261*^9, 3.717159484292647*^9, 3.717159565326777*^9, 
   3.717159783432115*^9, 3.717354900932816*^9, 3.7173678516174393`*^9, 
   3.717417860423373*^9, 3.720268227067238*^9, 3.720806396391696*^9, 
   3.7209936838639107`*^9, 3.721061216314333*^9, 3.723054595524909*^9, 
   3.7230546313224325`*^9, 3.723504448044764*^9, 3.7239811360514584`*^9, {
   3.7284300552303286`*^9, 3.7284300734023075`*^9}, 3.7404279872756085`*^9, 
   3.763392391210548*^9, 3.764081528224759*^9, 3.7641637936038733`*^9, 
   3.764244461510044*^9, 3.7643520598062115`*^9, 3.7643697288044987`*^9, 
   3.764696161335455*^9, 3.84902486442985*^9, 3.850310852651092*^9, 
   3.90130020708716*^9, 3.90656823764467*^9, 3.906812974483976*^9, 
   3.906815426952311*^9, 3.9068180408070803`*^9, 3.9068237045428047`*^9, 
   3.906823954751361*^9},
 CellLabel->
  "Out[101]//MatrixForm=",ExpressionUUID->"e06ccfa3-4822-415e-a6fa-\
620bdaf7dc8a"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define the determinant of the Jacobian:", "Subsection",
 CellChangeTimes->{{3.717170742514415*^9, 
  3.71717075277886*^9}},ExpressionUUID->"2288ca6f-2ee3-4651-b306-\
cf4ae9d2e02f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"detj", "=", 
   RowBox[{"Det", "[", "J", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{3.717157550322625*^9, 3.71741786843908*^9},
 CellLabel->
  "In[102]:=",ExpressionUUID->"3aead757-09a6-4009-adfa-8824dd391e2d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define the inverse of the Jacobian:", "Subsection",
 CellChangeTimes->{{3.7171707115541143`*^9, 
  3.71717072339587*^9}},ExpressionUUID->"6836a16d-92da-4aff-a15d-\
31b05516c07b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvJ", " ", "=", " ", 
   RowBox[{"Simplify", "[", " ", 
    RowBox[{"Inverse", "[", "J", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.7167614674219794`*^9, 3.716762132096217*^9, 3.717157545859642*^9, 
   3.7173678815154886`*^9, {3.7173685526975317`*^9, 3.717368591121168*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"ceaf7f50-5244-42e1-9c13-7ee030797555"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Define the derivative of the basis function wrt parent coordinates, ",
 Cell[BoxData[
  FormBox[
   RowBox[{"d\[Phi]", "/", 
    SubscriptBox["d\[Xi]", "i"]}], TraditionalForm]],ExpressionUUID->
  "3f9d31be-e370-4c06-9788-55ff208f25e9"],
 ", and wrt physical coordinates, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"d\[Phi]", "/", 
     SubscriptBox["dx", "i"]}], "=", 
    RowBox[{"(", 
     RowBox[{"d\[Phi]", "/", 
      SubscriptBox["d\[Xi]", "k"]}]}]}], TraditionalForm]],ExpressionUUID->
  "0f466745-311f-42b2-988e-bb2da4d01eb4"],
 ")( ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["d\[Xi]", "k"], "/", 
    SubscriptBox["dx", "i"]}], TraditionalForm]],ExpressionUUID->
  "e4efe55b-15ad-486e-80fa-3f7af62c0605"],
 "):"
}], "Subsection",
 CellChangeTimes->{{3.717170774772771*^9, 
  3.7171709274438047`*^9}},ExpressionUUID->"b35fe5db-06f7-49ea-9a3f-\
4c91eaa4ad4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"D\[Phi]D\[Xi]", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"\[Phi]s", ",", "\[Xi]"}], "]"}], ",", 
      RowBox[{"D", "[", 
       RowBox[{"\[Phi]s", ",", "\[Psi]"}], "]"}], ",", 
      RowBox[{"D", "[", 
       RowBox[{"\[Phi]s", ",", "\[Zeta]"}], "]"}]}], "}"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.716762040827201*^9, 3.7167620550573683`*^9}, {
   3.7167622782753077`*^9, 3.7167622879320135`*^9}, {3.717159585262508*^9, 
   3.7171596049010277`*^9}, 3.717170767862856*^9, {3.7173679090158405`*^9, 
   3.7173679140631857`*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"9c9a3d67-755b-4801-beb3-711219280dac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"D\[Phi]Dx", "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"D\[Phi]D\[Xi]", ".", "InvJ"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7167620697517557`*^9, 3.7167621221822166`*^9}, {
  3.7167623794326005`*^9, 3.7167624191349125`*^9}, {3.717159618780408*^9, 
  3.717159620088848*^9}, {3.7171599769229116`*^9, 3.717159996771841*^9}, {
  3.717170940753901*^9, 3.7171709490170727`*^9}, {3.7171709936534357`*^9, 
  3.717171005961763*^9}, {3.7173600965536957`*^9, 3.717360100742365*^9}, {
  3.7173685313367987`*^9, 3.7173685371065826`*^9}, {3.7173686082063704`*^9, 
  3.717368609587582*^9}, {3.717417891626897*^9, 3.717417893049127*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"cbd871de-2821-4001-8b99-60fdd72c5582"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define the gradient matrix:", "Subsection",
 CellChangeTimes->{{3.7171710170541*^9, 
  3.717171027281568*^9}},ExpressionUUID->"07296904-0c59-449f-82f8-\
7af9ae912604"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"B", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"D\[Phi]Dx", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", "0"}], "}"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "=", "D\[Phi]Dx"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zeros", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Nb", "=", 
   RowBox[{"{", 
    RowBox[{
    "\[Phi]s", ",", "\[Phi]s", ",", "\[Phi]s", ",", "zeros", ",", "zeros", 
     ",", "zeros"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7173602746482644`*^9, 3.717360595407016*^9}, {
  3.7173679545623984`*^9, 3.717368016994071*^9}, {3.7173686738090096`*^9, 
  3.7173688008877954`*^9}, {3.717369134558451*^9, 3.7173691870734324`*^9}, {
  3.717415750201002*^9, 3.7174157973412743`*^9}, {3.7174158656066456`*^9, 
  3.717415993127372*^9}, {3.7174178972678013`*^9, 3.717417921642746*^9}, {
  3.7633923206598988`*^9, 3.7633923613791695`*^9}, {3.7633966157541084`*^9, 
  3.763396628163429*^9}, {3.7633967128971925`*^9, 3.7633967314679966`*^9}, {
  3.763398562028678*^9, 3.7633986048635654`*^9}},
 CellLabel->
  "In[106]:=",ExpressionUUID->"ea952e84-73e5-4db5-a24c-7b8cca083db6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Define a stiffness tensor:", "Subsection",
 CellChangeTimes->{{3.717171037170329*^9, 
  3.717171055154701*^9}},ExpressionUUID->"abfcc1f7-1eee-4f10-b029-\
302d2931f2e3"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"(", 
   RowBox[{"S", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], 
         RowBox[{"(", 
          RowBox[{"1", "-", "vv"}], ")"}]}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", "0", ",",
         "0", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", "vv"}], ")"}]}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", "0", ",",
         "0", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", "vv"}], ",", 
        RowBox[{
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", "vv"}], ")"}]}], ",", "0", ",", "0", ",", "0"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "vv"}]}], ")"}]}], ",", "0", ",", "0"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "vv"}]}], ")"}]}], ",", "0"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         FractionBox["kv", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", "vv"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "vv"}]}], ")"}]}]], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "vv"}]}], ")"}]}]}], "}"}]}], "}"}]}], ")"}], "//",
   "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{"s", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Mu]", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "\[Mu]", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "\[Mu]"}], "}"}]}], "}"}]}], ")"}], "//", 
  "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.7167628480497184`*^9, 3.716762972237756*^9}, {
   3.716763132980883*^9, 3.7167631890087504`*^9}, {3.717157475771058*^9, 
   3.717157528260871*^9}, {3.7174160414866905`*^9, 3.717416148690319*^9}, 
   3.7633924265623446`*^9, 3.763392465685731*^9, {3.763393084507081*^9, 
   3.7633930846862936`*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"ec005e8d-3948-43f1-8fa9-a048c1b3ced7"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      FractionBox[
       RowBox[{"kv", " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "vv"}], ")"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0", "0"},
     {
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "vv"}], ")"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0", "0"},
     {
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", "vv"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], 
      FractionBox[
       RowBox[{"kv", " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "vv"}], ")"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", " ", "vv"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0", "0"},
     {"0", "0", "0", 
      FractionBox["kv", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0", "0"},
     {"0", "0", "0", "0", 
      FractionBox["kv", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]], "0"},
     {"0", "0", "0", "0", "0", 
      FractionBox["kv", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", "vv"}], ")"}]}]]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.7167631923698587`*^9, 3.7167653124350247`*^9, 
  3.7171556932721453`*^9, 3.7171575626207314`*^9, 3.717354914858255*^9, 
  3.7174161523932776`*^9, 3.7174179645333047`*^9, 3.7202682431217527`*^9, 
  3.7208064571168013`*^9, 3.7209937026548615`*^9, 3.721061236237527*^9, 
  3.7230546566345525`*^9, 3.7235044904828486`*^9, 3.7239811456939864`*^9, 
  3.728430083293228*^9, 3.740427997507474*^9, 3.763392468295323*^9, 
  3.7633930861798077`*^9, 3.764081540006856*^9, 3.764163803141763*^9, 
  3.7642444712672567`*^9, 3.764352075263568*^9, 3.7643697453138475`*^9, 
  3.7646961810497456`*^9, 3.8490248817267036`*^9, 3.8503108532556763`*^9, 
  3.901300263883131*^9, 3.906568250952043*^9, 3.906812976247024*^9, 
  3.906815427250087*^9, 3.906818041096034*^9, 3.90682370483321*^9, 
  3.906823954909635*^9},
 CellLabel->
  "Out[110]//MatrixForm=",ExpressionUUID->"f9169e83-ba74-48ee-84e7-\
6d9534f95867"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\[Mu]", "0", "0"},
     {"0", "\[Mu]", "0"},
     {"0", "0", "\[Mu]"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.7167631923698587`*^9, 3.7167653124350247`*^9, 
  3.7171556932721453`*^9, 3.7171575626207314`*^9, 3.717354914858255*^9, 
  3.7174161523932776`*^9, 3.7174179645333047`*^9, 3.7202682431217527`*^9, 
  3.7208064571168013`*^9, 3.7209937026548615`*^9, 3.721061236237527*^9, 
  3.7230546566345525`*^9, 3.7235044904828486`*^9, 3.7239811456939864`*^9, 
  3.728430083293228*^9, 3.740427997507474*^9, 3.763392468295323*^9, 
  3.7633930861798077`*^9, 3.764081540006856*^9, 3.764163803141763*^9, 
  3.7642444712672567`*^9, 3.764352075263568*^9, 3.7643697453138475`*^9, 
  3.7646961810497456`*^9, 3.8490248817267036`*^9, 3.8503108532556763`*^9, 
  3.901300263883131*^9, 3.906568250952043*^9, 3.906812976247024*^9, 
  3.906815427250087*^9, 3.906818041096034*^9, 3.90682370483321*^9, 
  3.906823954913611*^9},
 CellLabel->
  "Out[111]//MatrixForm=",ExpressionUUID->"5275e9d6-7e8f-4be3-bc23-\
e4f9d66b2fd7"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Define the local stiffness matrix (Note that the absolute value of the \
Jacobian determinant is used.  The mesh from omega_h can have inside out \
elements.):\
\>", "Subsection",
 CellChangeTimes->{{3.7171710837254143`*^9, 3.717171091066893*^9}, {
  3.7174287074048176`*^9, 
  3.7174287551552706`*^9}},ExpressionUUID->"bdd44eb5-b842-4022-84d3-\
48cc45df3a20"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Kmm", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", "B"}], ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KmmmNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", "B"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KmmNoAbs", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", "B"}], ")"}], 
    "detj"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Detj", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
    "]"}], "=", "detj"}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Gmatrix", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
    "]"}], "=", "B"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ktt", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Mu]_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "b", "]"}], ".", "s", ".", "b"}], ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kttNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Mu]_"}], "]"}], "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Transpose", "[", "b", "]"}], ".", "s", ".", "b"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kttNoAbs", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Mu]_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "b", "]"}], ".", "s", ".", "b"}], ")"}], 
    "detj"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kmt", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Alpha]_", ",", "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", 
      RowBox[{"(", 
       RowBox[{"\[Alpha]", " ", "Nb"}], ")"}]}], ")"}], 
    RowBox[{"Abs", "[", "detj", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kmtNoDet", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Alpha]_", ",", "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", 
     RowBox[{"(", 
      RowBox[{"\[Alpha]", " ", "Nb"}], ")"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kmtNoAbs", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_", ",", 
     "\[Alpha]_", ",", "kv_", ",", "vv_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Transpose", "[", "B", "]"}], ".", "S", ".", 
      RowBox[{"(", 
       RowBox[{"\[Alpha]", " ", "Nb"}], ")"}]}], ")"}], "detj"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gmatrix", "[", 
    RowBox[{
    "x1_", ",", "y1_", ",", "z1_", ",", "x2_", ",", "y2_", ",", "z2_", ",", 
     "x3_", ",", "y3_", ",", "z3_", ",", "x4_", ",", "y4_", ",", "z4_"}], 
    "]"}], "=", "b"}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdyk0og3EAx/EhhJJs2dqLMtQ2YiEORE+NyCw2hcUFY0JoFxJHakmNzKZs
Cu22UJS8HNjC8hJ52xTF8vZsivLSLvP/PYdvn8s3rbVPrYtksVhCElSa/pzS
VZqqDjvW4VxE+AjmxXE98OP3/BKKhja8sP21R/RO9FzNMLoN+xLIlrGlcLQ6
IxfWzhcx1oj9TbBA7NLCANds06/RVNBaZocX5ZVjXcQnF98I6zWN1m5i4vUm
Y0pqhSBrh6b0wiDj6HCoGE7OTpfA5JznZvglN7XAw/zFXih2dgxA1VnDMuSf
hBzMPxf1Fr1LUwtc+gPeW6a5MUSzhc2DWced6RqiX3KZAdtKbYffxLCX44GK
utgcfnyA0snHC+HP3oQCLikiq6DMMaUWEAvl0VpoGDn4g7efKyHo49jDUCU9
ZRz0JSULiY+qNB40avJZIqKyRBcDX9xbup6EAHX3cKOH2/fKPpidqe+H/3jJ
3FA=
  "],
 CellLabel->
  "In[112]:=",ExpressionUUID->"5097f0b4-33e2-4dc9-ad97-3185c9754446"],

Cell[CellGroupData[{

Cell["Single point Quadrature", "Subsubsection",
 CellChangeTimes->{{3.901300298846011*^9, 
  3.901300305531529*^9}},ExpressionUUID->"749ab860-4f3f-4672-b10c-\
23348b9fa28b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gp", "=", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"1", "/", "4"}], ",", 
      RowBox[{"1", "/", "4"}], ",", 
      RowBox[{"1", "/", "4"}]}], "}"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gw", "=", 
   RowBox[{"{", 
    RowBox[{"1", "/", "6"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.720277340993009*^9, 3.72027737961343*^9}, {
  3.7202774283513937`*^9, 3.7202774293658648`*^9}, {3.720278067092781*^9, 
  3.720278074392303*^9}, {3.9013003087402983`*^9, 3.9013003179906597`*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"3b481763-29c4-46bd-bd6a-36311ee75f76"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Four point quadrature", "Subsubsection",
 CellChangeTimes->{{3.901209491742765*^9, 
  3.901209494857337*^9}},ExpressionUUID->"a3d1944e-e8d6-43a7-a8ea-\
f474d13c6f5c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gp", " ", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0.585410196624969", ",", " ", "0.138196601125011", ",", " ", 
       "0.138196601125011"}], "}"}], ",", "\n", "           ", 
     RowBox[{"{", 
      RowBox[{
      "0.138196601125011", ",", " ", "0.585410196624969", ",", " ", 
       "0.138196601125011"}], "}"}], ",", "\n", "           ", 
     RowBox[{"{", 
      RowBox[{
      "0.138196601125011", ",", " ", "0.138196601125011", ",", " ", 
       "0.585410196624969"}], "}"}], ",", "\n", "          ", 
     RowBox[{"{", 
      RowBox[{
      "0.138196601125011", ",", " ", "0.138196601125011", ",", " ", 
       "0.138196601125011"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gw", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "24"}], ",", 
     RowBox[{"1", "/", "24"}], ",", 
     RowBox[{"1", "/", "24"}], ",", 
     RowBox[{"1", "/", "24"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.720277340993009*^9, 3.72027737961343*^9}, {
  3.7202774283513937`*^9, 3.7202774293658648`*^9}, {3.720278067092781*^9, 
  3.720278074392303*^9}, {3.9012095464404793`*^9, 3.901209641848001*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"cbeac1b2-0dd0-464c-8212-c989c0429ba1"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Define the mesh.  This mesh is produced by the build_box function in Omega_h.\
\>", "Subsection",
 CellChangeTimes->{{3.717171103353293*^9, 3.71717112863015*^9}, {
  3.7171711761508427`*^9, 
  3.717171184346429*^9}},ExpressionUUID->"85bd7e05-996a-4eee-966b-\
0722e79cd633"],

Cell[BoxData[
 RowBox[{
  RowBox[{"connect", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "12", ",", "3", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "3", ",", "4", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "4", ",", "1", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "10", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "10", ",", "9", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "9", ",", "12", ",", "13"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "13", ",", "4", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4", ",", "5", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "5", ",", "2", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "11", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "11", ",", "10", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "10", ",", "13", ",", "14"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "15", ",", "6", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "6", ",", "7", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "7", ",", "4", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4", ",", "13", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "13", ",", "12", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "12", ",", "15", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "16", ",", "7", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "7", ",", "8", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "8", ",", "5", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "5", ",", "14", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "14", ",", "13", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "13", ",", "16", ",", "17"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "21", ",", "12", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "12", ",", "13", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "13", ",", "10", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "10", ",", "19", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "19", ",", "18", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "18", ",", "21", ",", "22"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "22", ",", "13", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "13", ",", "14", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "14", ",", "11", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "11", ",", "20", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "20", ",", "19", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"10", ",", "19", ",", "22", ",", "23"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "24", ",", "15", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "15", ",", "16", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "16", ",", "13", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "13", ",", "22", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "22", ",", "21", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"12", ",", "21", ",", "24", ",", "25"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "25", ",", "16", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "16", ",", "17", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "17", ",", "14", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "14", ",", "23", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "23", ",", "22", ",", "26"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"13", ",", "22", ",", "25", ",", "26"}], "}"}]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7174169577864523`*^9, 3.7174169658023443`*^9}, 
   3.717417651397601*^9, {3.76409786087125*^9, 3.7640978639703207`*^9}, {
   3.7640978943425765`*^9, 3.7640978954822354`*^9}, {3.849008712370339*^9, 
   3.8490087306012497`*^9}},
 CellLabel->
  "In[128]:=",ExpressionUUID->"b20a5478-db60-4e62-9354-9d18e3df6b48"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"xv", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", 
     ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5", ",", "0.5", ",", "0.5", ",", "0.5", ",", "0.5", 
     ",", "0.5", ",", "0.5"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yv", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.5", 
     ",", "0.5", ",", "0.5"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zv", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5", ",", 
     RowBox[{"-", "0.5"}], ",", "0.0", ",", "0.5"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7174174700232644`*^9, 3.7174174845856824`*^9}, {
  3.717417517163823*^9, 3.717417642288141*^9}, {3.7210467593944297`*^9, 
  3.7210467621477776`*^9}, {3.849008737603016*^9, 3.8490087975493383`*^9}},
 CellLabel->
  "In[129]:=",ExpressionUUID->"b360755f-fafe-4d62-84f0-b467e1ab46d6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Rho]v", "=", 
  RowBox[{"Table", "[", 
   RowBox[{"1.0", ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "xv", "]"}]}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7209938116705494`*^9, 3.7209938528649826`*^9}},
 CellLabel->
  "In[132]:=",ExpressionUUID->"3f8a4881-197e-4320-8709-6e259833a9d9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", "1.`", ",", 
   "1.`", ",", "1.`", ",", "1.`"}], "}"}]], "Output",
 CellChangeTimes->{3.7209938545509453`*^9, 3.7210612745209227`*^9, 
  3.723054679712879*^9, 3.72350454129504*^9, 3.7239811528858366`*^9, 
  3.7284300924333024`*^9, 3.7404280094843683`*^9, 3.7633940799093127`*^9, 
  3.764081557678941*^9, 3.7641638161742373`*^9, 3.7642444821928463`*^9, 
  3.7643520906318407`*^9, 3.764369779082593*^9, 3.764696345668995*^9, 
  3.849024900383724*^9, 3.85031085400033*^9, 3.901300364395605*^9, 
  3.906568266307369*^9, 3.9068129763617907`*^9, 3.906815427382573*^9, 
  3.906818041236915*^9, 3.906823704949975*^9, 3.906823955013647*^9},
 CellLabel->
  "Out[132]=",ExpressionUUID->"b3218ee6-5d2b-42e4-8396-677967f7ba60"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"uv", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"4", "*", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "0"}], ",", 
   RowBox[{"i", "<", 
    RowBox[{"Length", "[", "xv", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "1"}], "]"}], "]"}], "=", 
     RowBox[{"1.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "2"}], "]"}], "]"}], "=", 
     RowBox[{"2.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "3"}], "]"}], "]"}], "=", 
     RowBox[{"3.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"i", "*", "4"}], "+", "4"}], "]"}], "]"}], "=", 
     RowBox[{"4.0", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], "i"}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7210466573505106`*^9, 3.721046659816079*^9}, {
  3.721046777601693*^9, 3.721046848873374*^9}, {3.763394142897538*^9, 
  3.763394168547328*^9}, {3.7641026246306195`*^9, 3.7641026375151596`*^9}, {
  3.764102795449109*^9, 3.764102980220702*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"3375a3de-6cf1-45be-a8ba-746b2137eeaa"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Assemble the global stiffness:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 
  3.71717120142911*^9}},ExpressionUUID->"efc90ca0-53b2-4b32-822f-\
a7b7005aaf30"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nnodes", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nmdofs", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ntdofs", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndofs", "=", 
   RowBox[{"nmdofs", "+", "ntdofs"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndofsTotal", "=", 
   RowBox[{"ndofs", " ", 
    RowBox[{"Length", "[", "xv", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.717166271741476*^9, 3.71716629726234*^9}, {
  3.717423563398694*^9, 3.717423566476555*^9}, {3.717424308471903*^9, 
  3.717424318282713*^9}, {3.7174279410435295`*^9, 3.717427953121283*^9}, {
  3.720806567996297*^9, 3.7208066398399677`*^9}, {3.7633996837483525`*^9, 
  3.763399728831224*^9}, {3.7640829218072453`*^9, 3.7640829235916023`*^9}, {
  3.90130037414714*^9, 3.90130037561325*^9}},
 CellLabel->
  "In[135]:=",ExpressionUUID->"81ae0957-eedc-47b4-9f01-542090505e2f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Kglobal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "ndofsTotal"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "ndofsTotal"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"Kmm", "[", 
            RowBox[{
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"1", "*", 
              SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"ktt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", "ConductionCoeff"}], 
             "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kmt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"inode", "=", "0"}], ",", 
         RowBox[{"inode", "<", "nnodes"}], ",", 
         RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"jnode", "=", "0"}], ",", 
           RowBox[{"jnode", "<", "nnodes"}], ",", 
           RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"idof", "=", "0"}], ",", 
              RowBox[{"idof", "<", "nmdofs"}], ",", 
              RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"jdof", "=", "0"}], ",", 
                RowBox[{"jdof", "<", "nmdofs"}], ",", 
                RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                    "]"}], "]"}], " ", "=", 
                  RowBox[{
                   RowBox[{"Kelmm", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                     "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Klocal", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], " ", "=", 
             RowBox[{
              RowBox[{"Keltt", "[", 
               RowBox[{"[", 
                RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"idof", "=", "0"}], ",", 
              RowBox[{"idof", "<", "nmdofs"}], ",", 
              RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Klocal", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                   "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}],
                   "]"}], "]"}], " ", "=", 
                RowBox[{"-", 
                 RowBox[{
                  RowBox[{"Kelmt", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", 
          RowBox[{"ndofs", " ", "nnodes"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"k", "=", "1"}], ",", 
           RowBox[{"k", "\[LessEqual]", 
            RowBox[{"ndofs", " ", "nnodes"}]}], ",", 
           RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Kglobal", "[", 
               RowBox[{"[", 
                RowBox[{"ids", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"ids", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "+=", 
             RowBox[{
              RowBox[{
               RowBox[{"Klocal", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", "j", "]"}], "]"}], "[", 
              RowBox[{"[", "k", "]"}], "]"}]}], ";"}]}], "]"}]}], "]"}]}]}]}],
     "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.723057650960129*^9, 3.7230576545889745`*^9}, {
   3.763398626297826*^9, 3.7633986377693434`*^9}, {3.763398969492062*^9, 
   3.763399017148432*^9}, {3.7633990692779627`*^9, 3.7633990694291053`*^9}, {
   3.7633991201481476`*^9, 3.763399174570841*^9}, {3.763399415268031*^9, 
   3.76339941606513*^9}, {3.7633996474373903`*^9, 3.7633996648412056`*^9}, {
   3.7633997501291094`*^9, 3.7633999258824277`*^9}, {3.7633999725549555`*^9, 
   3.763399976702032*^9}, {3.7634000083920765`*^9, 3.76340016737781*^9}, {
   3.7634002158964863`*^9, 3.76340029196223*^9}, {3.763400323496956*^9, 
   3.7634004027149053`*^9}, {3.76340045059245*^9, 3.763400463281616*^9}, {
   3.7634005294006834`*^9, 3.763400570424802*^9}, {3.764082973996101*^9, 
   3.764082975901887*^9}, {3.764085676134435*^9, 3.7640856834202404`*^9}, {
   3.7640858472503123`*^9, 3.7640858920767965`*^9}, {3.7640894255234814`*^9, 
   3.7640894257482643`*^9}, {3.7640894615887256`*^9, 
   3.7640894620724916`*^9}, {3.7640895179586363`*^9, 
   3.7640895273283195`*^9}, {3.7640896836413865`*^9, 
   3.7640896854169707`*^9}, {3.764098322843951*^9, 3.764098324217982*^9}, {
   3.7640983820840216`*^9, 3.764098382599674*^9}, {3.764099103461434*^9, 
   3.764099173185652*^9}, {3.764101764387092*^9, 3.7641017868352966`*^9}, {
   3.9013003886257877`*^9, 3.9013004676629667`*^9}, {3.901300562217903*^9, 
   3.9013005679311113`*^9}, {3.901300626681082*^9, 3.901300667320586*^9}, {
   3.9013007014037952`*^9, 3.901300719795032*^9}, 3.906823494524968*^9},
 CellLabel->
  "In[141]:=",ExpressionUUID->"c34493b0-9a33-4068-ad0f-1bec6c83e839"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Join", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "0"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "1"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "3"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Kglobal", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"4", "*", "4"}], "+", 
          RowBox[{"Mod", "[", 
           RowBox[{"i", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "15"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7641008499440265`*^9, 3.7641009191912155`*^9}, {
  3.764100982438418*^9, 3.764100994727434*^9}, {3.764101178024066*^9, 
  3.7641012178500237`*^9}, {3.849024914766542*^9, 3.849024919098242*^9}, {
  3.850310784891774*^9, 3.850310787834456*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"b3e54241-c144-4a67-8108-fecc89c10ac9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "3.5256410256410247802734375`18.*^10", ",", "0", ",", "0", ",", 
   "52083.3333333334303461015224456787109375`18.", ",", "0", ",", 
   "3.5256410256410247802734375`18.*^10", ",", "0", ",", 
   "52083.3333333334303461015224456787109375`18.", ",", "0", ",", "0", ",", 
   "3.5256410256410247802734375`18.*^10", ",", 
   "52083.3333333334303461015224456787109375`18.", ",", "0", ",", "0", ",", 
   "0", ",", "454.99999999999994315658113919198513031006`18.", ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", "0", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "0", ",", "0", ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "0", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   RowBox[{"-", "2.2435897435897430419921875`18.*^10"}], ",", 
   "52083.3333333334303461015224456787109375`18.", ",", "0", ",", "0", ",", 
   "0", ",", 
   RowBox[{"-", "151.66666666666665719276352319866418838501`18."}], ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "0", ",", "0", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   RowBox[{"-", "2.2435897435897430419921875`18.*^10"}], ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   "52083.3333333334303461015224456787109375`18.", ",", "0", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", 
   RowBox[{"-", "6.4102564102564096450805664062`18.*^9"}], ",", "0", ",", "0",
    ",", "0", ",", "0", ",", 
   RowBox[{"-", "151.66666666666665719276352319866418838501`18."}], ",", "0", 
   ",", "3.2051282051282048225402832031`18.*^9", ",", 
   "3.2051282051282048225402832031`18.*^9", ",", "0", ",", 
   "4.8076923076923065185546875`18.*^9", ",", "0", ",", 
   RowBox[{"-", "8.0128205128205108642578125`18.*^9"}], ",", 
   "26041.66666666671517305076122283935546875`18.", ",", 
   "4.8076923076923065185546875`18.*^9", ",", 
   RowBox[{"-", "8.0128205128205108642578125`18.*^9"}], ",", "0", ",", 
   "26041.66666666671517305076122283935546875`18.", ",", "0", ",", "0", ",", 
   "0", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{
  3.7641009213624554`*^9, 3.764100995781635*^9, 3.764101184303155*^9, 
   3.7641012190423956`*^9, {3.7641017730569844`*^9, 3.764101791077053*^9}, 
   3.7642444926062255`*^9, 3.7643521038190885`*^9, 3.7643697931429815`*^9, 
   3.7646963581104608`*^9, 3.849024920242338*^9, 3.850310855199905*^9, 
   3.901300747449258*^9, 3.9065682787583838`*^9, 3.906812979321817*^9, 
   3.9068154303325644`*^9, 3.906818044072084*^9, 3.906823707607893*^9, 
   3.906823958114038*^9},
 CellLabel->
  "Out[143]=",ExpressionUUID->"8c5821c3-5666-48ec-b25a-7c05ccab03b2"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute residual:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210554397242594`*^9, 
  3.7210554438131027`*^9}},ExpressionUUID->"244dcdc5-0303-47ed-87f2-\
4366ada70dba"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cellResidual", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "16"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"residual", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"ndofs", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"KmmNoAbs", "[", 
            RowBox[{
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"1", "*", 
              SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"kttNoAbs", "[", 
            RowBox[{
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", "ConductionCoeff"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kmtNoAbs", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"resid", "=", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Klocal", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cellResidual", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "=", "resid"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "16"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"residual", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{"resid", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "16"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"residual", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "-=", 
            RowBox[{"resid", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.721055446475813*^9, 
   3.7210554769975753`*^9}, {3.7210555442260976`*^9, 3.721055585763404*^9}, {
   3.7230547784118013`*^9, 3.7230547844740324`*^9}, {3.7230580841467104`*^9, 
   3.7230581803982973`*^9}, {3.7230585213381877`*^9, 3.723058522399741*^9}, {
   3.723515313727868*^9, 3.7235153825857706`*^9}, {3.7236621698838377`*^9, 
   3.7236621717519226`*^9}, {3.7236622124923797`*^9, 3.723662227510171*^9}, 
   3.7236622603736763`*^9, {3.723662501164076*^9, 3.7236625138790245`*^9}, 
   3.7236636246400113`*^9, {3.7236636643397217`*^9, 3.7236636653317575`*^9}, {
   3.723664443286131*^9, 3.723664465914736*^9}, {3.7236645478013163`*^9, 
   3.723664550184022*^9}, {3.7236649087859735`*^9, 3.723664911863844*^9}, {
   3.7642548499337397`*^9, 3.7642548561514874`*^9}, {3.7642548909189143`*^9, 
   3.7642549502424526`*^9}, {3.764255000130916*^9, 3.764255033148587*^9}, {
   3.7643520295878253`*^9, 3.7643520409484105`*^9}, {3.7643521412661023`*^9, 
   3.764352149703657*^9}, {3.7644887503812428`*^9, 3.7644887514710517`*^9}, {
   3.90130079934649*^9, 3.901300871369563*^9}, {3.906812863774949*^9, 
   3.9068128736257687`*^9}, {3.906813019261051*^9, 3.9068130279275227`*^9}, {
   3.9068131272304783`*^9, 3.906813131382316*^9}, 3.9068153022172213`*^9, 
   3.906823495909379*^9},
 CellLabel->
  "In[144]:=",ExpressionUUID->"3d13f7a6-bc69-44bd-beae-36f3f4a31410"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"residual", ",", "16"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}, {3.7210555900106316`*^9, 
  3.7210555918891406`*^9}},
 CellLabel->
  "In[148]:=",ExpressionUUID->"dd85986a-48bb-4199-acc2-53db025513df"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "60255.72275641025044023990631103515625`16."}], ",", 
   RowBox[{"-", "45512.3205128205008804798126220703125`16."}], ",", 
   RowBox[{"-", "46153.408653846141532994806766510009765625`16."}], ",", 
   RowBox[{"-", "0.00078866666666666668250584848465223331`16."}], ",", 
   RowBox[{"-", "63460.5176282051033922471106052398681640625`16."}], ",", 
   RowBox[{"-", "57691.536858974330243654549121856689453125`16."}], ",", 
   RowBox[{"-", "37499.9166666666642413474619388580322265625`16."}], ",", 
   RowBox[{"-", "0.00109200000000000008865130851631874975`16."}], ",", 
   RowBox[{"-", "3204.8365384615390212275087833404541015625`16."}], ",", 
   RowBox[{"-", "12179.2580128205081564374268054962158203125`16."}], ",", 
   "8653.32532051281668827868998050689697265625`16.", ",", 
   RowBox[{"-", "0.00030333333333333335193535140739129474`16."}], ",", 
   RowBox[{"-", "70191.078525641016312874853610992431640625`16."}], ",", 
   RowBox[{"-", "30768.9807692307585966773331165313720703125`16."}], ",", 
   RowBox[{"-", "58652.950320512798498384654521942138671875`16."}], ",", 
   RowBox[{"-", "0.00091000000000000000159594559789866253`16."}], ",", 
   RowBox[{"-", "86536.3365384615026414394378662109375`16."}], ",", 
   RowBox[{"-", "40384.240384615375660359859466552734375`16."}], ",", 
   RowBox[{"-", "53846.028846153829363174736499786376953125`16."}], ",", 
   RowBox[{"-", "0.00163799999999999926561522478607457742`16."}], ",", 
   RowBox[{"-", "16345.25801282050451845861971378326416015625`16."}], ",", 
   RowBox[{"-", "9615.25961538460796873550862073898315429688`16."}], ",", 
   "4806.67147435897913965163752436637878417969`16.", ",", 
   RowBox[{"-", "0.0007279999999999999145405826794785753`16."}], ",", 
   RowBox[{"-", "9935.48076923076951061375439167022705078125`16."}], ",", 
   "14742.83974358973864582367241382598876953125`16.", ",", 
   RowBox[{"-", "12499.66666666666060336865484714508056640625`16."}], ",", 
   RowBox[{"-", "0.00012133333333333342751031436179687262`16."}], ",", 
   RowBox[{"-", "23075.81891025638833525590598583221435546875`16."}], ",", 
   "17306.54647435896913520991802215576171875`16.", ",", 
   RowBox[{"-", "16346.112179487172397784888744354248046875`16."}], ",", 
   RowBox[{"-", "0.00054599999999999993590543700960893148`16."}], ",", 
   RowBox[{"-", "13140.29647435896549723111093044281005859375`16."}], ",", 
   "2563.74839743589654972311109304428100585938`16.", ",", 
   RowBox[{"-", "3846.52884615383754862705245614051818847656`16."}], ",", 
   RowBox[{"-", "0.00042466666666666650839512264781205886`16."}], ",", 
   RowBox[{"-", "47114.63461538459523580968379974365234375`16."}], ",", 
   RowBox[{"-", "48075.3189102563992491923272609710693359375`16."}], ",", 
   RowBox[{"-", "42306.171474358954583294689655303955078125`16."}], ",", 
   RowBox[{"-", "0.00036399999999999995727029133973928765`16."}], ",", 
   RowBox[{"-", "40383.4903846153974882327020168304443359375`16."}], ",", 
   RowBox[{"-", "74997.124999999956344254314899444580078125`16."}], ",", 
   RowBox[{"-", "21153.72115384612334310077130794525146484375`16."}], ",", 
   RowBox[{"-", "0.00054600000000000004432565425815937488`16."}], ",", 
   "6731.14423076924413180677220225334167480469`16.", ",", 
   RowBox[{"-", "26921.80608974355345708318054676055908203125`16."}], ",", 
   "21152.2003205128057743422687053680419921875`16.", ",", 
   RowBox[{"-", "0.00018199999999999954495427667566787022`16."}], ",", 
   RowBox[{"-", "53845.0288461538148112595081329345703125`16."}], ",", 
   RowBox[{"-", "21153.47115384614517097361385822296142578125`16."}], ",", 
   RowBox[{"-", "63458.413461538424598984420299530029296875`16."}], ",", 
   RowBox[{"-", "0.00018199999999999943653405942711742682`16."}], ",", 
   "2.24999999996907718013972043991088867187`16.", ",", 
   "0.7500000000363797880709171295166015625`16.", ",", 
   "0.25000000004729372449219226837158203125`16.", ",", 
   RowBox[{"-", "2.6020852139652106416178867220878601074219`16.*^-18"}], ",", 
   "53847.278846153873018920421600341796875`16.", ",", 
   "21154.22115384614517097361385822296142578125`16.", ",", 
   "63458.1634615384609787724912166595458984375`16.", ",", 
   "0.00018200000000000008705536291842008723`16.", ",", 
   RowBox[{"-", "6730.39423076921593747101724147796630859375`16."}], ",", 
   "26921.09775641029045800678431987762451171875`16.", ",", 
   RowBox[{"-", "21152.241987179426359944045543670654296875`16."}], ",", 
   "0.00018200000000000041231601466407141743`16.", ",", 
   "40385.740384615375660359859466552734375`16.", ",", "74996.375`16.", ",", 
   "21153.97115384620337863452732563018798828125`16.", ",", 
   "0.00054600000000000047800652325236114848`16.", ",", 
   "47116.134615384609787724912166595458984375`16.", ",", 
   "48075.27724358972045592963695526123046875`16.", ",", 
   "42305.963141025611548684537410736083984375`16.", ",", 
   "0.00036399999999999963200963959408795745`16.", ",", 
   "13139.58814102563155756797641515731811523437`16.", ",", 
   RowBox[{"-", "2563.37339743588472629198804497718811035156`16."}], ",", 
   "3846.86217948719695414183661341667175292969`16.", ",", 
   "0.00042466666666666661681533989636250226`16.", ",", 
   "23074.77724358976047369651496410369873046875`16.", ",", 
   RowBox[{"-", "17305.588141025626100599765777587890625`16."}], ",", 
   "16346.19551282052452734205871820449829101562`16.", ",", 
   "0.00054600000000000004432565425815937488`16.", ",", 
   "9935.23076923076951061375439167022705078125`16.", ",", 
   RowBox[{"-", "14742.1730769230562145821750164031982421875`16."}], ",", 
   "12499.25000000001091393642127513885498046875`16.", ",", 
   "0.00012133333333333310224966261614554242`16.", ",", 
   "16343.799679487172397784888744354248046875`16.", ",", 
   "9615.50961538461342570371925830841064453125`16.", ",", 
   RowBox[{"-", "4805.4631410255751688964664936065673828125`16."}], ",", 
   "0.0007279999999999991555990619396254715`16.", ",", 
   "86534.0865384615608491003513336181640625`16.", ",", 
   "40384.990384615448419936001300811767578125`16.", ",", 
   "53846.2788461538220872171223163604736328125`16.", ",", 
   "0.00163800000000000208454087324838610584`16.", ",", 
   "70190.286858974301139824092388153076171875`16.", ",", 
   "30769.48076923078042455017566680908203125`16.", ",", 
   "58651.4919871794772916473448276519775390625`16.", ",", 
   "0.00091000000000000032685659734354999273`16.", ",", 
   "3204.33653846154356870101764798164367675781`16.", ",", 
   "12178.63301282050633744802325963973999023438`16.", ",", 
   RowBox[{"-", "8652.20032051280759333167225122451782226562`16."}], ",", 
   "0.00030333333333333329772524278311607304`16.", ",", 
   "63459.3092948718040133826434612274169921875`16.", ",", 
   "57689.828525641001760959625244140625`16.", ",", 
   "37500.08333333340124227106571197509765625`16.", ",", 
   "0.00109199999999999922128957052791520255`16.", ",", 
   "60254.931089743578922934830188751220703125`16.", ",", 
   "45511.153846153829363174736499786376953125`16.", ",", 
   "46152.116987179455463774502277374267578125`16.", ",", 
   "0.00078866666666666603198454499334957291`16."}], "}"}]], "Output",
 CellChangeTimes->{
  3.720994987716754*^9, 3.7209950515695486`*^9, 3.721047011769689*^9, 
   3.7210555991426263`*^9, 3.7230547896617746`*^9, 3.7230579422718954`*^9, 
   3.7230581894138665`*^9, 3.723058528369447*^9, 3.7284301451527777`*^9, 
   3.740428267702957*^9, 3.7642550522420435`*^9, 3.764352117130268*^9, 
   3.7643521540564356`*^9, 3.764369803328337*^9, 3.764696369258808*^9, 
   3.84902508248343*^9, 3.8503108557597017`*^9, 3.901300886513913*^9, 
   3.9065682914503202`*^9, 3.906812981565693*^9, {3.906813116470566*^9, 
   3.906813141394661*^9}, 3.906815432549993*^9, 3.906818046363707*^9, 
   3.9068237097274647`*^9, 3.906823960161014*^9},
 CellLabel->
  "Out[148]=",ExpressionUUID->"89a9a426-1ca4-46c1-a23b-52e8bca6616f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"timestep", "=", 
   RowBox[{"1.0", "/", "2.0"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetPrecision", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "timestep"}], "*", 
    RowBox[{"cellResidual", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ",", "18"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"SetPrecision", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "timestep"}], "*", 
    RowBox[{"cellResidual", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], ",", "18"}], "]"}]}], "Input",
 CellChangeTimes->{{3.7646963750995417`*^9, 3.7646963979792156`*^9}, {
   3.7646968979183044`*^9, 3.7646969227158947`*^9}, 3.764697012816443*^9, {
   3.764697133303299*^9, 3.7646971453179884`*^9}},
 CellLabel->
  "In[149]:=",ExpressionUUID->"1c09f43a-6b59-40b8-a470-360d091ae652"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "3365.38461538461478994577191770076751708984`18."}], ",", 
   RowBox[{"-", "6249.85416666666696983156725764274597167969`18."}], ",", 
   RowBox[{"-", "1762.82051282051270391093567013740539550781`18."}], ",", 
   RowBox[{"-", "0.00004549999999999999465878641746741096`18."}], ",", 
   "2724.21314102564292625174857676029205322266`18.", ",", 
   "1602.56410256410254078218713402748107910156`18.", ",", 
   RowBox[{"-", "801.13621794871380643598968163132667541504`18."}], ",", 
   "0.00012133333333333337330020573752165092`18.", ",", 
   RowBox[{"-", "3846.00801282051224916358478367328643798828`18."}], ",", 
   "2884.46955128205127039109356701374053955078`18.", ",", 
   RowBox[{"-", "2724.35897435897368268342688679695129394531`18."}], ",", 
   RowBox[{"-", "0.00009099999999999998931757283493482191`18."}], ",", 
   "4487.17948717948638659436255693435668945312`18.", ",", 
   "1762.82051282051270391093567013740539550781`18.", ",", 
   "5288.31570512819871510146185755729675292969`18.", ",", 
   "0.0000151666666666666377812078270181928`18."}], "}"}]], "Output",
 CellChangeTimes->{{3.764696380390952*^9, 3.7646963989026318`*^9}, 
   3.764696924789734*^9, 3.7646970136639767`*^9, 3.7646971464189825`*^9, 
   3.764697544668732*^9, 3.8503108563997717`*^9, 3.9013010007080393`*^9, 
   3.906568308226101*^9, 3.9068129837340097`*^9, 3.906815434701148*^9, 
   3.906818048650762*^9, 3.906823709781691*^9, 3.906823960182383*^9},
 CellLabel->
  "Out[150]=",ExpressionUUID->"6d7510f7-4359-4769-84f9-1a5700eb89b6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "3365.38461538461524469312280416488647460937`18."}], ",", 
   RowBox[{"-", "6249.89583333333121117902919650077819824219`18."}], ",", 
   RowBox[{"-", "1762.82051282051247653726022690534591674805`18."}], ",", 
   RowBox[{"-", "0.00004549999999999999465878641746741096`18."}], ",", 
   RowBox[{"-", "1121.79487179487114190123975276947021484375`18."}], ",", 
   "4487.07532051281941676279529929161071777344`18.", ",", 
   RowBox[{"-", "3525.53685897435707374825142323970794677734`18."}], ",", 
   "0.0000303333333333333297725242783116073`18.", ",", 
   RowBox[{"-", "2724.25480769230625810450874269008636474609`18."}], ",", 
   RowBox[{"-", "1602.56410256410254078218713402748107910156`18."}], ",", 
   "801.17788461538350475166225805878639221191`18.", ",", 
   RowBox[{"-", "0.00012133333333333329198504280110881837`18."}], ",", 
   "7211.43429487179309944622218608856201171875`18.", ",", 
   "3365.38461538461524469312280416488647460937`18.", ",", 
   "4487.17948717948638659436255693435668945312`18.", ",", 
   "0.00013649999999999995687130494026462202`18."}], "}"}]], "Output",
 CellChangeTimes->{{3.764696380390952*^9, 3.7646963989026318`*^9}, 
   3.764696924789734*^9, 3.7646970136639767`*^9, 3.7646971464189825`*^9, 
   3.764697544668732*^9, 3.8503108563997717`*^9, 3.9013010007080393`*^9, 
   3.906568308226101*^9, 3.9068129837340097`*^9, 3.906815434701148*^9, 
   3.906818048650762*^9, 3.906823709781691*^9, 3.906823960191669*^9},
 CellLabel->
  "Out[151]=",ExpressionUUID->"5c16d1fb-a39c-4416-a315-5d589a27242b"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute residual gradient wrt control:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210554397242594`*^9, 3.7210554438131027`*^9}, {
  3.721059980929894*^9, 
  3.72105998715461*^9}},ExpressionUUID->"7c9809d2-c457-4456-a6d5-\
a61fb1ef5e96"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"residualGradient", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"4", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"Length", "[", "xv", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"nids", "=", 
        RowBox[{"{", 
         RowBox[{"i1", ",", "i2", ",", "i3", ",", "i4"}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"\[Phi]s", ".", 
              RowBox[{"{", 
               RowBox[{
               "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]3", ",", "\[Rho]4"}], 
               "}"}]}], ")"}], "*", 
            RowBox[{"Kmm", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"\[Phi]s", ".", 
              RowBox[{"{", 
               RowBox[{
               "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]3", ",", "\[Rho]4"}], 
               "}"}]}], ")"}], "*", 
            RowBox[{"ktt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", "ConductionCoeff"}], 
             "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"\[Phi]s", ".", 
              RowBox[{"{", 
               RowBox[{
               "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]3", ",", "\[Rho]4"}], 
               "}"}]}], ")"}], "*", 
            RowBox[{"kmt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"resid", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Klocal", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"d\[Rho]", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"resid", ",", "\[Rho]4"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Rho]1", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]2", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]3", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]4", "\[Rule]", "1.0"}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"Iv", "=", "1"}], ",", 
        RowBox[{"Iv", "\[LessEqual]", "16"}], ",", 
        RowBox[{"Iv", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"Jv", "=", "1"}], ",", 
          RowBox[{"Jv", "\[LessEqual]", "4"}], ",", 
          RowBox[{"Jv", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"residualGradient", "[", 
              RowBox[{"[", 
               RowBox[{"ids", "[", 
                RowBox[{"[", "Iv", "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"nids", "[", 
               RowBox[{"[", "Jv", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{
             RowBox[{"d\[Rho]", "[", 
              RowBox[{"[", "Jv", "]"}], "]"}], "[", 
             RowBox[{"[", "Iv", "]"}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.721055446475813*^9, 
   3.7210554769975753`*^9}, {3.7210555442260976`*^9, 3.721055585763404*^9}, {
   3.7230547784118013`*^9, 3.7230547844740324`*^9}, {3.7230580841467104`*^9, 
   3.7230581803982973`*^9}, {3.7230585213381877`*^9, 3.723058522399741*^9}, {
   3.723515313727868*^9, 3.7235153825857706`*^9}, {3.7236621698838377`*^9, 
   3.7236621717519226`*^9}, {3.7236622124923797`*^9, 3.723662227510171*^9}, 
   3.7236622603736763`*^9, {3.723662501164076*^9, 3.7236625138790245`*^9}, 
   3.7236636246400113`*^9, {3.7236636643397217`*^9, 3.7236636653317575`*^9}, {
   3.723664443286131*^9, 3.723664465914736*^9}, {3.7236645478013163`*^9, 
   3.723664550184022*^9}, {3.7236649087859735`*^9, 3.723664911863844*^9}, {
   3.7642548499337397`*^9, 3.7642548561514874`*^9}, {3.7642548909189143`*^9, 
   3.7642549502424526`*^9}, {3.764255000130916*^9, 3.764255033148587*^9}, {
   3.7643520295878253`*^9, 3.7643520409484105`*^9}, {3.7643521412661023`*^9, 
   3.764352149703657*^9}, {3.7643528854310064`*^9, 3.764352904073516*^9}, {
   3.764352941414873*^9, 3.764353069979911*^9}, {3.764366845191844*^9, 
   3.764366856703435*^9}, {3.9013010168583612`*^9, 3.9013010677240677`*^9}, {
   3.901301164029627*^9, 3.901301168760099*^9}, {3.9065681304486628`*^9, 
   3.9065682071539507`*^9}, {3.90656833754366*^9, 3.906568341824441*^9}, {
   3.9065687076652813`*^9, 3.906568771491714*^9}, 3.906823497144867*^9},
 CellLabel->
  "In[152]:=",ExpressionUUID->"2a05a9d5-c158-4e2b-9df7-37b20b9392ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"transposeResidGrad", "=", 
   RowBox[{"Transpose", "[", "residualGradient", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7643672034117346`*^9, 3.764367234235589*^9}},
 CellLabel->
  "In[155]:=",ExpressionUUID->"9c3e06ff-3981-4656-a17a-ebd2e6414983"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Join", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "0"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "1"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "3"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"transposeResidGrad", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"4", "*", "4"}], "+", "i"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7643531514936028`*^9, 3.7643531558462763`*^9}, {
   3.764353198654197*^9, 3.7643532501028695`*^9}, {3.7643602313882027`*^9, 
   3.764360302960787*^9}, 3.7643666855513444`*^9, 3.7643667533077087`*^9, {
   3.764367240159917*^9, 3.764367331564372*^9}, {3.764367379889902*^9, 
   3.764367551594491*^9}, {3.764367812262062*^9, 3.764367821166567*^9}, {
   3.849025719976519*^9, 3.849025725243576*^9}, {3.8490258591272507`*^9, 
   3.849025859419961*^9}, {3.850310816677911*^9, 3.850310819481145*^9}},
 CellLabel->
  "In[156]:=",ExpressionUUID->"2d6f92d8-65b7-4b13-af56-46b0d920e1c6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "15063.96506410259098629467189311981201171875`18."}], ",", 
   RowBox[{"-", "11378.10512820514668419491499662399291992187`18."}], ",", 
   RowBox[{"-", "11538.37403846155757491942495107650756835937`18."}], ",", 
   RowBox[{"-", "0.00019716666666666699588711386681438853`18."}], ",", 
   RowBox[{"-", "801.23205128205063374480232596397399902344`18."}], ",", 
   RowBox[{"-", "3044.83429487179864736390300095081329345703`18."}], ",", 
   "2163.37403846154211350949481129646301269531`18.", ",", 
   RowBox[{"-", "0.00007583333333333347350910941253587794`18."}], ",", 
   RowBox[{"-", "2483.91602564102959149749949574470520019531`18."}], ",", 
   "3685.79743589744248311035335063934326171875`18.", ",", 
   RowBox[{"-", "3124.95833333333757764194160699844360351563`18."}], ",", 
   RowBox[{"-", "0.00003033333333333338737076469160403036`18."}], ",", 
   RowBox[{"-", "3285.17724358974783172016032040119171142578`18."}], ",", 
   "640.98814102564233508019242435693740844727`18.", ",", 
   RowBox[{"-", "961.58012820512976759346202015876770019531`18."}], ",", 
   RowBox[{"-", "0.00010616666666666684393921515905390152`18."}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.76435329567939*^9, 3.764360304676647*^9, 3.764366754822819*^9, 
   3.764366861476902*^9, {3.764367529712575*^9, 3.7643675526795163`*^9}, 
   3.764367822471277*^9, 3.764369814616887*^9, 3.849025766942202*^9, 
   3.849025908326993*^9, 3.8503108570117064`*^9, 3.901301119112976*^9, 
   3.9013011762208242`*^9, 3.9065688017748537`*^9, 3.906812986841874*^9, 
   3.906815437533099*^9, 3.906818051789926*^9, 3.906823712940632*^9, 
   3.906823962812263*^9},
 CellLabel->
  "Out[156]=",ExpressionUUID->"7b81f044-1897-43bc-a3f2-367a820df9b6"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute residual gradient wrt config:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210490655350704`*^9, 3.7210490675964766`*^9}, {
  3.7230551164809313`*^9, 3.7230551185900598`*^9}, {3.72391300931705*^9, 
  3.7239130109421873`*^9}},ExpressionUUID->"ff4c22a0-dd62-43f0-b938-\
7b596e476580"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ndims", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"residualGradientX", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"ndofs", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"ndims", " ", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"nids", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"KmmNoAbs", "[", 
            RowBox[{
            "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
             "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", 
             ",", 
             RowBox[{"1", "*", 
              SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kttNoAbs", "[", 
             RowBox[{
             "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",",
               "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12",
               ",", "ConductionCoeff"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kmtNoAbs", "[", 
             RowBox[{
             "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",",
               "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12",
               ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "13", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "14", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "15", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "16", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Klocal", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x1"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x2"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x3"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x4"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x5"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x6"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x7"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x8"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x9"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x10"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x11"}], "]"}], ",", 
            RowBox[{"D", "[", 
             RowBox[{"energyInc", ",", "x12"}], "]"}]}], "}"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x1", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"x2", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"x3", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"x4", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
            RowBox[{"x5", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
            RowBox[{"x6", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
            RowBox[{"x7", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
            RowBox[{"x8", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
            RowBox[{"x9", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
            RowBox[{"x10", "\[Rule]", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
            RowBox[{"x11", "\[Rule]", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
            RowBox[{"x12", "\[Rule]", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}]}]}], "}"}]}], ")"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "16"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "12"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"residualGradientX", "[", 
                RowBox[{"[", 
                 RowBox[{"ids", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"nids", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "+=", 
              RowBox[{
               RowBox[{"du", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "k", "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "16"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "12"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"residualGradientX", "[", 
                RowBox[{"[", 
                 RowBox[{"ids", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"nids", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}], "-=", 
              RowBox[{
               RowBox[{"du", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "k", "]"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.720994042619423*^9, 3.7209941465012307`*^9}, {
   3.7209941931469326`*^9, 3.7209942823899403`*^9}, {3.7209945149606404`*^9, 
   3.7209945361169796`*^9}, {3.7209946799116*^9, 3.720994978291444*^9}, {
   3.7210470008455043`*^9, 3.7210470020792093`*^9}, {3.7210490923010983`*^9, 
   3.7210491222796535`*^9}, {3.7210491757545376`*^9, 
   3.7210493138722425`*^9}, {3.721049409321796*^9, 3.721049640653741*^9}, 
   3.721049765856733*^9, {3.723055124450037*^9, 3.723055129574788*^9}, {
   3.723055292912021*^9, 3.7230553309253855`*^9}, {3.7230553941804533`*^9, 
   3.7230554578048472`*^9}, {3.723055525200883*^9, 3.723055731450719*^9}, {
   3.723055828378682*^9, 3.7230558285355997`*^9}, {3.7230559085505037`*^9, 
   3.7230559544567056`*^9}, {3.723056073457146*^9, 3.723056217017265*^9}, {
   3.723056712834525*^9, 3.7230568061937404`*^9}, {3.7230570373170767`*^9, 
   3.723057041598381*^9}, {3.7230574604717684`*^9, 3.7230574691597023`*^9}, {
   3.7230576687082634`*^9, 3.723057672733388*^9}, {3.723057739783541*^9, 
   3.7230577772921667`*^9}, {3.723057872614895*^9, 3.7230578808186064`*^9}, {
   3.7230582312110176`*^9, 3.723058233179638*^9}, {3.7230582693977594`*^9, 
   3.7230583084759116`*^9}, {3.723058342960322*^9, 3.7230583468666005`*^9}, {
   3.7230585527283564`*^9, 3.723058554150366*^9}, {3.7237578674536314`*^9, 
   3.7237579530367565`*^9}, {3.723758026886219*^9, 3.7237580298343897`*^9}, {
   3.723758446116063*^9, 3.723758490487317*^9}, {3.723758534943349*^9, 
   3.7237586467179585`*^9}, {3.723758714374293*^9, 3.723758764328038*^9}, {
   3.7238390044561663`*^9, 3.7238390130181665`*^9}, 3.7240064066196632`*^9, {
   3.7643699495811386`*^9, 3.7643700097311172`*^9}, {3.7643700923307257`*^9, 
   3.7643701215110984`*^9}, {3.764370151609213*^9, 3.764370166796838*^9}, {
   3.7643702106485834`*^9, 3.764370256220153*^9}, {3.7643703518034716`*^9, 
   3.7643704077886024`*^9}, {3.7643704667596483`*^9, 
   3.7643705262711377`*^9}, {3.764370689802438*^9, 3.76437076794914*^9}, {
   3.901302348248796*^9, 3.901302403369968*^9}, 3.906823523908806*^9},
 CellLabel->
  "In[157]:=",ExpressionUUID->"2ca765d3-b04b-4da6-a120-d5599e351d92"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Join", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "0"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "1"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "3"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"SetPrecision", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "residualGradientX", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerPart", "[", 
            RowBox[{"i", "/", "4"}], "]"}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"4", "*", "4"}], "+", 
           RowBox[{"Mod", "[", 
            RowBox[{"i", ",", "4"}], "]"}], "+", "1"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "11"}], "}"}]}], "]"}], ",", "18"}], 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7404286333582754`*^9, 3.740428654853368*^9}, {
  3.7404290520183735`*^9, 3.740429084241135*^9}, {3.7404292209383698`*^9, 
  3.740429228261795*^9}, {3.740429300039175*^9, 3.740429335051546*^9}, {
  3.7404293828669925`*^9, 3.7404293919072895`*^9}, {3.7404294284083185`*^9, 
  3.740429432373372*^9}, {3.740429572932371*^9, 3.7404295929812984`*^9}, {
  3.7404296738800697`*^9, 3.74042969494425*^9}, {3.7404297512884207`*^9, 
  3.740429830968625*^9}, {3.7643705788999863`*^9, 3.764370604630294*^9}, {
  3.7643709839642286`*^9, 3.764371000964297*^9}, {3.764371055053582*^9, 
  3.7643710963249793`*^9}, {3.7643711690829134`*^9, 3.764371174572526*^9}, {
  3.764371212195264*^9, 3.764371237128933*^9}, {3.7643714163597193`*^9, 
  3.7643715060322227`*^9}, {3.849026017368067*^9, 3.849026022720343*^9}, {
  3.85031083210598*^9, 3.850310835031806*^9}},
 CellLabel->
  "In[161]:=",ExpressionUUID->"d3f2b56c-5dd7-407d-b26b-e6834b57de93"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "63461.538461538453702814877033233642578125`18."}], ",", 
   RowBox[{"-", "126923.076923076878301799297332763671875`18."}], ",", 
   RowBox[{"-", "190384.61538461534655652940273284912109375`18."}], ",", 
   RowBox[{"-", "0.00327599999999999939859218756055270205`18."}], ",", 
   RowBox[{"-", "21153.84615384614517097361385822296142578125`18."}], ",", 
   RowBox[{"-", "42307.6923076922903419472277164459228515625`18."}], ",", 
   RowBox[{"-", "63461.5384615384391508996486663818359375`18."}], ",", 
   RowBox[{"-", "0.00109199999999999965497043952211697615`18."}], ",", 
   RowBox[{"-", "7051.282051282047177664935588836669921875`18."}], ",", 
   RowBox[{"-", "14102.56410256409435532987117767333984375`18."}], ",", 
   RowBox[{"-", "21153.84615384615244693122804164886474609375`18."}], ",", 
   RowBox[{"-", "0.00036399999999999974042985684263840085`18."}], ",", 
   RowBox[{"-", "32371.79487179486386594362556934356689453125`18."}], ",", 
   RowBox[{"-", "9935.89743589743193297181278467178344726563`18."}], ",", 
   "82692.8076923076878301799297332763671875`18.", ",", 
   "0.00103133333333333310384560821404420494`18.", ",", 
   RowBox[{"-", "22756.41025641025407821871340274810791015625`18."}], ",", 
   RowBox[{"-", "8012.82051282050997542683035135269165039062`18."}], ",", 
   "13461.91346153844460786785930395126342773437`18.", ",", 
   "0.00030333333333333318930502553456562964`18.", ",", 
   "40704.6282051281887106597423553466796875`18.", ",", 
   "38140.6506410256333765573799610137939453125`18.", ",", 
   "36538.4615384615390212275087833404541015625`18.", ",", 
   "0.00084933333333333323363067979272500452`18.", ",", 
   RowBox[{"-", "19230.76923076922321342863142490386962890625`18."}], ",", 
   "32692.891025641016312874853610992431640625`18.", ",", 
   "10256.41025641025589720811694860458374023438`18.", ",", 
   "0.00090999999999999978475551110079777573`18.", ",", 
   "44871.21153846153174526989459991455078125`18.", ",", 
   "39743.589743589735007844865322113037109375`18.", ",", 
   "44871.3782051281959866173565387725830078125`18.", ",", 
   "0.00097066666666666655272077690597143373`18.", ",", 
   RowBox[{"-", "14102.56410256409799330867826938629150390625`18."}], ",", 
   RowBox[{"-", "18589.326923076921957544982433319091796875`18."}], ",", 
   RowBox[{"-", "5128.20512820512703910935670137405395507813`18."}], ",", 
   RowBox[{"-", "0.00006066666666666676796526580517365801`18."}], ",", 
   RowBox[{"-", "74679.48717948715784586966037750244140625`18."}], ",", 
   "5449.13461538462070166133344173431396484375`18.", ",", 
   RowBox[{"-", "5127.830128205125220119953155517578125`18."}], ",", 
   RowBox[{"-", "0.00024266666666666663818019422649285843`18."}], ",", 
   "14422.66025641025044023990631103515625`18.", ",", 
   "25961.53846153845734079368412494659423828125`18.", ",", 
   "25641.06730769230853184126317501068115234375`18.", ",", 
   "0.00054599999999999982748521976105848807`18.", ",", 
   "24038.08653846153174526989459991455078125`18.", ",", 
   "17628.1634615384609787724912166595458984375`18.", ",", 
   "20512.8205128205081564374268054962158203125`18.", ",", 
   "0.00054599999999999982748521976105848807`18."}], "}"}]], "Output",
 CellChangeTimes->{
  3.740429593978275*^9, 3.7404297027086763`*^9, 3.7404297629373703`*^9, {
   3.7404298121175528`*^9, 3.7404298325385866`*^9}, 3.7643706076169157`*^9, 
   3.7643708714311123`*^9, 3.7643712419865913`*^9, 3.76437152654244*^9, 
   3.8490260244451427`*^9, 3.850310906558487*^9, 3.901302537826303*^9, 
   3.906569720254034*^9, 3.906813076949144*^9, 3.906818143024043*^9, 
   3.906823801790255*^9, 3.906824051422401*^9},
 CellLabel->
  "Out[161]=",ExpressionUUID->"9237e4a2-4087-4a70-9b09-5484cdfef6ad"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 
  3.7209944015165186`*^9}},ExpressionUUID->"c231b8cc-4b08-446e-a581-\
cdfb2b99cd24"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"energySum", "=", "0.0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"energyInc", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"Kmm", "[", 
            RowBox[{
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"1", "*", 
              SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"ktt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", "ConductionCoeff"}], 
             "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kmt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"energyInc", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "=", 
       RowBox[{"disp", ".", 
        RowBox[{"Klocal", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energySum", "+=", 
       RowBox[{"energyInc", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.7167647605597653`*^9, 3.7167647892518883`*^9}, {
   3.7167648244240847`*^9, 3.716764841539942*^9}, {3.71676488019324*^9, 
   3.7167648969754357`*^9}, {3.716765065628334*^9, 3.716765185350045*^9}, {
   3.7167652229401484`*^9, 3.7167652383100395`*^9}, {3.7167653441168547`*^9, 
   3.7167655199547443`*^9}, {3.7167655675522327`*^9, 
   3.7167655810711265`*^9}, {3.716765622284607*^9, 3.7167656290567384`*^9}, {
   3.716765757154343*^9, 3.716765792076064*^9}, {3.7167658276745405`*^9, 
   3.7167660826802125`*^9}, {3.716766195664576*^9, 3.716766242915578*^9}, {
   3.7167663310833845`*^9, 3.7167663393539863`*^9}, {3.7167664503932595`*^9, 
   3.716766450932579*^9}, {3.7167664868258085`*^9, 3.7167665635541043`*^9}, {
   3.716766627651472*^9, 3.716766643645746*^9}, {3.716766826115865*^9, 
   3.7167668360695195`*^9}, {3.716766868385886*^9, 3.7167669130203*^9}, {
   3.717155721663645*^9, 3.7171557331420517`*^9}, {3.717155769178903*^9, 
   3.7171557818205233`*^9}, {3.7171567883516493`*^9, 3.717156887869956*^9}, {
   3.717156918335051*^9, 3.717156937057849*^9}, {3.717157017416103*^9, 
   3.717157052623994*^9}, {3.717157895689323*^9, 3.717157931742132*^9}, {
   3.717166282194605*^9, 3.71716628473459*^9}, {3.71716849797501*^9, 
   3.71716852298344*^9}, {3.717168562021318*^9, 3.717168562125424*^9}, {
   3.717168843821663*^9, 3.717168857297769*^9}, {3.7171692165304537`*^9, 
   3.7171692208302*^9}, {3.717170006857576*^9, 3.717170018830927*^9}, {
   3.717171209233417*^9, 3.717171213025419*^9}, {3.7173548750864697`*^9, 
   3.717354881757492*^9}, {3.717354996753583*^9, 3.717355017245678*^9}, {
   3.717355319697336*^9, 3.7173553216726255`*^9}, {3.7173557531181636`*^9, 
   3.7173557820403166`*^9}, {3.7173558138063755`*^9, 
   3.7173558166812677`*^9}, {3.7173587645155315`*^9, 
   3.7173587704721184`*^9}, {3.7173588122062426`*^9, 
   3.7173588501286516`*^9}, {3.717359014190798*^9, 3.7173590339564075`*^9}, {
   3.7173591194571896`*^9, 3.7173591202540846`*^9}, {3.717360749384885*^9, 
   3.717360755072524*^9}, {3.7173608405541487`*^9, 3.7173608453215923`*^9}, {
   3.7174176653039513`*^9, 3.7174177502357674`*^9}, {3.717418005127076*^9, 
   3.717418022383568*^9}, {3.7174180927900662`*^9, 3.717418180868244*^9}, {
   3.717419219270834*^9, 3.7174192266613092`*^9}, {3.71741926925568*^9, 
   3.717419272755123*^9}, {3.7174241468474283`*^9, 3.7174241510843997`*^9}, {
   3.71742429898483*^9, 3.717424381678406*^9}, {3.717427960779907*^9, 
   3.7174279724352093`*^9}, {3.7174281618258095`*^9, 
   3.7174281652786007`*^9}, {3.7208066594239817`*^9, 
   3.7208066657144737`*^9}, {3.723057650960129*^9, 3.7230576545889745`*^9}, {
   3.763398626297826*^9, 3.7633986377693434`*^9}, {3.763398969492062*^9, 
   3.763399017148432*^9}, {3.7633990692779627`*^9, 3.7633990694291053`*^9}, {
   3.7633991201481476`*^9, 3.763399174570841*^9}, {3.763399415268031*^9, 
   3.76339941606513*^9}, {3.7633996474373903`*^9, 3.7633996648412056`*^9}, {
   3.7633997501291094`*^9, 3.7633999258824277`*^9}, {3.7633999725549555`*^9, 
   3.763399976702032*^9}, {3.7634000083920765`*^9, 3.76340016737781*^9}, {
   3.7634002158964863`*^9, 3.76340029196223*^9}, {3.763400323496956*^9, 
   3.7634004027149053`*^9}, {3.76340045059245*^9, 3.763400463281616*^9}, {
   3.7634005294006834`*^9, 3.763400570424802*^9}, {3.764082973996101*^9, 
   3.764082975901887*^9}, {3.764085676134435*^9, 3.7640856834202404`*^9}, {
   3.7640858472503123`*^9, 3.7640858920767965`*^9}, {3.7640894255234814`*^9, 
   3.7640894257482643`*^9}, {3.7640894615887256`*^9, 
   3.7640894620724916`*^9}, {3.7640895179586363`*^9, 
   3.7640895273283195`*^9}, {3.7640896836413865`*^9, 
   3.7640896854169707`*^9}, {3.764098322843951*^9, 3.764098324217982*^9}, {
   3.7640983820840216`*^9, 3.764098382599674*^9}, {3.764099103461434*^9, 
   3.764099173185652*^9}, {3.764101764387092*^9, 3.7641017868352966`*^9}, {
   3.764162451449333*^9, 3.764162465312125*^9}, {3.764162509630781*^9, 
   3.764162550331856*^9}, {3.764162583165681*^9, 3.7641626039242*^9}, {
   3.764162639453498*^9, 3.764162731016221*^9}, 3.764162771654982*^9, {
   3.7641628042585936`*^9, 3.764162826582513*^9}, {3.764162885531745*^9, 
   3.76416292037608*^9}, 3.7641629564478016`*^9, {3.764163188990672*^9, 
   3.7641631922903223`*^9}, {3.7641633418697977`*^9, 
   3.7641633445908575`*^9}, {3.7641634102089243`*^9, 
   3.7641635244767513`*^9}, {3.7641636631227293`*^9, 
   3.7641636636004744`*^9}, {3.7641638975971966`*^9, 
   3.7641639005392556`*^9}, {3.901302565035802*^9, 3.901302626346901*^9}, 
   3.906823514545636*^9},
 CellLabel->
  "In[162]:=",ExpressionUUID->"24d59894-ebe9-4b86-8ae0-2abad28aff8a"],

Cell[CellGroupData[{

Cell[BoxData["energyInc"], "Input",
 CellChangeTimes->{{3.7641635291837215`*^9, 3.7641635303600173`*^9}},
 CellLabel->
  "In[166]:=",ExpressionUUID->"ab4c67dc-2192-40c7-a237-3e5d4e6ee0a9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.06679434789900511`", ",", "0.06679449789900513`", ",", 
   "0.06679453539900512`", ",", "0.06679442289900511`", ",", 
   "0.06679427289900514`", ",", "0.06679423539900511`", ",", 
   "0.06679427289900515`", ",", "0.06679442289900513`", ",", 
   "0.06679446039900512`", ",", "0.06679434789900512`", ",", 
   "0.06679419789900512`", ",", "0.06679416039900515`", ",", 
   "0.06679412289900516`", ",", "0.06679427289900512`", ",", 
   "0.0667943103990051`", ",", "0.0667941978990051`", ",", 
   "0.06679404789900523`", ",", "0.06679401039900523`", ",", 
   "0.06679404789900514`", ",", "0.06679419789900512`", ",", 
   "0.06679423539900513`", ",", "0.06679412289900512`", ",", 
   "0.06679397289900517`", ",", "0.06679393539900519`", ",", 
   "0.06679367289900516`", ",", "0.0667938228990052`", ",", 
   "0.06679386039900516`", ",", "0.06679374789900515`", ",", 
   "0.06679359789900531`", ",", "0.06679356039900523`", ",", 
   "0.06679359789900513`", ",", "0.06679374789900515`", ",", 
   "0.06679378539900513`", ",", "0.06679367289900515`", ",", 
   "0.06679352289900528`", ",", "0.06679348539900527`", ",", 
   "0.06679344789900522`", ",", "0.06679359789900521`", ",", 
   "0.06679363539900524`", ",", "0.06679352289900516`", ",", 
   "0.06679337289900529`", ",", "0.06679333539900514`", ",", 
   "0.06679337289900522`", ",", "0.06679352289900528`", ",", 
   "0.06679356039900508`", ",", "0.06679344789900514`", ",", 
   "0.06679329789900516`", ",", "0.06679326039900524`"}], "}"}]], "Output",
 CellChangeTimes->{3.7641639106273675`*^9, 3.764244525354228*^9, 
  3.849026184126997*^9, 3.850310907291497*^9, 3.901302632387951*^9, 
  3.9065697310777617`*^9, 3.906813079732633*^9, 3.906818145849119*^9, 
  3.9068238043283453`*^9, 3.906824054106534*^9},
 CellLabel->
  "Out[166]=",ExpressionUUID->"31b75efa-d318-40b8-a7ab-950d4c08576a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"energyInc", "[", 
      RowBox[{"[", "i", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "energyInc", "]"}]}], "}"}]}], "]"}], ",", 
   "18"}], "]"}]], "Input",
 CellChangeTimes->{{3.7641639175031357`*^9, 3.7641639430078697`*^9}, {
  3.7641716632883053`*^9, 3.7641716686992283`*^9}},
 CellLabel->
  "In[167]:=",ExpressionUUID->"2e2a8670-e2c7-46bc-918a-cb40a314e183"],

Cell[BoxData["3.20610709915224667554412008030340075493`18."], "Output",
 CellChangeTimes->{{3.7641639234457664`*^9, 3.7641639442960567`*^9}, 
   3.7641716695246778`*^9, 3.7642445875499754`*^9, 3.849026187713347*^9, 
   3.850310907369546*^9, 3.901302636173573*^9, 3.906569734647284*^9, 
   3.906813079763569*^9, 3.9068181458758698`*^9, 3.906823804348144*^9, 
   3.9068240541257277`*^9},
 CellLabel->
  "Out[167]=",ExpressionUUID->"0eda8e47-cff3-40f5-80df-22a9a590afc4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{
   RowBox[{"uv", ".", 
    RowBox[{"(", 
     RowBox[{"Kglobal", ".", "uv"}], ")"}]}], ",", "18"}], "]"}]], "Input",
 CellChangeTimes->{{3.7641030835250883`*^9, 3.764103152952297*^9}, {
  3.76418642397815*^9, 3.7641864313163605`*^9}},
 CellLabel->
  "In[168]:=",ExpressionUUID->"d1570907-066c-4748-b95e-468213e3c83b"],

Cell[BoxData["3.20610709915224845190095948055386543274`18."], "Output",
 CellChangeTimes->{{3.7641031161414948`*^9, 3.7641031537124987`*^9}, 
   3.764186431839634*^9, 3.7642445902025733`*^9, 3.8490261904834013`*^9, 
   3.850310907457419*^9, 3.901302638663908*^9, 3.9065697370516987`*^9, 
   3.906813079802432*^9, 3.906818145935892*^9, 3.906823804426218*^9, 
   3.90682405415699*^9},
 CellLabel->
  "Out[168]=",ExpressionUUID->"fc9c80cd-2989-412c-8bf6-4fea79187ac7"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy gradient wrt control:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}},ExpressionUUID->"97d17135-22ea-4a07-9c40-\
310abe0ecfb6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradZ", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "xv", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"energyInc", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"\[Phi]s", ".", 
              RowBox[{"{", 
               RowBox[{
               "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]3", ",", "\[Rho]4"}], 
               "}"}]}], ")"}], "*", 
            RowBox[{"Kmm", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"\[Phi]s", ".", 
              RowBox[{"{", 
               RowBox[{
               "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]3", ",", "\[Rho]4"}], 
               "}"}]}], ")"}], "*", 
            RowBox[{"ktt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", "ConductionCoeff"}], 
             "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"\[Phi]s", ".", 
              RowBox[{"{", 
               RowBox[{
               "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]3", ",", "\[Rho]4"}], 
               "}"}]}], ")"}], "*", 
            RowBox[{"kmt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", " ", 
       RowBox[{"disp", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Klocal", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"d\[Rho]", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "\[Rho]4"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Rho]1", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]2", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]3", "\[Rule]", "1.0"}], ",", 
           RowBox[{"\[Rho]4", "\[Rule]", "1.0"}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i1", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i2", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i3", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"gradZ", "[", 
        RowBox[{"[", "i4", "]"}], "]"}], "+=", 
       RowBox[{"d\[Rho]", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.7642442961606417`*^9, 3.7642443289943247`*^9}, {
   3.764244647880147*^9, 3.7642446516489763`*^9}, {3.901302661640698*^9, 
   3.9013027124278193`*^9}, {3.906569077722197*^9, 3.9065690997679033`*^9}, 
   3.90682351631502*^9},
 CellLabel->
  "In[169]:=",ExpressionUUID->"f37aaa3a-d67c-45b1-b0bb-6f32cc052f5a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"gradZ", ",", "16"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}},
 CellLabel->
  "In[173]:=",ExpressionUUID->"d6f007ba-4a56-49df-80d4-d3f209c1cd76"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.10019172434850792674509989410580601543`16.", ",", 
   "0.13358888329801058003631908377428771928`16.", ",", 
   "0.03339723394950264157010622056986903772`16.", ",", 
   "0.13358862079801062106021447561943205073`16.", ",", 
   "0.20038289369701578479521231201943010092`16.", ",", 
   "0.06679434789900526303618732981703942642`16.", ",", 
   "0.03339712144950264527398786640333128162`16.", ",", 
   "0.06679423539900526674006897565050167032`16.", ",", 
   "0.03339711394950263534386891706162714399`16.", ",", 
   "0.1335878332980107441319006511548650451`16.", ",", 
   "0.2003817686970161826565117735299281776`16.", ",", 
   "0.0667940103990053296589834985752531793`16.", ",", 
   "0.20038139369701615799534977213625097647`16.", ",", 
   "0.40076338739403138955452732261619530618`16.", ",", 
   "0.20038199369701503727014824107754975557`16.", ",", 
   "0.06679378539900536482232240587109117769`16.", ",", 
   "0.20038161869701501260898623968387255445`16.", ",", 
   "0.13358775829800978440786707324150484055`16.", ",", 
   "0.03339678394950272577457184297600178979`16.", ",", 
   "0.06679356039900552488575158349703997374`16.", ",", 
   "0.03339677644950273666113460535598278511`16.", ",", 
   "0.06679344789900543144511857462930493057`16.", ",", 
   "0.20038049369701510515895392927632201463`16.", ",", 
   "0.13358697079800985196840201751911081374`16.", ",", 
   "0.03339666394950274730391015509667340666`16.", ",", 
   "0.13358670829800978196999494684860110283`16.", ",", 
   "0.10018996934850694924268310614934307523`16."}], "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.7210616304729853`*^9, 3.723054948630515*^9, 
  3.764244340219616*^9, 3.7642446042574973`*^9, 3.764244658312017*^9, 
  3.8490302906571608`*^9, 3.850310908158937*^9, 3.9013027356831303`*^9, 
  3.906569764971218*^9, 3.9068130825601997`*^9, 3.9068181489109793`*^9, 
  3.906823807040517*^9, 3.9068240567946663`*^9},
 CellLabel->
  "Out[173]=",ExpressionUUID->"aa48b2b1-6210-4244-84bd-110fc16d2bbb"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy gradient wrt state:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210490655350704`*^9, 
  3.7210490675964766`*^9}},ExpressionUUID->"e4b55963-0f0d-4fb3-a72b-\
3edce8293b36"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradU", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"4", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"Kmm", "[", 
            RowBox[{
             RowBox[{"xv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i2", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i3", "]"}], "]"}], ",", 
             RowBox[{"xv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"yv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"zv", "[", 
              RowBox[{"[", "i4", "]"}], "]"}], ",", 
             RowBox[{"1", "*", 
              SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"ktt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", "ConductionCoeff"}], 
             "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kmt", "[", 
             RowBox[{
              RowBox[{"xv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i2", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i3", "]"}], "]"}], ",", 
              RowBox[{"xv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"yv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"zv", "[", 
               RowBox[{"[", "i4", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
        "u1", ",", "u2", ",", "u3", ",", "u4", ",", "u5", ",", "u6", ",", 
         "u7", ",", "u8", ",", "u9", ",", "u10", ",", "u11", ",", "u12", ",", 
         "u13", ",", "u14", ",", "u15", ",", "u16"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"disp", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Klocal", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u4"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u5"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u6"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u7"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u8"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u9"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u10"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u11"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u12"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u13"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u14"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u15"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "u16"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"u1", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u2", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u3", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u4", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u5", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u6", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u7", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u8", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u9", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u10", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u11", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u12", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u13", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "13", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u14", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "14", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u15", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "15", "]"}], "]"}], "]"}], "]"}]}], ",", 
           RowBox[{"u16", "\[Rule]", 
            RowBox[{"uv", "[", 
             RowBox[{"[", 
              RowBox[{"ids", "[", 
               RowBox[{"[", "16", "]"}], "]"}], "]"}], "]"}]}]}], "}"}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", "16"}], ",", 
        RowBox[{"j", "++"}], ",", 
        RowBox[{
         RowBox[{"gradU", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
         RowBox[{"du", "[", 
          RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.7642452569805026`*^9, 3.764245263358354*^9}, {
   3.764245305776163*^9, 3.764245328650949*^9}, {3.7642453588766627`*^9, 
   3.7642454488433666`*^9}, {3.764246854431797*^9, 3.7642468553631997`*^9}, {
   3.901302755345685*^9, 3.9013028039444847`*^9}, 3.906823517622718*^9},
 CellLabel->
  "In[174]:=",ExpressionUUID->"3e770a1f-6321-4a0a-bc72-ecdb75b93796"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"gradU", ",", "16"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}, {3.7210497813919053`*^9, 
  3.7210497819111586`*^9}},
 CellLabel->
  "In[177]:=",ExpressionUUID->"99935156-9011-484c-b000-1ee7202b119a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "120512.1330128205008804798126220703125`16."}], ",", 
   RowBox[{"-", "91025.141025640987209044396877288818359375`16."}], ",", 
   RowBox[{"-", "92307.25480769228306598961353302001953125`16."}], ",", 
   RowBox[{"-", "0.28282733333333387459873620173311792314`16."}], ",", 
   RowBox[{"-", "126922.05608974353526718914508819580078125`16."}], ",", 
   RowBox[{"-", "115383.844551281988970004022121429443359375`16."}], ",", 
   RowBox[{"-", "74999.916666666671517305076122283935546875`16."}], ",", 
   RowBox[{"-", "0.37718400000000068539307562787143979222`16."}], ",", 
   RowBox[{"-", "6409.9647435897422838024795055389404296875`16."}], ",", 
   RowBox[{"-", "24358.74519230767691624350845813751220703125`16."}], ",", 
   "17307.17147435896913520991802215576171875`16.", ",", 
   RowBox[{"-", "0.09435666666666683854991504176723537967`16."}], ",", 
   RowBox[{"-", "140383.38621794871869497001171112060546875`16."}], ",", 
   RowBox[{"-", "61538.211538461517193354666233062744140625`16."}], ",", 
   RowBox[{"-", "117306.7964743589400313794612884521484375`16."}], ",", 
   RowBox[{"-", "0.37682000000000065442762320344627369195`16."}], ",", 
   RowBox[{"-", "173074.7980769229470752179622650146484375`16."}], ",", 
   RowBox[{"-", "80768.855769230736768804490566253662109375`16."}], ",", 
   RowBox[{"-", "107692.18269230765872634947299957275390625`16."}], ",", 
   RowBox[{"-", "0.56577600000000094482288659492041915655`16."}], ",", 
   RowBox[{"-", "32691.41185897435570950619876384735107421875`16."}], ",", 
   RowBox[{"-", "19230.64423076922321342863142490386962890625`16."}], ",", 
   "9614.363782051295856945216655731201171875`16.", ",", 
   RowBox[{"-", "0.18895600000000037366199023836088599637`16."}], ",", 
   RowBox[{"-", "19871.37820512820690055377781391143798828125`16."}], ",", 
   "29486.42948717947001568973064422607421875`16.", ",", 
   RowBox[{"-", "24999.6666666666787932626903057098388671875`16."}], ",", 
   RowBox[{"-", "0.0939926666666668075844626173420692794`16."}], ",", 
   RowBox[{"-", "46152.741987179455463774502277374267578125`16."}], ",", 
   "34614.2387820512885809876024723052978515625`16.", ",", 
   RowBox[{"-", "32692.26602564100539893843233585357666015625`16."}], ",", 
   RowBox[{"-", "0.18859200000000031494096219830680638552`16."}], ",", 
   RowBox[{"-", "26281.322115384609787724912166595458984375`16."}], ",", 
   "5127.85096153846552624600008130073547363281`16.", ",", 
   RowBox[{"-", "7692.68269230767509725410491228103637695313`16."}], ",", 
   RowBox[{"-", "0.09459933333333350735649958096473710611`16."}], ",", 
   RowBox[{"-", "94230.019230769205023534595966339111328125`16."}], ",", 
   RowBox[{"-", "96152.2419871794409118592739105224609375`16."}], ",", 
   RowBox[{"-", "84613.86378205125220119953155517578125`16."}], ",", 
   RowBox[{"-", "0.37572800000000067255356839268642943352`16."}], ",", 
   RowBox[{"-", "80768.1057692308095283806324005126953125`16."}], ",", 
   RowBox[{"-", "149997.12499999997089616954326629638671875`16."}], ",", 
   RowBox[{"-", "42307.5673076921957544982433319091796875`16."}], ",", 
   RowBox[{"-", "0.5635920000000009810747769734007306397`16."}], ",", 
   "13461.91346153849372058175504207611083984375`16.", ",", 
   RowBox[{"-", "53844.883012820428120903670787811279296875`16."}], ",", 
   "42306.046474358925479464232921600341796875`16.", ",", 
   RowBox[{"-", "0.18786400000000025301005734945647418499`16."}], ",", 
   RowBox[{"-", "107691.18269230765872634947299957275390625`16."}], ",", 
   RowBox[{"-", "42307.31730769228306598961353302001953125`16."}], ",", 
   RowBox[{"-", "126919.951923076834646053612232208251953125`16."}], ",", 
   RowBox[{"-", "0.56286400000000080812156966203474439681`16."}], ",", 
   "2.25`16.", ",", "0.7500000000654836185276508331298828125`16.", ",", 
   "0.2500000001091393642127513885498046875`16.", ",", 
   RowBox[{"-", "1.125`16."}], ",", 
   "107693.43269230774603784084320068359375`16.", ",", 
   "42308.0673076923121698200702667236328125`16.", ",", 
   "126919.701923076878301799297332763671875`16.", ",", 
   RowBox[{"-", "0.56213599999999863676691802538698539138`16."}], ",", 
   RowBox[{"-", "13461.16346153840640909038484096527099609375`16."}], ",", 
   "53844.174679487230605445802211761474609375`16.", ",", 
   RowBox[{"-", "42306.088141025524237193167209625244140625`16."}], ",", 
   RowBox[{"-", "0.1871360000000003853681818100085365586`16."}], ",", 
   "80770.355769230736768804490566253662109375`16.", ",", 
   "149996.37499999997089616954326629638671875`16.", ",", 
   "42307.817307692326721735298633575439453125`16.", ",", 
   RowBox[{"-", "0.56140799999999868585831563905230723321`16."}], ",", 
   "94231.519230769234127365052700042724609375`16.", ",", 
   "96152.20032051275484263896942138671875`16.", ",", 
   "84613.655448717923718504607677459716796875`16.", ",", 
   RowBox[{"-", "0.37427199999999838375686067593051120639`16."}], ",", 
   "26280.6137820512740290723741054534912109375`16.", ",", 
   RowBox[{"-", "5127.4759615384464268572628498077392578125`16."}], ",", 
   "7693.01602564107088255695998668670654296875`16.", ",", 
   RowBox[{"-", "0.09290066666666682571040780658222502097`16."}], ",", 
   "46151.70032051284215413033962249755859375`16.", ",", 
   RowBox[{"-", "34613.2804487178873387165367603302001953125`16."}], ",", 
   "32692.34935897442119312472641468048095703125`16.", ",", 
   RowBox[{"-", "0.18640800000000046221515503930277191103`16."}], ",", 
   "19871.12820512818507268093526363372802734375`16.", ",", 
   RowBox[{"-", "29485.7628205127912224270403385162353515625`16."}], ",", 
   "24999.25000000004001776687800884246826171875`16.", ",", 
   RowBox[{"-", "0.09350733333333352548244477020489284769`16."}], ",", 
   "32689.95352564103450276888906955718994140625`16.", ",", 
   "19230.894230769205023534595966339111328125`16.", ",", 
   RowBox[{"-", "9613.1554487178291310556232929229736328125`16."}], ",", 
   RowBox[{"-", "0.18604400000000037573855138361977878958`16."}], ",", 
   "173072.548076923121698200702667236328125`16.", ",", 
   "80769.60576923095504753291606903076171875`16.", ",", 
   "107692.432692307644174434244632720947265625`16.", ",", 
   RowBox[{"-", "0.55922399999999883313250848004827275872`16."}], ",", 
   "140382.59455128191621042788028717041015625`16.", ",", 
   "61538.7115384615681250579655170440673828125`16.", ",", 
   "117305.3381410256843082606792449951171875`16.", ",", 
   RowBox[{"-", "0.37317999999999840188280586517066694796`16."}], ",", 
   "6409.46474358975865470711141824722290039063`16.", ",", 
   "24358.1201923077096580527722835540771484375`16.", ",", 
   RowBox[{"-", "17306.04647435896913520991802215576171875`16."}], ",", 
   RowBox[{"-", "0.09314333333333346676141673015081323683`16."}], ",", 
   "126920.847756410264992155134677886962890625`16.", ",", 
   "115382.136217948645935393869876861572265625`16.", ",", 
   "75000.083333333386690355837345123291015625`16.", ",", 
   RowBox[{"-", "0.3728159999999983709173534407455008477`16."}], ",", 
   "120511.3413461538148112595081329345703125`16.", ",", 
   "91023.97435897434479556977748870849609375`16.", ",", 
   "92305.963141025626100599765777587890625`16.", ",", 
   RowBox[{"-", "0.27967266666666501517823917311034165323`16."}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.721049783085235*^9, 3.7210616458831215`*^9, 
  3.7230549598023367`*^9, 3.764245463887192*^9, 3.764246859671549*^9, 
  3.849030386030761*^9, 3.8503109088434277`*^9, 3.901302810720086*^9, 
  3.9068130847825413`*^9, 3.906818151212592*^9, 3.906823809307026*^9, 
  3.906824059124544*^9},
 CellLabel->
  "Out[177]=",ExpressionUUID->"1e6fa520-7130-4858-a3c9-8bebf603be97"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute internal energy gradient wrt config:", "Subsection",
 CellChangeTimes->{{3.7171711972127666`*^9, 3.71717120142911*^9}, {
  3.7209943882500362`*^9, 3.7209944015165186`*^9}, {3.721049011972142*^9, 
  3.721049018596589*^9}, {3.7210490655350704`*^9, 3.7210490675964766`*^9}, {
  3.7230551164809313`*^9, 
  3.7230551185900598`*^9}},ExpressionUUID->"71f5f912-94f1-4ebd-90b7-\
ef6a06717c81"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ndims", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradX", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"3", 
        RowBox[{"Length", "[", "xv", "]"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Klocal", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "connect", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"nnodes", "*", "ndofs"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", "=", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", " ", 
    RowBox[{"Length", "[", "connect", "]"}]}], ",", 
   RowBox[{"i", "++"}], ",", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"i4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"connect", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "[", 
          RowBox[{"[", "4", "]"}], "]"}], "+", "1"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          RowBox[{
           RowBox[{"ndofs", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "4"}]}], 
         "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"xids", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "1"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i1", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i2", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", " ", 
            RowBox[{"(", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i3", "-", "1"}], ")"}]}], "+", "3"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "1"}], ",", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ndims", 
            RowBox[{"(", " ", 
             RowBox[{"i4", "-", "1"}], ")"}]}], "+", "3"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Kelmm", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Keltt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kelmt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "gp", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Kelmm", "+=", 
          RowBox[{
           RowBox[{"gw", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "*", 
           RowBox[{"KmmNoAbs", "[", 
            RowBox[{
            "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",", 
             "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12", 
             ",", 
             RowBox[{"1", "*", 
              SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Keltt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kttNoAbs", "[", 
             RowBox[{
             "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",",
               "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12",
               ",", "ConductionCoeff"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Kelmt", "+=", 
          RowBox[{
           RowBox[{
            RowBox[{"gw", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"kmtNoAbs", "[", 
             RowBox[{
             "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6", ",",
               "x7", ",", "x8", ",", "x9", ",", "x10", ",", "x11", ",", "x12",
               ",", 
              RowBox[{"1.0", "*", 
               SuperscriptBox["10", 
                RowBox[{"-", "5"}]]}], ",", 
              RowBox[{"1", "*", 
               SuperscriptBox["10", "11"]}], ",", "0.3"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Xi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"\[Psi]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"\[Zeta]", "\[Rule]", 
              RowBox[{
               RowBox[{"gp", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"inode", "=", "0"}], ",", 
        RowBox[{"inode", "<", "nnodes"}], ",", 
        RowBox[{"inode", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"jnode", "=", "0"}], ",", 
          RowBox[{"jnode", "<", "nnodes"}], ",", 
          RowBox[{"jnode", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"jdof", "=", "0"}], ",", 
               RowBox[{"jdof", "<", "nmdofs"}], ",", 
               RowBox[{"jdof", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Klocal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                    "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "ndofs"}], "+", "jdof", "+", "1"}], 
                   "]"}], "]"}], " ", "=", 
                 RowBox[{
                  RowBox[{"Kelmm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                     "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"jnode", " ", "nmdofs"}], "+", "jdof", "+", "1"}],
                    "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Klocal", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"inode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
               "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
              "]"}], "]"}], " ", "=", 
            RowBox[{
             RowBox[{"Keltt", "[", 
              RowBox[{"[", 
               RowBox[{"inode", "+", "1"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"idof", "=", "0"}], ",", 
             RowBox[{"idof", "<", "nmdofs"}], ",", 
             RowBox[{"idof", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Klocal", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"inode", " ", "ndofs"}], "+", "idof", "+", "1"}], 
                  "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"jnode", " ", "ndofs"}], "+", "nmdofs", "+", "1"}], 
                 "]"}], "]"}], " ", "=", 
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"Kelmt", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"inode", " ", "nmdofs"}], "+", "idof", "+", "1"}],
                    "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"jnode", "+", "1"}], "]"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"disp", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "7", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "8", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "9", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "10", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "11", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "12", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "13", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "14", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "15", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"uv", "[", 
          RowBox[{"[", 
           RowBox[{"ids", "[", 
            RowBox[{"[", "16", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energyInc", "=", 
       RowBox[{"disp", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Klocal", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ".", "disp"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"du", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x1"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x2"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x3"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x4"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x5"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x6"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x7"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x8"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x9"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x10"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x11"}], "]"}], ",", 
           RowBox[{"D", "[", 
            RowBox[{"energyInc", ",", "x12"}], "]"}]}], "}"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x1", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x2", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x3", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"x4", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x5", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x6", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i2", "]"}], "]"}]}], ",", 
           RowBox[{"x7", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x8", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x9", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i3", "]"}], "]"}]}], ",", 
           RowBox[{"x10", "\[Rule]", 
            RowBox[{"xv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
           RowBox[{"x11", "\[Rule]", 
            RowBox[{"yv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}], ",", 
           RowBox[{"x12", "\[Rule]", 
            RowBox[{"zv", "[", 
             RowBox[{"[", "i4", "]"}], "]"}]}]}], "}"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Detj", "[", 
          RowBox[{
           RowBox[{"xv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i1", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i2", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i3", "]"}], "]"}], ",", 
           RowBox[{"xv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"yv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}], ",", 
           RowBox[{"zv", "[", 
            RowBox[{"[", "i4", "]"}], "]"}]}], "]"}], "\[GreaterEqual]", 
         "0.0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "12"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"gradX", "[", 
             RowBox[{"[", 
              RowBox[{"xids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "+=", 
            RowBox[{"du", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "12"}], ",", 
           RowBox[{"j", "++"}], ",", 
           RowBox[{
            RowBox[{"gradX", "[", 
             RowBox[{"[", 
              RowBox[{"xids", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "-=", 
            RowBox[{"du", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ";"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.76424600551651*^9, 3.7642461711801653`*^9}, {
   3.7642462028071766`*^9, 3.764246220213563*^9}, {3.764246283329853*^9, 
   3.764246293892589*^9}, {3.7642463610108213`*^9, 3.7642464906323004`*^9}, {
   3.7642465289172134`*^9, 3.764246546403119*^9}, {3.7642466386150875`*^9, 
   3.7642466547357836`*^9}, {3.7642466873858633`*^9, 3.764246732945367*^9}, {
   3.7642468131619663`*^9, 3.7642468162460403`*^9}, {3.7642468752406893`*^9, 
   3.7642468758494267`*^9}, {3.7642471307562113`*^9, 
   3.7642472796655865`*^9}, {3.764247331374629*^9, 3.7642473324519873`*^9}, {
   3.764254726830079*^9, 3.764254727571266*^9}, {3.901302872488481*^9, 
   3.9013029178737307`*^9}, 3.9068235190558167`*^9},
 CellLabel->
  "In[178]:=",ExpressionUUID->"be657270-67b8-4aaa-92f3-915c61968609"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetPrecision", "[", 
  RowBox[{"gradX", ",", "20"}], "]"}]], "Input",
 CellChangeTimes->{{3.7209949856957116`*^9, 3.7209949866369324`*^9}, {
  3.720995044627005*^9, 3.720995050464894*^9}, {3.7210497813919053`*^9, 
  3.7210497819111586`*^9}, {3.7230570968479857`*^9, 3.7230571009733553`*^9}, {
  3.7230574419255185`*^9, 3.7230574467536917`*^9}, {3.764247363281391*^9, 
  3.764247364672212*^9}, {3.764248028186861*^9, 3.764248029554489*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"60f95087-2624-489a-ae62-8774721a33fc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.77589451783770235770987255818909034133`20.", ",", 
   "0.08051281988188732641198441797314444557`20.", ",", 
   RowBox[{"-", "0.15128107943671792456896696421608794481`20."}], ",", 
   "0.64807554467692307653692296298686414957`20.", ",", 
   RowBox[{"-", "0.05115276003704613549949442585784709081`20."}], ",", 
   "0.11653820078566154427868184484395897016`20.", ",", 
   RowBox[{"-", "0.12781799816077943354741819348419085145`20."}], ",", 
   RowBox[{"-", "0.13166535491893333054136405735334847122`20."}], ",", 
   "0.26781880522237944131092035604524426162`20.", ",", 
   "0.7069195584022767153697941466816700995`20.", ",", 
   "0.36922902359876902389501651668979320675`20.", ",", 
   RowBox[{"-", "0.2776899711944409432362590450793504715`20."}], ",", 
   "0.38230950264529212079267495028034318238`20.", ",", 
   "0.39461479247778485923703328808187507093`20.", ",", 
   "0.13153826415926159199010214706504484639`20.", ",", 
   RowBox[{"-", "0.32460870575698441697909402137156575918`20."}], ",", 
   "0.02538621887901528623165958720164780971`20.", ",", 
   "0.40922748535370234712615911121247336268`20.", ",", 
   RowBox[{"-", "0.06897270943542566090656009691883809865`20."}], ",", 
   "0.28871530371688192140311457478674128652`20.", ",", 
   RowBox[{"-", "0.1264090417577230784917929895527777262`20."}], ",", 
   RowBox[{"-", "0.26576334203163087810395381893613375723`20."}], ",", 
   "0.44576575251483063766499981284141540527`20.", ",", 
   "0.01500036337360008409369527271337574348`20.", ",", 
   RowBox[{"-", "0.19679025759620502600277802685013739392`20."}], ",", 
   "0.15705067379794865334297071512992260978`20.", ",", 
   "0.14140913013132305753316586560686118901`20.", ",", 
   "0.97267967543390776441469824931118637323`20.", ",", 
   RowBox[{"-", "0.07653780391606160304895922763535054401`20."}], ",", 
   RowBox[{"-", "0.29268854290137430451679279030940961093`20."}], ",", 
   "0.91383716170855344707035783358151093125`20.", ",", 
   RowBox[{"-", "0.49691708755187669055430887965485453606`20."}], ",", 
   "0.10153746241206178246851976609832490794`20.", ",", 
   RowBox[{"-", "0.05884116372535351524586388904936029576`20."}], ",", 
   RowBox[{"-", "0.42037883363581518558760308224009349942`20."}], ",", 
   "0.39422525531343571847386897388787474483`20.", ",", 
   "1.03152226415926162594871584587963297963`20.", ",", 
   "0.34384075471975394933110692363698035479`20.", ",", 
   RowBox[{"-", "0.68691408988147628633669228293001651764`20."}], ",", 
   RowBox[{"-", "1.1102230246251565404236316680908203125`20.*^-16"}], ",", 
   "6.938893903907228377647697925567626953125`20.*^-17", ",", 
   "1.2490009027033011079765856266021728515625`20.*^-16", ",", 
   RowBox[{"-", "1.03151956415926138177496795833576470613`20."}], ",", 
   RowBox[{"-", "0.34383985471975408998446255282033234835`20."}], ",", 
   "0.68691258988147674280355658993357792497`20.", ",", 
   "0.05884528872535357835182878716295817867`20.", ",", 
   "0.42037675863581441815242101256444584578`20.", ",", 
   RowBox[{"-", "0.3942252469801024172824099878198467195`20."}], ",", 
   RowBox[{"-", "0.91383176170855351383437437107204459608`20."}], ",", 
   "0.49691348755187680907852154632564634085`20.", ",", 
   RowBox[{"-", "0.10153686241206150153715270789689384401`20."}], ",", 
   RowBox[{"-", "0.9726757004339072754106609863811172545`20."}], ",", 
   "0.07653717891606176548791040659125428647`20.", ",", 
   "0.29268763456804075540063081461994443089`20.", ",", 
   "0.19678583259620519019250650671892799437`20.", ",", 
   RowBox[{"-", "0.15704994879794847983944805491773877293`20."}], ",", 
   RowBox[{"-", "0.1414081384646564409912627979792887345`20."}], ",", 
   "0.26575756703163078142893027688842266798`20.", ",", 
   RowBox[{"-", "0.445762977514830738279272281943121925`20."}], ",", 
   RowBox[{"-", "0.01500028837360013744817166525535867549`20."}], ",", 
   "0.06897210943542550487528330904751783237`20.", ",", 
   RowBox[{"-", "0.28871280371688212706970944054774008691`20."}], ",", 
   "0.12640757509105643441316146891040261835`20.", ",", 
   "0.3245986557569842112513924803351983428`20.", ",", 
   RowBox[{"-", "0.02538691887901550758854796185914892703`20."}], ",", 
   RowBox[{"-", "0.40922366868703552444941351495799608529`20."}], ",", 
   RowBox[{"-", "0.38231760264529202064665014404454268515`20."}], ",", 
   RowBox[{"-", "0.39461209247778505915249525060062296689`20."}], ",", 
   RowBox[{"-", "0.13153736415926203795478954816644545645`20."}], ",", 
   RowBox[{"-", "0.70691490840227688696728591821738518775`20."}], ",", 
   RowBox[{"-", "0.36922472359876923331256648452836088836`20."}], ",", 
   "0.27768555452777410330611473909812048078`20.", ",", 
   "0.12781327316077983891062785914982669055`20.", ",", 
   "0.13166212991893330719328503164433641359`20.", ",", 
   RowBox[{"-", "0.26781508022237954236288715037517249584`20."}], ",", 
   RowBox[{"-", "0.64807246967692255790183253338909707963`20."}], ",", 
   "0.05114908503704619635588102255496778525`20.", ",", 
   RowBox[{"-", "0.11653677578566110084601348262367537245`20."}], ",", 
   RowBox[{"-", "0.77588476783770232714232406578958034515`20."}], ",", 
   RowBox[{"-", "0.08051281988188750682322591956108226441`20."}], ",", 
   "0.15127782943671788662420851778733776882`20."}], "}"}]], "Output",
 CellChangeTimes->{3.720994987716754*^9, 3.7209950515695486`*^9, 
  3.721047011769689*^9, 3.721049783085235*^9, 3.7210616458831215`*^9, 
  3.7230549598023367`*^9, 3.723057053332902*^9, 3.723057102083436*^9, 
  3.7230574482999644`*^9, 3.7230575621588583`*^9, 3.723058428273193*^9, 
  3.764247524736701*^9, 3.764248030454146*^9, 3.849030627176855*^9, 
  3.850310960286202*^9, 3.901303302154188*^9, 3.9068182432889023`*^9, 
  3.906823901848926*^9, 3.906824149561634*^9},
 CellLabel->
  "Out[182]=",ExpressionUUID->"4d763906-593f-47f1-8e1b-04519e6dbfee"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{698.25, 780.},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{Automatic, Automatic},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
Magnification:>0.75 Inherited,
FrontEndVersion->"13.2 for Linux x86 (64-bit) (January 31, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"24871034-a4e0-434e-8d9e-d8ec1af58188"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 241, 4, 74, "Title",ExpressionUUID->"bb8b7b74-143e-41ce-a246-8c42a29bf4f5"],
Cell[824, 28, 584, 9, 22, "Input",ExpressionUUID->"86a1bc67-111e-4b5f-b8a7-e8b4983acab1"],
Cell[CellGroupData[{
Cell[1433, 41, 272, 5, 41, "Subsection",ExpressionUUID->"9c2a181c-f246-4787-8d4b-198a039cc207"],
Cell[1708, 48, 442, 9, 22, "Input",ExpressionUUID->"ea2b45c0-7bcc-431f-9104-2144d07c791b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2187, 62, 1373, 40, 67, "Subsection",ExpressionUUID->"7796673f-c8ea-458e-857b-77d57be34039"],
Cell[3563, 104, 1551, 48, 168, "Input",ExpressionUUID->"e2c38a60-f6bc-48b1-9272-db75a70885c3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5151, 157, 412, 13, 43, "Subsection",ExpressionUUID->"83db025d-cf6b-4869-a639-b7206dd781d8"],
Cell[CellGroupData[{
Cell[5588, 174, 1315, 36, 22, "Input",ExpressionUUID->"2a5e0087-5b0b-43e0-941e-e0f8b0364880"],
Cell[6906, 212, 1784, 42, 63, "Output",ExpressionUUID->"e06ccfa3-4822-415e-a6fa-620bdaf7dc8a"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[8739, 260, 186, 3, 41, "Subsection",ExpressionUUID->"2288ca6f-2ee3-4651-b306-cf4ae9d2e02f"],
Cell[8928, 265, 247, 6, 22, "Input",ExpressionUUID->"3aead757-09a6-4009-adfa-8824dd391e2d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9212, 276, 184, 3, 41, "Subsection",ExpressionUUID->"6836a16d-92da-4aff-a15d-31b05516c07b"],
Cell[9399, 281, 407, 9, 25, "Input",ExpressionUUID->"ceaf7f50-5244-42e1-9c13-7ee030797555"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9843, 295, 910, 28, 61, "Subsection",ExpressionUUID->"b35fe5db-06f7-49ea-9a3f-4c91eaa4ad4b"],
Cell[10756, 325, 726, 18, 22, "Input",ExpressionUUID->"9c9a3d67-755b-4801-beb3-711219280dac"],
Cell[11485, 345, 793, 14, 22, "Input",ExpressionUUID->"cbd871de-2821-4001-8b99-60fdd72c5582"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12315, 364, 173, 3, 41, "Subsection",ExpressionUUID->"07296904-0c59-449f-82f8-7af9ae912604"],
Cell[12491, 369, 7173, 188, 199, "Input",ExpressionUUID->"ea952e84-73e5-4db5-a24c-7b8cca083db6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19701, 562, 174, 3, 41, "Subsection",ExpressionUUID->"abfcc1f7-1eee-4f10-b029-302d2931f2e3"],
Cell[CellGroupData[{
Cell[19900, 569, 5297, 156, 260, "Input",ExpressionUUID->"ec005e8d-3948-43f1-8fa9-a048c1b3ced7"],
Cell[25200, 727, 4206, 124, 174, "Output",ExpressionUUID->"f9169e83-ba74-48ee-84e7-6d9534f95867"],
Cell[29409, 853, 1437, 31, 63, "Output",ExpressionUUID->"5275e9d6-7e8f-4be3-bc23-e4f9d66b2fd7"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[30895, 890, 370, 8, 61, "Subsection",ExpressionUUID->"bdd44eb5-b842-4022-84d3-48cc45df3a20"],
Cell[31268, 900, 5455, 145, 253, "Input",ExpressionUUID->"5097f0b4-33e2-4dc9-ad97-3185c9754446"],
Cell[CellGroupData[{
Cell[36748, 1049, 174, 3, 35, "Subsubsection",ExpressionUUID->"749ab860-4f3f-4672-b10c-23348b9fa28b"],
Cell[36925, 1054, 654, 17, 39, "Input",ExpressionUUID->"3b481763-29c4-46bd-bd6a-36311ee75f76"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37616, 1076, 172, 3, 35, "Subsubsection",ExpressionUUID->"a3d1944e-e8d6-43a7-a8ea-f474d13c6f5c"],
Cell[37791, 1081, 1294, 33, 94, "Input",ExpressionUUID->"cbeac1b2-0dd0-464c-8212-c989c0429ba1"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[39134, 1120, 283, 6, 41, "Subsection",ExpressionUUID->"85bd7e05-996a-4eee-966b-0722e79cd633"],
Cell[39420, 1128, 4557, 107, 151, "Input",ExpressionUUID->"b20a5478-db60-4e62-9354-9d18e3df6b48"],
Cell[43980, 1237, 2173, 50, 103, "Input",ExpressionUUID->"b360755f-fafe-4d62-84f0-b467e1ab46d6"],
Cell[CellGroupData[{
Cell[46178, 1291, 365, 9, 22, "Input",ExpressionUUID->"3f8a4881-197e-4320-8709-6e259833a9d9"],
Cell[46546, 1302, 1044, 17, 36, "Output",ExpressionUUID->"b3218ee6-5d2b-42e4-8396-677967f7ba60"]
}, Open  ]],
Cell[47605, 1322, 1887, 55, 122, "Input",ExpressionUUID->"3375a3de-6cf1-45be-a8ba-746b2137eeaa"]
}, Open  ]],
Cell[CellGroupData[{
Cell[49529, 1382, 179, 3, 41, "Subsection",ExpressionUUID->"efc90ca0-53b2-4b32-822f-a7b7005aaf30"],
Cell[49711, 1387, 1420, 34, 103, "Input",ExpressionUUID->"81ae0957-eedc-47b4-9f01-542090505e2f"],
Cell[51134, 1423, 20377, 473, 738, "Input",ExpressionUUID->"c34493b0-9a33-4068-ad0f-1bec6c83e839"],
Cell[CellGroupData[{
Cell[71536, 1900, 2903, 80, 103, "Input",ExpressionUUID->"b3e54241-c144-4a67-8108-fecc89c10ac9"],
Cell[74442, 1982, 2786, 48, 199, "Output",ExpressionUUID->"8c5821c3-5666-48ec-b25a-7c05ccab03b2"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[77277, 2036, 318, 5, 41, "Subsection",ExpressionUUID->"244dcdc5-0303-47ed-87f2-4366ada70dba"],
Cell[77598, 2043, 22105, 525, 832, "Input",ExpressionUUID->"3d13f7a6-bc69-44bd-beae-36f3f4a31410"],
Cell[CellGroupData[{
Cell[99728, 2572, 351, 7, 22, "Input",ExpressionUUID->"dd85986a-48bb-4199-acc2-53db025513df"],
Cell[100082, 2581, 7877, 121, 454, "Output",ExpressionUUID->"89a9a426-1ca4-46c1-a23b-52e8bca6616f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[107996, 2707, 804, 21, 55, "Input",ExpressionUUID->"1c09f43a-6b59-40b8-a470-360d091ae652"],
Cell[108803, 2730, 1560, 25, 85, "Output",ExpressionUUID->"6d7510f7-4359-4769-84f9-1a5700eb89b6"],
Cell[110366, 2757, 1575, 25, 85, "Output",ExpressionUUID->"5c16d1fb-a39c-4416-a315-5d589a27242b"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[111990, 2788, 387, 6, 41, "Subsection",ExpressionUUID->"7c9809d2-c457-4456-a6d5-a61fb1ef5e96"],
Cell[112380, 2796, 23828, 563, 944, "Input",ExpressionUUID->"2a05a9d5-c158-4e2b-9df7-37b20b9392ca"],
Cell[136211, 3361, 287, 6, 22, "Input",ExpressionUUID->"9c3e06ff-3981-4656-a17a-ebd2e6414983"],
Cell[CellGroupData[{
Cell[136523, 3371, 2299, 59, 103, "Input",ExpressionUUID->"2d6f92d8-65b7-4b13-af56-46b0d920e1c6"],
Cell[138825, 3432, 1756, 29, 85, "Output",ExpressionUUID->"7b81f044-1897-43bc-a3f2-367a820df9b6"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[140630, 3467, 438, 6, 41, "Subsection",ExpressionUUID->"ff4c22a0-dd62-43f0-b938-7b596e476580"],
Cell[141071, 3475, 28562, 684, 1121, "Input",ExpressionUUID->"2ca765d3-b04b-4da6-a120-d5599e351d92"],
Cell[CellGroupData[{
Cell[169658, 4163, 3589, 88, 166, "Input",ExpressionUUID->"d3f2b56c-5dd7-407d-b26b-e6834b57de93"],
Cell[173250, 4253, 3747, 59, 213, "Output",ExpressionUUID->"9237e4a2-4087-4a70-9b09-5484cdfef6ad"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[177046, 4318, 226, 4, 41, "Subsection",ExpressionUUID->"c231b8cc-4b08-446e-a581-cdfb2b99cd24"],
Cell[177275, 4324, 20881, 487, 799, "Input",ExpressionUUID->"24d59894-ebe9-4b86-8ae0-2abad28aff8a"],
Cell[CellGroupData[{
Cell[198181, 4815, 188, 3, 22, "Input",ExpressionUUID->"ab4c67dc-2192-40c7-a237-3e5d4e6ee0a9"],
Cell[198372, 4820, 1875, 32, 117, "Output",ExpressionUUID->"31b75efa-d318-40b8-a7ab-950d4c08576a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[200284, 4857, 530, 14, 22, "Input",ExpressionUUID->"2e2a8670-e2c7-46bc-918a-cb40a314e183"],
Cell[200817, 4873, 468, 7, 36, "Output",ExpressionUUID->"0eda8e47-cff3-40f5-80df-22a9a590afc4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[201322, 4885, 373, 9, 22, "Input",ExpressionUUID->"d1570907-066c-4748-b95e-468213e3c83b"],
Cell[201698, 4896, 465, 7, 36, "Output",ExpressionUUID->"fc9c80cd-2989-412c-8bf6-4fea79187ac7"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[202212, 4909, 293, 4, 41, "Subsection",ExpressionUUID->"97d17135-22ea-4a07-9c40-310abe0ecfb6"],
Cell[202508, 4915, 19607, 505, 944, "Input",ExpressionUUID->"f37aaa3a-d67c-45b1-b0bb-6f32cc052f5a"],
Cell[CellGroupData[{
Cell[222140, 5424, 295, 6, 22, "Input",ExpressionUUID->"d6f007ba-4a56-49df-80d4-d3f209c1cd76"],
Cell[222438, 5432, 2074, 37, 117, "Output",ExpressionUUID->"aa48b2b1-6210-4244-84bd-110fc16d2bbb"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[224561, 5475, 344, 5, 41, "Subsection",ExpressionUUID->"e4b55963-0f0d-4fb3-a72b-3edce8293b36"],
Cell[224908, 5482, 21691, 551, 929, "Input",ExpressionUUID->"3e770a1f-6321-4a0a-bc72-ecdb75b93796"],
Cell[CellGroupData[{
Cell[246624, 6037, 348, 7, 22, "Input",ExpressionUUID->"99935156-9011-484c-b000-1ee7202b119a"],
Cell[246975, 6046, 7730, 118, 404, "Output",ExpressionUUID->"1e6fa520-7130-4858-a3c9-8bebf603be97"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[254754, 6170, 398, 6, 41, "Subsection",ExpressionUUID->"71f5f912-94f1-4ebd-90b7-ef6a06717c81"],
Cell[255155, 6178, 23372, 603, 1015, "Input",ExpressionUUID->"be657270-67b8-4aaa-92f3-915c61968609"],
Cell[CellGroupData[{
Cell[278552, 6785, 546, 9, 22, "Input",ExpressionUUID->"60f95087-2624-489a-ae62-8774721a33fc"],
Cell[279101, 6796, 5828, 92, 358, "Output",ExpressionUUID->"4d763906-593f-47f1-8e1b-04519e6dbfee"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

